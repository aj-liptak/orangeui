<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Views Test</title>

<script src="lib/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="lib/json-template.js" type="text/javascript"></script>
<script src="src/commons.js" type="text/javascript"></script>
<script src="src/ui.js" type="text/javascript"></script>

<script type="text/javascript">

Orange.add('test', function(O) {

	O.namespace('Test');
	
		
	O.Test.TestViewController = O.View.define({
		
		type: 'ui-test-view',
		
		onLoad: function() {
			
			for (var name in this._views) {
				this._views[name].onLoad();
			}
									
			this.getView('home').on('change', $.proxy(this.onChange, this));
			
			this.on('updated', function(e) {
				console.log(e.data);
			});
			
		},
		
		onChange: function(e) {
			this.getView('home').getView('info').target.css('background-color', e.data);			
		},
		
		onUnload: function() {
					
		
		}
		
	});
	
	O.Test.FormViewController = O.View.define({
		
		type: 'ui-form-view',
		
		onLoad: function() {
			
			var that = this;
			
			for (var name in this._views) {
				this._views[name].onLoad();
			}
			
			this.getForm('testForm').get('first_name').val('Kevin');
			this.getForm('testForm').get('last_name').val('Kinnebrew');
			
			this.target.css('background-color', '#F00');
						
			this.on('updated', function(e) {
				console.log("updated");
			});
			setTimeout(function() {
				that.fire('change', '#F0F');
			}, 2000)
												
		},
		
		onUnload: function() {
					
			//console.log("home view unloaded");
		
		}
		
	});
	
	O.Test.InfoViewController = O.View.define({
		
		type: 'test-info-view',
		
		onLoad: function() {
			
			var that = this;
			
			for (var name in this._views) {
				this._views[name].onLoad();
			}
			setTimeout(function() {
				that.fire('updated', 'Andy');
			}, 4000)
												
		},
		
		onUnload: function() {
					
		}
		
	});
	
		
}, ['ui'], '0.1');

$(document).ready(function() {

	Orange.app('test', {
		location: true,
		poll: false,
		required: ['test'],
		baseUrl: '/orangeui',
		namespace: 'Test',
		rootView: 'TestViewController'
	});
	
	Orange.init('test');

});

</script>

</head>

<body>

<div data-view="ui-test-view" data-name="test" data-root="true">

	<div data-view="ui-form-view" data-name="home" data-template="home.html"></div>

</div>

</body>
</html>
