<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="lib/jquery.history.js"></script>
<script src="src/commons.js" type="text/javascript"></script>
<script src="src/mvc.js" type="text/javascript"></script>
<!--<script src="src/db.js" type="text/javascript"></script>-->
<script src="src/ui.js" type="text/javascript"></script>
<script src="src/ios.js" type="text/javascript"></script>
<script src="plugins/cakephp/cakephp.js" type="text/javascript"></script>
<script src="lib/socket.io.js" type="text/javascript"></script>
<script src="lib/inflection.js" type="text/javascript"></script>

<link type="text/css" rel="stylesheet" href="plugins/ios/ios.css" />

<script type="text/javascript">

Orange.use('mvc', 'cakephp', 'ui', 'ios', function(O) {

	var Ajax = __import('Ajax'), Model = __import('Model'), ViewController = __import('ViewController');
		
	var source = new O.CakePHP.CakeSource({
		name: 'contacts',
		path: '/contacts/'
	});
	
	var Contact = Model.extend({
	
		getName: function() {
			return 'contact';
		},
		
		getId: function() {
			return 'id';
		},
		
		getFields: function() {
			return {
				contactId: { name: 'id', type: 'key', nullable: false, primaryKey: true },
				firstName: { name: 'first_name', type: 'text', nullable: false },
				lastName: { name: 'last_name', type: 'text', nullable: false },
				email: { name: 'email', type: 'email', nullable: true }
			}
		},
		
		getSource: function() {
			return source;
		}
	
	});
	
	var MyView = ViewController.extend({
	
		getType: function() {
			return 'my-view'
		},
		
		getBindings: function() {
			return {
				'test': { 'click': true },
				'goonline': { 'click': this.onOnline }
			}
		},
		
		onWillLoad: function() {

			
		},
		
		onClick: function(e) {
			//History.pushState({}, 'This is another page', 'two');
			
			var success = function(data) {
				console.log(data.toObject());
			};
			
			var error = function(e) {
				console.log("error");
			}
			
			Contact.set({ firstName: '123', lastName: '24543' }, success, error);
				O.PersistenceManager.onSync();		
		},
		
		onOnline: function() {
			O.PersistenceManager.onStatusChange({ data: 1});
		}
	
	});
	
	var AnotherView = MyView.extend({
	
		getType: function() {
			return 'another-view'
		}
	
	});
	
	var test = new O.Application('test', {
		location: true,
		logging: 'INFO',
		poll: false,
		required: ['db', 'mvc', 'ui', 'cakephp', 'ios'],
		version: '1.2.3'
	});
	
	test.launch();
	
	
	//var s = new O.PersistentStorageSource({ name: 'test' });
	
	//console.log(s.getAllActions());
	//console.log(s.getAll('contact'));
	//console.log(s.get('contact', 1));
	//console.log(s.set('contact', 3, { name: 'asdsad' }));
	//console.log(s.remove('contact', 1));
	//s.flush();
	
	
	
});


</script>

<body>

<div data-control="view" data-name="test-view" data-root="true">

	<p>Hello</p>
	
	<div data-control="my-view" data-name="arg">
	
		<p data-name="test">Test</p>
		<p data-name="goonline">Go</p>
	
	</div>
	
	<div data-control="another-view" data-name="blurg">
	
	</div>

</div>

</body>