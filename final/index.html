<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="lib/jquery.history.js"></script>
<script src="src/commons.js" type="text/javascript"></script>
<script src="src/mvc.js" type="text/javascript"></script>
<!--<script src="src/db.js" type="text/javascript"></script>-->
<script src="src/ui.js" type="text/javascript"></script>
<script src="plugins/ios/ios.js" type="text/javascript"></script>
<script src="plugins/cakephp/cakephp.js" type="text/javascript"></script>
<script src="lib/socket.io.js" type="text/javascript"></script>
<script src="lib/inflection.js" type="text/javascript"></script>
<script src="lib/iscroll.js" type="text/javascript"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">


<link type="text/css" rel="stylesheet" href="plugins/ios/ios.css" />

<style type="text/css">

html, body {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	margin: 0;
	padding: 0;
	overflow: hidden;
}

div[data-root=true] {
	display: none;
}

</style>

<script type="text/javascript">

Orange.use('mvc', 'cakephp', 'ui', 'ios', function(O) {

	var Ajax = __import('Ajax'), Model = __import('Model'), ViewController = __import('ViewController');
		
	var source = new O.CakePHP.CakeSource({
		name: 'contacts',
		path: '/contacts/'
	});
	
	var Contact = Model.extend({
	
		getName: function() {
			return 'contact';
		},
		
		getId: function() {
			return 'id';
		},
		
		getFields: function() {
			return {
				contactId: { name: 'id', type: 'key', nullable: false, primaryKey: true },
				firstName: { name: 'first_name', type: 'text', nullable: false },
				lastName: { name: 'last_name', type: 'text', nullable: false },
				email: { name: 'email', type: 'email', nullable: true }
			}
		},
		
		getSource: function() {
			return source;
		}
	
	});
		
	var MainView = O.iOS.UINavigationViewController.extend({
	
		getType: function() {
			return 'main-view';
		},
		
		getBindings: function() {
			return {
				'first': { 'next': true },
				'second': { 'back': true }
			}
		},
		
		onNext: function(e) {
			this.pushView(this.getView('second'));
		},
		
		onBack: function(e) {
			this.popToRootView();
		}
	
	});
	
	var FirstView = O.iOS.UIViewController.extend({
		
		getType: function() {
			return 'first-view';
		},
		
		getBindings: function() {
			return {
				'next-btn': { 'touchclick': this.onNext }
			}
		},
		
		onNext: function() {
			this.fire('next');
		}
		
	});
	
	var SecondView = O.iOS.UIViewController.extend({
		
		getType: function() {
			return 'second-view';
		},
		
		getBindings: function() {
			return {
				'back-btn': { 'touchclick': this.onBack }
			}
		},
		
		onBack: function() {
			this.fire('back');
		}		
		
	});
	
	var test = new O.Application('test', {
		location: true,
		logging: 'INFO',
		poll: false,
		required: ['db', 'mvc', 'ui', 'cakephp', 'ios'],
		version: '1.2.3'
	});
	
	test.launch();
	
//	setTimeout(function() {
//		
//		var myScroll;
//		function loaded() {
//			console.log("!23");
//			myScroll = new iScroll('wrapper');
//		}
//		
//		document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
//		
//		/* * * * * * * *
//		 *
//		 * Use this for high compatibility (iDevice + Android)
//		 *
//		 */
//		loaded();
//		
//	
//	}, 2000);
//	
});


</script>

<body>

<div data-control="main-view" data-name="test-main" data-default="first" data-root="true">

	<div data-control="first-view" data-name="first">
	
		<div class="ios-ui-navigation-bar">
			
			<div class="title">Page One</div>
			
			<div class="ios-ui-bar-button-item right" data-name="next-btn">Next</div>
			
		</div>
		
		<div id="wrapper" data-control="ios-ui-scroll-view" data-name="table-view">
			
			<ul>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<li>Hello</li>
				
				<input type="text" />
				
			</ul>
		
		</div>
	
	</div>
	
	<div data-control="second-view" data-name="second">
		
		<div class="ios-ui-navigation-bar">
			
			<div class="title">Page Two</div>
			
			<div class="ios-ui-bar-button-item left" data-name="back-btn">Back</div>
			
		</div>
	
		<p>Arg</p>
	
	</div>

</div>

</body>