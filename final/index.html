<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>
<script src="src/commons.js" type="text/javascript"></script>
<script src="src/mvc.js" type="text/javascript"></script>
<script src="src/db.js" type="text/javascript"></script>
<script src="plugins/cakephp/cakephp.js" type="text/javascript"></script>
<script src="lib/socket.io.js" type="text/javascript"></script>
<script src="lib/inflection.js" type="text/javascript"></script>

<!--<script src="modules/rest.js" type="text/javascript"></script>
<script src="modules/cakephp.js" type="text/javascript"></script>
-->

<script type="text/javascript">

window.onload = function() {

	Orange.use('mvc', 'db', 'cakephp', function(O) {
		
			var Ajax = __import('Ajax');
		
		var Model = __import('Model');
		
		var source = new O.CakePHP.CakeSource({
			name: 'contacts',
			path: '/contacts/'
		});
		
		var Contact = Model.extend({
			
			getName: function() {
				return 'contact';
			},
			
			getId: function() {
				return 'id';
			},
			
			getFields: function() {
				return {
					contactId: { name: 'id', type: 'key', nullable: false, primaryKey: true },
					firstName: { name: 'first_name', type: 'text', nullable: false },
					lastName: { name: 'last_name', type: 'text', nullable: false },
					email: { name: 'email', type: 'email', nullable: true }
				}
			},
			
			getSource: function() {
				return source;
			}
			
		});
		//		
//		var p;
//		console.log(p = new Person({ personId: 5 }));
//		
//		console.log(p.getName());
//		
		//Model.getAll();
//		Person.getAll();
//		
//		p.refresh();
//		
//		var app = new O.Application('test', {
//			required: ['mvc'],
//			location: true,
//			poll: true,
//			logging: 'INFO'
//		});
//		
//		app.launch();

		var success = function(data) {
//	
//			data.set('firstName', 'asdf');
//			
//			data.save();
			console.log(data);
			
			setTimeout(function() {
			data.remove();
			
			console.log(data);
			}, 5000);
		}
		
		var error = function(xhr) {
			console.log(xhr);
		}
	
		Contact.get(39, success, error);
		
//		var c = new Contact({
//			firstName: '123',
//			lastName: '1325234'
//		});
//		
//		Contact.set(c);

		

	});

}

</script>

<body>

<ul id="messages">

</ul>

</body>