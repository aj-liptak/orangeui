<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>
<!--<script type="text/javascript" src="lib/jquery.history.js"></script>-->
<script src="src/commons.js" type="text/javascript"></script>
<script src="src/mvc.js" type="text/javascript"></script>
<!--<script src="src/db.js" type="text/javascript"></script>-->
<script src="src/ui.js" type="text/javascript"></script>
<script src="plugins/ios/ios.js" type="text/javascript"></script>
<script src="plugins/cakephp/cakephp.js" type="text/javascript"></script>
<script src="lib/socket.io.js" type="text/javascript"></script>
<script src="lib/inflection.js" type="text/javascript"></script>
<script src="lib/iscroll.js" type="text/javascript"></script>

<!-- iOS meta rules -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<!-- viewport rules -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">


<link type="text/css" rel="stylesheet" href="plugins/ios/ios.css" />

<style type="text/css">



</style>

<style type="text/css">

html, body {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	margin: 0;
	padding: 0;
	overflow: hidden;
}

div[data-root=true] {
	display: none;
}

</style>

<script type="text/javascript">

Orange.use('mvc', 'cakephp', 'ui', 'ios', function(O) {

	var Ajax = __import('Ajax'), Model = __import('Model'), ViewController = __import('ViewController');
		
	var source = new O.CakePHP.CakeSource({
		name: 'contacts',
		path: '/contacts/'
	});
	
	var Contact = Model.extend({
	
		getName: function() {
			return 'contact';
		},
		
		getId: function() {
			return 'id';
		},
		
		getFields: function() {
			return {
				contactId: { name: 'id', type: 'key', nullable: false, primaryKey: true },
				firstName: { name: 'first_name', type: 'text', nullable: false },
				lastName: { name: 'last_name', type: 'text', nullable: false },
				email: { name: 'email', type: 'email', nullable: true },
				phone: { name: 'phone', type: 'tel', nullable: true },
				birthday: { name: 'birthday', type: 'date', nullable: true },
				website: { name: 'website', type: 'url', nullable: true }
			}
		},
		
		getSource: function() {
			return source;
		}
	
	});
		
	var MainView = O.iOS.UINavigationViewController.extend({
	
		getType: function() {
			return 'main-view';
		},
		
		getBindings: function() {
			return {
				'first': { 'select': true },
				'second': { 'back': true },
			}
		},
		
		onBack: function(e) {
			this.popToRootView();
		},
		
		onSelect: function(e) {	
			this.getView('second').bindData(e.data);
			this.pushView(this.getView('second'));
		}
	
	});
	
	var FirstView = O.iOS.UIViewController.extend({
		
		getType: function() {
			return 'first-view';
		},
		
		getBindings: function() {
			return {
				'contacts-table': { 'select': true }
			}
		},
		
		onDidLoad: function() {
			
			Contact.getAll({}, Class.proxy(function(data) {
				this.getView('contacts-table').bindData(data);
			}, this), function() {})
		
		},
		
		onSelect: function(e) {
			this.fire('select', e.data);
		}
		
	});
	
	var SecondView = O.iOS.UIViewController.extend({
		
		getType: function() {
			return 'second-view';
		},
		
		getBindings: function() {
			return {
				'back-btn': { 'touchclick': this.onBack }
			}
		},
		
		onBack: function() {
			this.fire('back');
		}
		
	});
	
	var test = new O.iOS.Application('test', {
		location: true,
		logging: 'INFO',
		poll: false,
		required: ['db', 'mvc', 'ui', 'cakephp', 'ios'],
		version: '1.2.3'
	});
	
	test.launch();
	

	
//	setTimeout(function() {
//		
//		var myScroll;
//		function loaded() {
//			console.log("!23");
//			myScroll = new iScroll('wrapper');
//		}
//		
//		document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
//		
//		/* * * * * * * *
//		 *
//		 * Use this for high compatibility (iDevice + Android)
//		 *
//		 */
//		loaded();
//		
//	
//	}, 2000);
//	

//function doOnOrientationChange()
//  {
//    switch(window.orientation) 
//    {  
//      case -90:
//      case 90:
//        alert('landscape');
//        break; 
//      default:
//        alert('portrait');
//        break; 
//    }
//  }
//
//  window.onorientationchange = function()
//  {
//    doOnOrientationChange();
//  };
//
  // Initial execution
//  doOnOrientationChange();
});


</script>

<body>

<div id="ios-preload"></div>

<div data-control="main-view" data-name="test-main" data-default="first" data-root="true">

	<div data-control="first-view" data-name="first">
	
		<div class="ios-ui-navigation-bar">
						
			<div class="title">My Contacts</div>
						
		</div>
		
		<div data-control="ios-ui-table-view" data-name="contacts-table">
			
			<ul>
				
				<li itemscope>
					<span itemprop="firstName"></span>
					<span itemprop="lastName"></span>
				</li>
				
			</ul>
		
		</div>
	
	</div>
	
	<div data-control="second-view" data-name="second">
		
		<div class="ios-ui-navigation-bar">
			
			<div class="ios-ui-bar-button-item left back" data-name="back-btn">Back</div>
			
			<div class="title">
				<span itemprop="firstName"></span> <span itemprop="lastName"></span>
			</div>
						
			<div class="ios-ui-bar-button-item right blue">Save</div>
			
		</div>
		
		
		<div class="ios-ui-table-form grouped sectioned">
				
			<div data-control="ios-ui-scroll-view" data-name="contact-info-scroller">
				
				<div class="section">Personal Information</div>
				
				<ul>
					
					<li>
						<div class="title">First Name</div>
						<div class="subtitle" itemprop="firstName"></div>
					</li>
					
					<li>
						<div class="title">Last Name</div>
						<div class="subtitle" itemprop="lastName"></div>
					</li>
					
					<li>
						<div class="title">Email</div>
						<div class="subtitle" itemprop="email"></div>
					</li>
					
					<li>
						<div class="title">Phone</div>
						<div class="subtitle" itemprop="phone"></div>
					</li>
				
				</ul>
				
				<div class="section">Other Information</div>
				
				<ul>
					
					<li>
						<div class="title">Birthday</div>
						<div class="subtitle" itemprop="birthday"></div>
					</li>
					
					<li>
						<div class="title">Website</div>
						<div class="subtitle" itemprop="website"></div>
					</li>
					
				</ul>
			
			</div>
		
		</div>
		
	</div>

</div>

</body>