Orange.add("ios",function(a){var b,c,d,e,f,g,h,i,j;var k=__import("ViewController"),l=__import("Collection"),m=__import("Binding");b=a.Application.extend({onLaunch:function(b){document.body.addEventListener("touchend",function(a){$(".ios-ui-bar-button-item").removeClass("touched")});var c=this;if(a.Browser.isTouch){$("body").addClass("touch")}else{$("body").addClass("nontouch")}window.onorientationchange=function(){var a;switch(window.orientation){case-90:case 90:a="landscape";break;default:a="portrait";break}(function(){c.onOrientationChange.call(c,a)})()};window.onorientationchange.call(this);if(a.Browser.isScrollable)this.setupScroll();this._super()},onOrientationChange:function(a){if(a=="landscape"){$("body").removeClass("portrait").addClass("landscape")}else{$("body").removeClass("landscape").addClass("portrait")}},setupScroll:function(){function e(b){c=b.target;while(c&&!(c.className||"").match(/\bscrollable\b/)){c=c.parentNode}if(!c){b.preventDefault()}if(b.touches.length==1&&c){a=b.touches[0].pageY;c.addEventListener("touchmove",f,false);c.addEventListener("touchend",g,false);var e=c.childNodes,h;for(var i=0,j=e.length;i<j;i++){h=e[i];try{if(h instanceof HTMLElement)d=h}catch(b){if(typeof h==="object"&&h.nodeType===1&&typeof h.style==="object"&&typeof h.ownerDocument==="object")d=h}}}}function f(e){if(e.touches.length>1||!d){h()}else{b=e.touches[0].pageY-a;var f=c.offsetTop-$(d).offset().top;if(f<=0&&b>0||f>=c.offsetHeight&&b<0){e.preventDefault()}}}function g(a){h()}function h(){c.removeEventListener("touchmove",f);c.removeEventListener("touchend",g);c=null;d=null;a=null;direction=null}document.body.addEventListener("touchstart",e,false);var a,b,c,d}});c=k.extend({getType:function(){return"ios-ui-flip-view"},onDidLoad:function(){for(var a in this._views){this._views[a].target.addClass("animated")}this.find(".back").css("opacity",0).hide()},flipView:function(a){if(this.target.hasClass("flipped")){this.target.removeClass("flipped");setTimeout(Class.proxy(function(){this.find(".back").css("opacity",0)},this),300);setTimeout(Class.proxy(function(){this.find(".back").hide()},this),350)}else{this.find(".back").show();setTimeout(Class.proxy(function(){this.find(".back").css("opacity",1)},this),350);setTimeout(Class.proxy(function(){this.target.addClass("flipped")},this),50)}}});d=k.extend({getType:function(){return"ios-ui-modal-view"},presentModalView:function(){this.load();$("body").append(this.target);setTimeout(Class.proxy(function(){this.show();this.target.addClass("visible")},this),50)},dismissModalView:function(){this.hide();this.target.removeClass("visible");setTimeout(Class.proxy(function(){this.target.remove();this.unload()},this),300)}});e=k.extend({getType:function(){return"ios-ui-navigation-view"},activeView:null,leftBtn:null,rightBtn:null,navBar:null,viewStack:[],onLoad:function(){var a=this.target.attr("data-default");for(var b in this.views){if(this.views[b].name!==a){this.views[b].target.remove()}else{this.viewStack.push(this.views[b]);this.activeView=this.views[b]}}this.activeView.load();this.target.removeAttr("data-default");console.log(this.data.name+" "+"Load");this.fire("_loaded")},onAppear:function(){console.log(this.data.name+" "+"Appear");if(this.activeView)this.activeView.show();this.fire("_appeared")},onDidLoad:function(){this.navBar=$('<div class="ios-ui-navigation-bar"></div>');this.target.prepend(this.navBar);var a=this.activeView.find(".ios-ui-bar-button-item.left");var b=this.activeView.find(".ios-ui-bar-button-item.right");if(a.length!=0){this.leftBtn=a.clone(true);this.leftBtn.appendTo(this.navBar)}if(b.length!=0){this.rightBtn=b.clone(true);this.rightBtn.appendTo(this.navBar)}this.activeView.target.addClass("active");this.animating=false;this._super()},popView:function(){if(this.animating)return;this.animating=true;var a=300;var b=this.viewStack[this.viewStack.length-2];var c=b.find(".ios-ui-bar-button-item.left");var d=b.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null){if(this.leftBtn.hasClass("back")){this.leftBtn.addClass("slideIn");this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()})}else this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()})}if(this.rightBtn!=null)this.rightBtn.fadeOut(a,function(){$(this).unbind().remove()});if(c.length!=0){var e=c.clone(true).hide();e.appendTo(this.navBar);setTimeout(Class.proxy(function(){e.fadeIn(a-100);this.leftBtn=e},this),100)}if(d.length!=0){this.rightBtn=d.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout(Class.proxy(function(){this.rightBtn.fadeIn(a-100)},this),100)}if(c.length==0&&d.length==0&&navBar.length==0){this.navBar.addClass("hidden");b.target.css("top","0px")}else{this.navBar.removeClass("hidden");b.target.css("top","44px")}var f=this.activeView;if(this.activeView.length!=0){f.target.addClass("unloading").removeClass("active");this.viewStack.pop()}setTimeout(Class.proxy(function(){f.target.addClass("preloaded").removeClass("unloading");f.target.remove();f.unload()},this),a);this.activeView=b;b.target.addClass("loading").removeClass("inactive");setTimeout(Class.proxy(function(){b.target.addClass("active").removeClass("loading");this.animating=false},this),a)},pushView:function(a){if(this.animating)return;this.animating=true;var b=300;a=this.getView(a);for(var c in this.viewStack){if(this.viewStack[c].target[0]==a.target[0]){Log.warn("Can't repush view controller");return}}a.load();a.target.addClass("preloaded");this.target.append(a.target);a.show();var d=a.find(".ios-ui-bar-button-item.left");var e=a.find(".ios-ui-bar-button-item.right");var f=a.find("ios-ui-navigation-bar");if(this.leftBtn!=null){if(this.leftBtn.hasClass("back")){this.leftBtn.addClass("slideOut");setTimeout(Class.proxy(function(){this.leftBtn.unbind().remove()},this),200)}else this.leftBtn.fadeOut(b,function(){$(this).unbind().remove()})}if(this.rightBtn!=null)this.rightBtn.fadeOut(b,function(){$(this).unbind().remove()});if(d.length!=0){var g=d.clone(true).hide();g.appendTo(this.navBar);setTimeout(Class.proxy(function(){g.fadeIn(b-100)},this),150);setTimeout(Class.proxy(function(){this.leftBtn=g},this),300)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout(Class.proxy(function(){this.rightBtn.fadeIn(b-100)},this),100)}if(d.length==0&&e.length==0&&f.length==0){this.navBar.addClass("hidden");a.target.css("top","0px")}else{this.navBar.removeClass("hidden");a.target.css("top","44px")}var h=this.activeView;if(this.activeView.length!=0){h.target.addClass("inactivating").removeClass("active")}setTimeout(Class.proxy(function(){h.target.addClass("inactive").removeClass("inactivating")},this),b);this.activeView=a;h.hide();a.target.addClass("loading").removeClass("preloaded");this.viewStack.push(a);setTimeout(Class.proxy(function(){a.target.addClass("active").removeClass("loading");this.animating=false},this),b)},popToRootView:function(){if(this.animating)return;this.animating=true;var a=300;for(var b=1;b<this.viewStack.length-1;b++){this.viewStack[b].target.remove()}var c=this.viewStack[0];var d=c.find(".ios-ui-bar-button-item.left");var e=c.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null){if(this.leftBtn.hasClass("back")){this.leftBtn.addClass("slideIn");this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()})}else this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()})}if(this.rightBtn!=null)this.rightBtn.fadeOut(a,function(){$(this).unbind().remove()});if(d.length!=0){var f=d.clone(true).hide();f.appendTo(this.navBar);setTimeout(Class.proxy(function(){f.fadeIn(a-100);this.leftBtn=f},this),100)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout(Class.proxy(function(){this.rightBtn.fadeIn(a-100)},this),100)}var g=this.activeView;if(this.activeView.length!=0){g.target.addClass("unloading");g.hide();this.viewStack.pop()}setTimeout(Class.proxy(function(){g.target.addClass("preloaded").removeClass("unloading").removeClass("active");g.target.remove();g.unload()},this),a);this.activeView=c;c.show();c.target.addClass("loading");setTimeout(Class.proxy(function(){c.target.addClass("active").removeClass("loading").removeClass("inactive");this.viewStack=[this.viewStack[0]];this.animating=false},this),a)}});f=k.extend({getType:function(){return"ios-ui-scroll-view"},initialize:function(a,b){this._super(a,b)},onWillLoad:function(){if(!a.Browser.isScrollable)this.target.wrapInner('<div class="scroll-view"></div>');else{this.target.wrapInner('<div class="scroller"></div>');this.target.addClass("scrollable")}this._super()},onWillAppear:function(){if(!a.Browser.isScrollable)this.myScroll=new iScroll(this.target.get(0));this._super()},onWillDisappear:function(){if(!a.Browser.isScrollable)this.myScroll.destroy();this._super()},onWillUnload:function(){this._super()}});h=k.extend({getType:function(){return"ios-ui-tab-view"},initialize:function(a,b){this._super(a,b);this.defaultView=this.target.attr("data-default");this.target.removeAttr("data-default")},onWillLoad:function(){this.tabBar=this.target.find(".ios-ui-tab-bar");if(typeof this.tabBar==="undefined")throw"Tab bar element required in view";var b=this.activeView.target.attr("data-name");this.tabBar.find(".ios-ui-tab-bar-item").removeClass("active");this.tabBar.find('.ios-ui-tab-bar-item:[data-tab="'+b+'"]').addClass("active");this.tabBar.delegate(".ios-ui-tab-bar-item",a.Browser.isTouch?"touchend":"click",Class.proxy(this.onClick,this));for(var c in this.views){this.views[c].onLoad();this.views[c].target.addClass("hidden")}},onWillAppear:function(){for(var a in this.views){if(this.views[a].name==defaultView){this.activeView=this.views[a];this.activeView.show();this.activeView.removeClass("hidden")}}this._super()},onClick:function(a){var b=$(a.currentTarget);var c=b.attr("data-tab");this.activateTab(c)},activateTab:function(a){this.activeView.target.addClass("hidden");this.activeView.hide();this.getView(a).target.removeClass("hidden");this.activeView=this.getView(a);this.activeView.show();this.tabBar.find(".ios-ui-tab-bar-item").removeClass("active");this.tabBar.find('.ios-ui-tab-bar-item:[data-tab="'+a+'"]').addClass("active")}});i=k.extend({getType:function(){return"ios-ui-table-view"},onWillLoad:function(){if(!a.Browser.isScrollable)this.target.wrapInner('<div class="scroll-view"></div>');this.list=this.target.find("ul");if(a.Browser.isScrollable)this.target.addClass("scrollable");this.binding=new m(this.list);this._super()},onDidLoad:function(){this.target.on("click","li",Class.proxy(this.onSelect,this));this._super()},onDidAppear:function(){if(!a.Browser.isScrollable)this.myScroll=new iScroll(this.target.get(0));var b=null;this.target.on("touchstart","li",function(a){clearTimeout(b);b=setTimeout(function(){$(a.currentTarget).addClass("active")},20)});this.target.on("touchmove",Class.proxy(function(a){clearTimeout(b);b=null;$(this.target).find("li").removeClass("active")},this));this.target.on("touchend",Class.proxy(function(a){clearTimeout(b);if(b)this.onSelect.call(this,a);b=null;$(this.target).find("li").removeClass("active")},this));this.target.on("touchcancel",Class.proxy(function(a){clearTimeout(b);b=null;$(this.target).find("li").removeClass("active")},this));this._super()},onWillDisappear:function(){if(!a.Browser.isScrollable)this.myScroll.destroy();this._super()},onWillUnload:function(){this.binding.clear();this.list.off();this._super()},setCollection:function(b){if(b instanceof l){this.collection=b;this.binding.bindList(this.collection);if(!a.Browser.isScrollable)this.myScroll.refresh()}},onSelect:function(b){var c=$(b.target);var d=null,e=null,f;if((e=$(c).attr("itemid"))&&this.collection instanceof l){if((f=this.collection.get(e))instanceof a.Model){this.fire("select",f)}}}});g=k.extend({getType:function(){return"ios-ui-search-bar"},onWillLoad:function(){var a=0,b=/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent);if(b)this.find("input[type=text]").wrap('<div class="ios-ff-ui-search-bar-wrapper" />');if(a)this.find("input[type=text]").wrap('<div class="ios-ff-ui-search-bar-wrapper" />');this._super()},onDidLoad:function(){this.find("input[type=text]").on("keypress",this.onKeyPress);this.find("input[type=text]").on("focus",this.onFocus);this.find("input[type=text]").on("blur",this.onBlur);this.find(".ios-ui-search-button").on("click",this.onClick);this._super()},onKeyPress:function(a){var b=a.keyCode?a.keyCode:a.which;if(b==13){if(!a)var a=window.event;a.cancelBubble=true;a.returnValue=false;if(a.stopPropagation){a.stopPropagation();a.preventDefault()}$(this).blur()}},onFocus:function(a){var b=$(this).parent();var c=$(this);var d=false;if(b.hasClass("ios-ff-ui-search-bar-wrapper")){c=b;d=true;b=b.parent()}b.find(".ios-ui-search-button").css("display","block");c.stop().animate({right:d?"117px":"80px"},d?0:200).parent().stop().find(".ios-ui-search-button").animate({right:"7px"},d?0:200)},onBlur:function(a){var b=$(this).parent();var c=$(this);var d=false;if(b.hasClass("ios-ff-ui-search-bar-wrapper")){c=b;d=true;b=b.parent()}c.stop().animate({right:d?"44px":"7px"},d?0:200).parent().stop().find(".ios-ui-search-button").animate({right:"-64px"},d?0:200,function(){b.find(".ios-ui-search-button").css("display","none")})},onClick:function(a){$(this).parent().find("input[type=text]").blur()},onWillUnload:function(){this.find("input[type=text]").off();this.find(".ios-ui-search-button").off();this._super()}});j=k.extend({getType:function(){return"ios-ui-view"}});a.namespace("iOS");a.iOS.Application=b;a.iOS.UIFlipViewController=c;a.iOS.UIModalViewController=d;a.iOS.UINavigationViewController=e;a.iOS.UIScrollViewController=f;a.iOS.UISearchBarController=g;a.iOS.UITabBarController=h;a.iOS.UITableViewController=i;a.iOS.UIViewController=j},["mvc","ui"],"1.0.2")