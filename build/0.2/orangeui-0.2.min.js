(function(){function w(){}function x(a){var b=a instanceof Array?[]:{};for(i in a){if(i=="clone")continue;if(a[i]&&typeof a[i]=="object"){b[i]=x(a[i])}else b[i]=a[i]}return b}function y(a,b){if(typeof $!=="undefined")throw"cloneAttributes() not supported";var b=$(b).eq(0);var a=$(a)[0];for(i=0;i<a.attributes.length;i++){var c=a.attributes[i];b.attr(c.name,c.value)}}var a,b,c,d,e,f,g,h,j,k,l,m,n,o,p=function(b){return a[b]},q=function(b,c){return a[b]=c},r=/[^A-Za-z:0-9_\[\]]/g,s=/[^-A-Za-z_]/g;e=function(){function c(){}var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;c.extend=function(c){function g(){if(!a&&this.initialize){this.initialize.apply(this,arguments)}}var d=this.prototype;a=true;var e=new this;a=false;for(var f in c){e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);this._super=c;return e}}(f,c[f]):c[f]}g.prototype=e;g.prototype.constructor=g;g.extend=arguments.callee;return g};c.proxy=function(a,b){var c=b;return function(){return a.apply(c,arguments)}};return c}();j=function(){function a(a,b,c,d){this.bubbles=true;this.type=a;this.currentTarget=b;this.target=c;this.data=d}a.prototype.stopPropagation=function(){this.bubbles=false};return a}();h=function(){function a(a,b,c){this.target=a;this.ev=b;this.call=c}a.prototype.detach=function(){this.target.detach(this.ev,this.call);delete this.target;delete this.ev;delete this.call;delete this};return a}();g=function(){function a(a,b){this._listeners={};this._parent=a;this._self=b}a.prototype.on=function(a,b){if(!this._listeners.hasOwnProperty(a)){this._listeners[a]=[]}this._listeners[a].push(b);return new h(this,a,b)};a.prototype.fire=function(a,b){var c=this._parent;if(typeof a==="string")a=new j(a,this._self,this._self,b);if(typeof a.type!=="string")throw"Error: Invalid 'type' when firing event";if(this._listeners[a.type]instanceof Array){var d=this._listeners[a.type];for(var e=0,f=d.length;e<f;e++)d[e].call(this,a)}if(c!=null&&c._eventTarget instanceof j&&a.bubbles){a.currentTarget=this._parent;c._eventTarget.fire.call(c._eventTarget,a,b)}};a.prototype.detach=function(a,b){if(this._listeners[a]instanceof Array){var c=this._listeners[a];for(var d=0,e=c.length;d<e;d++){if(typeof b!=="undefined"&&c[d]===b){c.splice(d,1);break}else c.splice(d,1)}}else if(typeof a==="undefined"){this._listeners={}}};Event.prototype.destroy=function(){for(var a in this._listeners){a.detach()}delete this._parent;delete this._self};return a}();m=function(){var a={},b=new g(null,a),c=0;if(typeof console=="undefined"){console={log:function(){},dir:function(){}}}var d=function(a,b,c){if(c)console.log(a,b,c);else console.log(a,b)};a.on=function(a,c,d){var d=d,e=function(a){var b=a.data.message,e=a.data.data;c.call(typeof d!=="undefined"?d:this,b,e)};return b.on.call(b,a,e)};a.fire=function(){return b.fire.apply(b,arguments)};a.detach=function(){return b.detach.apply(b,arguments)};a.setLevel=function(a){switch(a.toLowerCase()){case"info":c=4;break;case"debug":c=3;break;case"warn":c=2;break;case"error":c=1;break;default:c=0}};a.info=function(b,d){if(c>3)a.fire("info",{message:b,data:d})};a.debug=function(b,d){if(c>2)a.fire("debug",{message:b,data:d})};a.warn=function(b,d){if(c>1)a.fire("warn",{message:b,data:d})};a.error=function(b,d){if(c>0)a.fire("error",{message:b,data:d})};a.on("info",function(a,b){d("[INFO]",a,b)});a.on("debug",function(a,b){d("[DEBUG]",a,b)});a.on("warn",function(a,b){d("[WARN]",a,b)});a.on("error",function(a,b){d("[ERROR]",a,b)});return a}();k=function(){var b={},c={};return{addModule:function(a,c,d){a=a.replace(/[^-A-Za-z_]/g);var e={name:a,fn:c,req:d!=undefined?d:[]};b[a]=e},loadModule:function(d){if(c.hasOwnProperty(d))return;if(b[d]!=undefined){c[d]=true;for(var e=0,f=b[d].req.length;e<f;e++){if(b[d].req[e]===d)continue;k.loadModule(b[d].req[e])}b[d].fn.call(window,a);m.debug('Module "'+d+'" loaded')}}}}();b=function(){var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var c=function(){var b=false;for(var c=0,d=a.length;c<d;c++){try{b=a[c]()}catch(e){continue}}return b};return{load:function(a){if(typeof $!=="undefined"){return $.ajax(a).responseText}else{var b=c();if(!b)return;var d,e,f,g=false;console.log(a.data);if(typeof a.success==="function")d=a.success;if(typeof a.error==="function")e=a.error;if(a.hasOwnProperty("data"))f=encodeURIComponent(a.data);var h=a.hasOwnProperty("type")?a.type:"GET";var i=a.hasOwnProperty("type")?a.url:null;b.open(h,i,true);b.setRequestHeader("Cache-Control","no-cache");b.timeout=3e3;b.ontimeout=function(){e(b)};b.setRequestHeader("X-Requested-With","XMLHttpRequest");if(f)b.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");b.onreadystatechange=function(){if(b.readyState!=4)return;if(b.status!=200&&b.status!=304){e(b)}else d(b.responseText)};if(b.readyState==4){d(b);return}b.send(f)}},get:function(a){a.type="GET";return b.load(a)},post:function(a){a.type="POST";return b.load(a)},put:function(a){a.type="PUT";return b.load(a)},"delete":function(a){a.type="DELETE";return b.load(a)}}}();f=function(){function a(a){if(typeof $!=="undefined"){this.target=$(a);this.jQuery=true}else this.target=document.getElementById(a.replace("#",""))}a.bind=function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else if(a.attachEvent){a.attachEvent("on"+b,c)}};a.unbind=function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else if(a.detachEvent){a.detachEvent("on"+b,c)}};a.on=function(){a.bind.apply(a,arguments)};a.off=function(){a.bind.apply(a,arguments)};a.prototype.bind=function(b,c){a.bind(this.target,b,c)};a.prototype.unbind=function(b,c){a.unbind(this.target,b,c)};a.prototype.on=function(b,c){a.on(this.target,b,c)};a.prototype.off=function(b,c){a.off(this.target,b,c)};return a}();d=function(){var a=null,c=false,e=false,h=false,i=false;var j=function(){if(a!=null){clearTimeout(a);a=null}};var k=new g(null,d);var l=function(){if(navigator.onLine&&!h){e=true;h=true;d.fire("statusChange",1);return}j();a=setTimeout(function(){if(navigator.onLine&&!h){e=true;h=true;d.fire("statusChange",1)}else if(navigator.onLine){b.load({url:"ping.js",type:"GET",success:function(a){if(e===false){e=true;d.fire("statusChange",1)}},error:function(a){if(e===true){e=false;d.fire("statusChange",0)}}})}else{setTimeout(function(){if(e===true){e=false;d.fire("statusChange",0)}},100)}a=null;if(c)setTimeout(l,10*1e3)},h?100:0)};var n=function(a){m.debug("Cache: All resources for this app downloaded. You can run this application while not connected to the internet")};var o=function(){m.debug("Cache: Checking for cache manifest")};var p=function(){m.debug("Cache: Starting download of cached files")};var q=function(){m.debug("Cache: There was an error in the manifest, downloading cached files or you're offline")};var r=function(){m.debug("Cache: There was no update needed")};var s=function(){m.debug("Cache: Downloading cached files")};var t=function(){window.applicationCache.swapCache();m.debug("Cache: Updated cache has been loaded and is ready");window.location.reload(true)};return{on:function(a,b,c){var d=typeof c!=="undefined"?function(){b.apply(c,arguments)}:b;return k.on.call(k,a,d)},fire:function(){return k.fire.apply(k,arguments)},detach:function(){return k.detach.apply(k,arguments)},init:function(a){if(i)return;c=a;i=true;f.bind(window,"offline",l);f.bind(window,"online",l);f.bind(window,"cached",n);f.bind(window,"checking",o);f.bind(window,"downloading",p);f.bind(window,"error",q);f.bind(window,"noupdate",r);f.bind(window,"progress",s);f.bind(window,"updateready",t);l()},updateNetworkStatus:function(a){l()},isActive:function(){return i},isOnline:function(){return e}}}();o=function(){function e(){}var a=window.localStorage,b=false,c=false;if("localStorage"in window){try{window.localStorage.setItem("_test",1);b=true;window.localStorage.removeItem("_test")}catch(d){}}if(b){try{if(window.localStorage){a=window.localStorage}}catch(d){}}else if("globalStorage"in window){try{if(window.globalStorage){a=window.globalStorage[window.location.hostname];b=true}}catch(d){}}else{}if((typeof JSON==="undefined"||JSON.stringify==undefined)&&typeof $==="undefined"){b=false}if(!b)m.debug("localStorage not supported");e.get=function(d){if(!b)return;try{var e=JSON.parse(a.getItem(d));if(e!=undefined&&e.data!=undefined){if(c&&e.ttl!==-1&&(new Date).getTime()-e.timestamp>e.ttl){a.removeItem(d)}return e.data}}catch(f){m.error("Error fetching object from localStorage")}};e.set=function(c,d,e){if(!b)return false;c=c.replace(r,"");if(typeof d==="undefined")return false;var f={data:d,timestamp:(new Date).getTime(),ttl:e?e:24*60*60*1e3};try{a.setItem(c,JSON.stringify(f));return true}catch(g){if(g==QUOTA_EXCEEDED_ERR){m.error("Storage quota has been exceeded",g)}}return false};e.remove=function(c){if(!b)return false;a.removeItem(c)};e.flushExpired=function(d){if(!b)return;if(c===false&&d!==true)return;for(var f in a){e.get(f)}};e.flush=function(d){if(!b)return;if(c===false&&d!==true)return;a.clear();m.info("Clear: Local storage cleared")};e.isSupported=function(){return b};e.goOnline=function(){c=true};e.goOffline=function(){c=false};return e}();n=function(){function a(a){if(typeof io!=="undefined"){this.connection=io.connect(a)}else throw"Socket.io required"}a.prototype.on=function(){this.connection.on.apply(this.connection,arguments)};a.prototype.send=function(){this.connection.send.apply(this.connection,arguments)};a.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};return a}();l=function(){var a=null,b=null,c=60*60*1e3;return{fetch:function(c,d){if(!l.isExpired()){if(typeof c!=="undefined")c(a)}else{if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(d){b=(new Date).getTime();a=d.coords;m.debug("Location retrieved");if(typeof c=="function")c(d.coords)},function(a){switch(a.code){case a.TIMEOUT:m.error("Location services timeout");break;case a.POSITION_UNAVAILABLE:m.error("Position unavailable");break;case a.PERMISSION_DENIED:m.error("Please Enable Location Services");break;default:m.error("Unknown location services error");break}if(typeof a==="function")a()})}}},isExpired:function(){return(new Date).getTime()-b>c}}}();c=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";var a=navigator.userAgent.toLowerCase();if(a.search("iphone")>0)this.isMobile=true;else if(a.search("ipod")>0)this.isMobile=true;else if(a.search("android")>0)this.isMobile=true;else this.isMobile=false;if(a.search("ipad")>0)this.isTablet=true;else this.isTablet=false;if(navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i)){this.isScrollable=true}else this.isScrollable=false},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string;var d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};a.init();return{browser:a.browser,version:a.version,os:a.OS,isMobile:a.isMobile,isTablet:a.isTablet,isDesktop:!(a.isMobile||a.isTablet),isTouch:a.isMobile||a.isTablet,isScrollable:true}}();var t=function(){var a=arguments,b=a[0],c=typeof a[1]==="function"?a[1]:null,d=a[2];k.addModule(b,c,d)};var u=function(){var b=Array.prototype.slice.call(arguments),c=b[b.length-1],d=x(b).splice(0,b.length-1);if(typeof d[0]!="function"){for(var e=0,f=d.length;e<f;e++){k.loadModule(d[e])}}c.call(window,a)};var v=function(b){if(a[b]==undefined){a[b]={}}};a=this.Orange={};a.version="1.0.2";a.__import=this.__import=p;a.modules={};a.add=t;a.use=u;a.namespace=v;a.Ajax=b;a.Browser=c;a.Cache=d;a.Class=this.Class=e;a.Element=f;a.Events=g;a.EventTarget=j;a.Loader=k;a.Location=l;a.Log=this.Log=m;a.Socket=n;a.Storage=o}).call(this);Orange.add("mvc",function(a){var b,c,d,e,f,g,h,i,j,k,l,m=/[^A-Za-z:0-9_\[\]]/g;var n=__import("Cache"),o=__import("Storage"),p=__import("Loader"),q=__import("Location"),r=__import("Events"),s=__import("Ajax");b=Class.extend({initialize:function(a,b){this.name=a.replace(m);this.config=b;this.isOnline=false},launch:function(){for(var a=0,b=this.config.required.length;a<b;a++){p.loadModule(this.config.required[a])}if(this.config.hasOwnProperty("logging"))Log.setLevel(this.config.logging);n.on("statusChange",Class.proxy(function(a){if(a.data==1){o.goOnline();i.init();if(this.config.location)q.fetch();Log.debug('Application "'+this.name+'" online')}else{Log.debug('Application "'+this.name+'" offline');o.goOffline()}if(o.get("appversion")!==this.config.version){i.flush();o.set("appversion",this.config.version)}window.onload=Class.proxy(function(){this.onLaunch(a.data)},this)},this));n.init(this.config.poll)},onLaunch:function(a){},goOnline:function(){this.isOnline=true},goOffline:function(){this.isOnline=false},isOnline:function(){return this.isOnline}});d=Class.extend({initialize:function(){},destroy:function(){}});g=function(){var a={};var b=function(a){return $.ajax({async:false,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(){},error:function(){throw"Error: template not found"}}).responseText};return{load:function(c){if(typeof a[c]!=="undefined"){return a[c]}else if(typeof c!=="undefined"&&c!==""){return b(c)}else{throw"Invalid template path"}}}}();f=Class.extend({initialize:function(a){if(typeof a==="undefined")return;this.config=a},getName:function(){return(this.config||{}).hasOwnProperty("name")?this.config.name:"source"},supportsModels:function(){return false},isPersistent:function(){return false}});c=Class.extend({initialize:function(a,b){this.model=a;this.data=b;this.active=b;this.list=this.toArray()},getModel:function(){return this.model},count:function(){return this.list.length},get:function(a){return this.data.hasOwnProperty(a)?new this.model(this.data[a]):null},filter:function(a){if(typeof a==="function"&&this.active!==undefined){for(var b in this.active){if(!a.call(this,this.active[b]||{}))delete this.active[b]}}},clearFilters:function(){this.active=this.data},toArray:function(){var a=[];for(var b in this.active){a.push(this.active[b])}return a},toObject:function(){return this.active},getModel:function(){return this.model}});h=f.extend({request:function(a){if(n.isActive()&&!n.isOnline()){Log.warn("Could not connect to server");return}var b=typeof a.success==="function"?a.success:null;var c=typeof a.error==="function"?a.error:null;var d=typeof a.complete==="function"?a.complete:null;if(typeof a.context!=="undefined"){if(b)b=function(){b.apply(context,arguments)};if(c)c=function(){c.apply(context,arguments)};if(d)d=function(){d.apply(context,arguments)}}var e={url:a.url,type:a.type};if(a.hasOwnProperty("async"))e.async=a.async;if(a.hasOwnProperty("data"))e.data=a.data;if(a.hasOwnProperty("dataType"))e.dataType=a.dataType;if(a.hasOwnProperty("contentType"))e.contentType=a.contentType;if(b)e.success=b;if(c)e.error=c;if(d)e.complete;return s.load(e)}});j=f.extend({isPersistent:function(){return true},supportsModels:function(){return true},getPath:function(a){return this.getName()+":"+"model:"+a},getAll:function(a){return o.get(this.getPath(a))||undefined},get:function(a,b){var c=o.get(this.getPath(a))||{};return c.hasOwnProperty(b)?c[b]:undefined},setAll:function(a,b){if(b instanceof Array)throw"Invalid input, expecting object";return o.set(this.getPath(a),b)},set:function(a,b,c){if(b===null)b=this.nextKey(a);var d=o.get(this.getPath(a));d=d||{};d[b]=c;o.set(this.getPath(a),d);return b},remove:function(a,b){var c=o.get(this.getPath(a));delete c[b];o.set(this.getPath(a),c);return true},flush:function(a){o.remove(this.getPath(a))},nextKey:function(a){var b=0,c,d=[];var e=o.get(this.getPath(a));for(c in e){if(e.hasOwnProperty(c)&&!isNaN(c))d.push(parseInt(c,10))}return d.length>0?Math.max.apply(Math,d)+1:1}});PersistentStorageSource=f.extend({isPersistent:function(){return true},supportsModels:function(){return true},getPath:function(){return this.getName()+":"+"model"},getAllActions:function(){var a=o.get(this.getPath())||{},b={};for(var c in a){var d=e._models[c],f=a[c];for(var g in f){b[g]={model:d,item:f[g]}}}return b?b:null},getAll:function(a){var b=o.get(this.getPath());return typeof b!=="undefined"&&b.hasOwnProperty(a)?b[a]:null},get:function(a,b){var c=o.get(this.getPath());return typeof c!=="undefined"&&c.hasOwnProperty(a)?c[a].hasOwnProperty(b)?c[a][b]:null:null},setAll:function(a,b){if(b instanceof Array)throw"Invalid input, expecting object";var c=o.get(this.getPath());c[a]=b;return o.set(this.getPath(),c)},set:function(a,b,c){if(b===null)b=this.nextKey(a);var d=o.get(this.getPath())||{};if(!d.hasOwnProperty(a))d[a]={};d[a][b]=c;o.set(this.getPath(),d);return b},remove:function(a,b){var c=o.get(this.getPath());if(c&&c.hasOwnProperty(a)&&c[a].hasOwnProperty(b))delete c[a][b];else return null;o.set(this.getPath(),c);return true},flush:function(a){o.remove(this.getPath())},nextKey:function(a){var b=0,c,d=[];var e=o.get(this.getPath())||{};if(e.hasOwnProperty(a))e=e[a];else e[a]={};for(c in e){if(e.hasOwnProperty(c)&&!isNaN(c))d.push(parseInt(c,10))}return d.length>0?Math.max.apply(Math,d)+1:1}});k=h.extend({initialize:function(a){if(typeof a==="undefined")return;this.config=a;this.config.path=a.path.charAt(a.path.length-1)=="/"?a.path:a.path+"/";Log.info('Source "'+this.getName()+'" connected')},getPath:function(){return this.config.path},getDataType:function(){return this.config.hasOwnProperty("dataType")?this.config.dataType:"text/json"},getAll:function(a,b,c){var d=function(c){c=this.processItems(a,c);b.call(this,c)};this.request({url:this.getPath()+this.filterType(a),contentType:this.getDataType(),type:"GET",success:Class.proxy(d,this),error:c})},get:function(a,b,c,d){var e=function(b){b=this.processItem(a,b);c.call(this,b)};var f=this.getPath()+this.filterType(a);this.request({url:f.charAt(f.length-1)=="/"?f+b:f+"/"+b,contentType:this.getDataType(),type:"GET",success:Class.proxy(e,this),error:d})},set:function(a,b,c,d,e){var a=this.filterType(a);var f=Class.proxy(function(b){b=this.processItem(a,b);d.call(this,b)},this),g=this.getPath(),h;g=!b?g+a:g.charAt(g.length-1)=="/"?g+a+"/"+b:g+"/"+a+"/"+b;h={url:g,success:Class.proxy(f,this),error:e};if(!b){h["type"]="POST",h["data"]=c}else{h["type"]="PUT";h["data"]=JSON.stringify(c);h["contentType"]="application/json"}this.request(h)},remove:function(a,b,c,d){var e=this.getPath()+this.filterType(a);this.request({url:e.charAt(e.length-1)=="/"?e+b:e+"/"+b,type:"DELETE",success:function(a){c.call(this,JSON.parse(a))},error:d})},processItem:function(a,b){return this.filterItem(a,b)},processItems:function(a,b){var c=this.filterItems(a,b);var d=[];for(var e=0,f=c.length;e<f;e++){d.push(this.processItem(a,c[e]))}return d},filterItem:function(a,b){return JSON.parse(b)},filterItems:function(a,b){return JSON.parse(b)},filterType:function(a){return a}});e=Class.extend({initialize:function(a){this.getName();var b=this.constructor.getKey();this.isSaved=(a||{}).hasOwnProperty(b);this.id=this.isSaved?a[b]:null;this.data=a||{};if(a.hasOwnProperty("_unsaved"))this.isSaved=false},getName:function(){throw"Cannot instantiate model"},getFields:function(){throw"Cannot instantiate model"},getSource:function(){throw"Cannot instantiate model"},get:function(a){return this.data[a]},set:function(a,b){this.data[a]=b;this.isSaved=false},clear:function(){delete this.data[name];this.isSaved=false},refresh:function(){var a=this.constructor.get(this.getId());this.data=a.toObject();this.isSaved=true},save:function(a,b,c){if(this.isSaved)return;var d=function(b){this.isSaved=true;if(typeof a==="function")a(b)};this.constructor.set(this.data,Class.proxy(d,this),b,c)},remove:function(a,b,c){if(this.exists()){this.constructor.remove(this.id,a,b,c)}this.destroy()},mergeChanges:function(a){},isSaved:function(){return this.isSaved},exists:function(){return this.id!==null},getId:function(){return this.id},getModel:function(){return this.constructor},toObject:function(){return this.data},destroy:function(){this.isSaved=false;this.id=null;this.data={}}});e.getKey=function(){var a=this.getFields();for(var b in a){if(a[b].hasOwnProperty("primaryKey"))return b}};e.getId=function(){var a=this.getFields();for(var b in a){if(a[b].hasOwnProperty("primaryKey"))return a[b].name}};e.getAll=function(a,b,d,f){var f=typeof f==="function"?f:this;var g=function(d){var g=e.mapItems.call(this,d),h={};if(typeof a==="function"){for(var i in g){if(a==null||a.call(this,g[i])){h[i]=g[i]}}g=h}b.call(f,new c(this,g))};i.getAll(this,Class.proxy(g,this),Class.proxy(d,f))};e.get=function(a,b,c,d){var d=typeof d==="function"?d:this;var f=function(a){var c=e.mapItem.call(this,a);b.call(d,new this(c))};i.get(this,a,Class.proxy(f,this),Class.proxy(c,d))};e.set=function(a,b,c,d){if(a instanceof e)a=a.toObject();var f=a.hasOwnProperty(this.getKey())?a[this.getKey()]:null;var d=typeof d==="function"?d:this;var g=function(a){var c=e.mapItem.call(this,a);b.call(d,new this(c))};i.set(this,f,e.unmapItem.call(this,a),Class.proxy(g,this),Class.proxy(c,d))};e.remove=function(a,b,c,d){var d=typeof d==="function"?d:this,e=a;var f=function(a){b.call(d,e)};i.remove(this,a,Class.proxy(f,this),Class.proxy(c,d))};e.on=function(a,b,c){var d=typeof c!=="undefined"?function(){b.apply(c,arguments)}:b;return this.events.on.call(this.events,a,d)},e.fire=function(){return this.events.fire.apply(this.events,arguments)},e.detach=function(){return this.events.detach.apply(this.events,arguments)},e.mapItem=function(a){var b={},c=this.getFields();for(var d in c){var e=c[d].name,f=a.hasOwnProperty(e)&&a[e]!=null?a[e]:undefined;if(f===undefined&&!c[d].nullable){Log.warn("Could not parse JSON field '"+d+"' for "+this.getName());continue}else if(f!==undefined)b[d]=f}return b},e.mapItems=function(a){var b={},c=this.getKey();for(var d in a){var f=e.mapItem.call(this,a[d]);if(typeof f==="object")b[d]=f}return b},e.unmapItem=function(a){var b={},c=this.getFields();for(var d in c){if(this.getKey()==d&&!a.hasOwnProperty(this.getKey())){continue}var e=c[d].name,f=a.hasOwnProperty(d)?a[d]:undefined;if(f===undefined&&!c[d].nullable){Log.warn("Missing data for field '"+d+"' for "+this.getName());continue}else if(f!==undefined)b[e]=f}return b};e._models={};e.extend=function(a){var b=Class.extend.call(this,a);var c=["getName","getId","getFields","getSource"];for(var d=0,f=c.length;d<f;d++){if(!a.hasOwnProperty(c[d]))throw"Class missing '"+c[d]+"()' implementation";b[c[d]]=a[c[d]]}var g=a.getSource();if(!g.supportsModels())throw"Source '"+g.getName()+"' does not support models";b.events=new r(null,this);b.getKey=function(){return e.getKey.apply(b,arguments)};b.getAll=function(){return e.getAll.apply(b,arguments)};b.get=function(){return e.get.apply(b,arguments)};b.set=function(){return e.set.apply(b,arguments)};b.remove=function(){return e.remove.apply(b,arguments)};b.on=function(){return e.on.apply(b,arguments)};b.fire=function(){return e.fire.apply(b,arguments)};b.detach=function(){return e.detach.apply(b,arguments)};e._models[b.getName()]=b;return b};i=function(){function c(){}var a=false,b=false;c.init=function(){b=!(n.isActive()&&!n.isOnline());this.cacheDS=new j({name:"cache"});this.createDS=new PersistentStorageSource({name:"create"});this.updateDS=new PersistentStorageSource({name:"update"});this.deleteDS=new PersistentStorageSource({name:"delete"});this.pendingDS=new PersistentStorageSource({name:"pending"});n.on("statusChange",Class.proxy(this.onStatusChange,this))};c.getAll=function(c,d,e){var f=function(b){var e=this.createDS.getAll(c.getName()),f=this.updateDS.getAll(c.getName()),g=this.deleteDS.getAll(c.getName()),h=this.pendingDS.getAll(c.getName());for(var i in e){var j=e[i];j[c.getId()]="c"+i;b["c"+i]=j}for(var i in f)b[i]=f[i];for(var i in g)delete b[i];if(a)for(var i in h)b[h[c.getId()]]=h[i];d(b)};var g=function(a){var b={};for(var e=0,f=a.length;e<f;e++){b[a[e][c.getId()]]=a[e]}this.cacheDS.setAll(c.getName(),b);d.call(this,b)};if(!b){var h=this.cacheDS.getAll(c.getName());if(h!=undefined)f.call(this,h);else e.call(this)}else c.getSource().getAll(c.getName(),Class.proxy(g,this),e)};c.get=function(c,d,e,f){var g=function(b){var f=this.createDS.getAll(c.getName()),g=this.updateDS.getAll(c.getName()),h=this.deleteDS.getAll(c.getName()),i=this.pendingDS.getAll(c.getName()),j=null;if(a){for(var k in i){if(i[k].hasOwnProperty(c.getId())&&i[k][c.getId()]==d)j=i[k]}}if(f&&f.hasOwnProperty(d))j=f[d];if(g&&g.hasOwnProperty(d)&&j==null)j=g[d];if(h&&h.hasOwnProperty(d))throw"Cannot fetch deleted item";e(!j?b:j)};var h=function(a){this.cacheDS.set(c.getName(),d,a);e(a)};var i=function(a){if(a.status=="404"){this.cacheDS.remove(c.getName(),d)}f(a)};if(!b){var j=this.cacheDS.get(c.getName(),d);if(j!=undefined)g.call(this,j);else f.call(this)}else c.getSource().get(c.getName(),d,Class.proxy(h,this),Class.proxy(i,this))};c.set=function(c,d,e,f,g){var h=function(a){a["_unsaved"]=true;f(a)};var i=function(a){this.cacheDS.set(c.getName(),a[c.getId()],a);f(a)};if(!b){if(!d){var d="c"+this.createDS.set(c.getName(),null,e);if(!d)g();else{e[c.getId()]=d;h(e)}}else if(a){var j=this.deleteDS.getAll(c.getName());if(j&&j.hasOwnProperty(d)){throw"Cannot update already removed item"}else{this.pendingDS.set(c.getName(),null,e);h.call(this,e)}}else{var k=this.createDS.getAll(),j=this.deleteDS.getAll();if(k&&k.hasOwnProperty(d))this.createDS.set(c.getName(),d,e);else if(j&&j.hasOwnProperty(d))throw"Cannot update already removed item";else this.updateDS.set(c.getName(),d,e);h.call(this,e)}}else c.getSource().set(c.getName(),d,e,Class.proxy(i,this),g)};c.remove=function(a,c,d,e){var f=function(b){this.cacheDS.remove(a.getName(),c);d(b)};if(!b){var g=this.createDS.getAll(a.getName()),h=this.updateDS.getAll(a.getName()),i=this.deleteDS.getAll(a.getName());if(g&&g.hasOwnProperty(c))this.createDS.remove(a.getName(),c);if(h&&h.hasOwnProperty(c))this.updateDS.remove(a.getName(),c);if(i&&i.hasOwnProperty(c))throw"Cannot delete already removed item";else this.deleteDS.set(a.getName(),c,{});d(c)}else a.getSource().remove(a.getName(),c,Class.proxy(f,this),e)};c.flush=function(){this.createDS.flush(true);this.updateDS.flush(true);this.deleteDS.flush(true);this.pendingDS.flush(true)};c.onStatusChange=function(c){if(c.data==1&&!a){this.onSync()}else{if(a){this.onSyncFailure.call(this)}else{b=!(n.isActive()&&!n.isOnline())}}};c.onSync=function(b){if(a&&!b)return;a=true;var c=function(a,b,c,d){this.createDS.remove(c,b);this.cacheDS.set(c,d,a);this.syncCount--;this.checkSyncStatus()};var d=function(a,b,c){this.updateDS.remove(c,b);this.cacheDS.set(c,b,a);this.syncCount--;this.checkSyncStatus()};var e=function(a,b){this.deleteDS.remove(b,a);this.cacheDS.remove(b,a);this.syncCount--;this.checkSyncStatus()};var f=this.createDS.getAllActions(),g=this.updateDS.getAllActions(),h=this.deleteDS.getAllActions();this.syncCount=f.length+g.length+h.length;for(var i in f){var j=f[i].model;j.getSource().set(j.getName(),null,f[i].item,Class.proxy(function(a){var b=i;console.log("create");c.call(this,a,b,j.getName(),a[j.getId()])},this),this.onSyncFailure)}for(var i in g){var j=g[i].model;j.getSource().set(j.getName(),i,g[i].item,Class.proxy(function(a){var b=i;console.log("update");d.call(this,a,b,j.getName())},this),this.onSyncFailure)}for(var i in h){var j=h[i].model;j.getSource().remove(j.getName(),i,null,Class.proxy(function(a){var b=i;console.log("delete");e.call(this,b,j.getName())},this),this.onSyncFailure)}};c.onSyncSuccess=function(){a=false;b=!(n.isActive()&&!n.isOnline());Log.info("Unsaved data pushed to server.")};c.onSyncFailure=function(){Log.info("Could not push unsaved data to server.")};c.checkSyncStatus=function(){console.log("checking");if(this.syncCount==0){var a=this.pendingDS.getAllActions();if(a.length>0){for(var b in a){var d=a[b].model,e=a[b].item;if(e.hasOwnProperty(d.getId()))var f=e[d.getId()];else throw"Pending item missing id";this.updateDS.set(d.getName(),e,f);this.pendingDS.remove(d.getName(),f)}this.onSync(true)}else c.onSyncSuccess.call(this)}};c.destroy=function(){n.detach("statusChange",this.proxy)};return c}();a.Application=b;a.Collection=c;a.Controller=d;a.Model=e;a.Source=f;a.View=g;a.AjaxSource=h;a.LocalStorageSource=j;a.RestSource=k;a.PersistenceManager=i;a.PersistentStorageSource=PersistentStorageSource},[],"1.0.2");Orange.add("ui",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;var o=__import("Application"),p=__import("Events"),q=__import("Model"),r=__import("Collection");o.prototype.onLaunch=function(a){var b=$('[data-root="true"]'),c=b.attr("data-control"),d=b.attr("data-name");if(typeof c==="undefined"||typeof d==="undefined")throw"Root view not found";b.removeAttr("data-root");var e=n.get(c);var f=new e(null,b);f.on("load",function(){f.show()});f.load()};b=Class.extend({initialize:function(a){this.node=a;this.template=a.clone();this.eventTarget=new p(null,this);this.loaded=false},bindData:function(a,b){if(this.loaded)return;this._bindData(this.node,a);this.loaded=true},_bindData:function(a,b,c){if(b instanceof q){var c=b.getId(),d=b.toObject()}else if(typeof b!=="undefined"){d=b,c=c}else{Log.error("Invalid model item");return}if(c)a.attr("itemid",c);for(var e in d){var f=a.find('[itemprop="'+e+'"]');var g=[];a.find('[itemprop="'+e+'"]').each(function(){var b=false,c=$(this).parent();while(c.length!==0&&!b){if($(c).not(a).length===0){b=true;break}else if($(c).not("[itemscope]").length===0){b=false;break}c=$(c).parent()}if(b)g.push($(this))});if(g.length>0){for(var h=0,i=g.length;h<i;h++){if(d[e]instanceof Array||d[e]instanceof r){this._bindList(g[h],d[e])}else if(typeof d[e]==="object"||d[e]instanceof q){this._bindData(g[h],d[e])}else g[h].text(d[e])}}}},bindList:function(a,b){if(this.loaded)return;this._bindList(this.node,a);this.loaded=true},_bindList:function(b,c){var d=$(b).find("[itemscope]");if(!d.length)return;var e=d.clone(),f=b.clone().empty();if(c instanceof a.Collection){var g=c.toObject();for(var h in g){var i=e.clone();this._bindData(i,g[h],h);f.append(i)}}else if(c instanceof Array){var g=c;for(var h=0,j=g.length;h<j;h++){var i=e.clone();this._bindData(i,g[h]);f.append(i)}}b.replaceWith(f)},clear:function(){this.node.replaceWith(this.template.clone());this.loaded=false}});c=Class.extend({initialize:function(a){var b=this,c=$(a).attr("name");this.fields={};this.target=a;$(a).find("input, select, textarea, button .ui-input").each(function(){var a=$(this).attr("name");b.fields[a]=$(this)})},getField:function(a){if(typeof this.fields[a]!=="undefined"){return this.fields[a]}else{throw"Error: Form field '"+a+"' not found"}},setField:function(a,b){try{this.getField(a).val(b)}catch(c){Log.warn('[WARN] Field "'+a+'" could not be fetched')}},getData:function(){var a={};for(var b in this.fields){var c=this.fields[b].val(),d=this.fields[b].attr("type");if(typeof c!==undefined&&c!==null&&d!=="submit"&&d!=="button"){a[b]=c}}return a},setData:function(b){var c=b;if(b instanceof a.Item)c=b.toObject();for(var d in this.fields){if(typeof c[d]!==undefined&&c[d]!==null){this.fields[d].val(c[d])}}},detach:function(){for(var a in this.fields){this.fields[a].detach()}},destroy:function(){for(var a in this.fields){delete this.fields[a]}}});var n=a.Controller.extend({initialize:function(b,c){var d=this,e=[],f=[],g=[];this.loading=false;this.unloading=false;this.loaded=false;this.visible=false;this.appearing=false;this.disappearing=false;this.changing=false;this.loadEvts=[];this.unloadEvts=[];this.showEvts=[];this.hideEvts=[];this.views={};this.forms={};this.elements={};this.events=[];this.data={};this.source=c.clone();this.eventTarget=new a.Events(b,this);if(typeof c!=="undefined"){this.target=$(c);var h=$(c).get(0)}else throw"Invalid target";this.parent=typeof b!=="undefined"?b:null;if(this.parent===null)this.target.removeAttr("data-root");for(var i=0,j=h.attributes.length;i<j;i++){if(h.attributes[i].name.match(/data-/)){this.data[h.attributes[i].name.replace(/data-/,"")]=h.attributes[i].value}}var k=function(a){var b=[];this.target.find(a).each(function(){var a=false,c=$(this).parent();while(c.length!==0&&!a){if($(c).not($(d.target)).length===0){a=true;break}else if($(c).not("[data-control]").length===0){a=false;break}c=$(c).parent()}if(a)b.push(this)});return b};e=k.call(this,"[data-control]");f=k.call(this,"form");g=k.call(this,"[data-name]:not([data-control])");console.log(this.data.name+" "+"Initialized");for(var i=0,j=e.length;i<j;i++){var l=$(e[i]),m=l.attr("data-name"),o=l.attr("data-control"),p=l.attr("data-template"),q=typeof p!=="undefined"&&p.length>0;if(q){var r=a.View.load(p);l.html($(r).html());cloneAttributes(r,l);l.removeAttr("data-template")}var s=n.get(o);this.views[m]=new s(this,l)}for(var i=0,j=f.length;i<j;i++){var t=$(f[i]),m=t.attr("name"),u=new a.Form(t);this.forms[m]=u}for(var i=0,j=g.length;i<j;i++){var v=$(g[i]),m=v.attr("data-name");if(typeof m!=="undefined"&&m.length>0)this.elements[m]=v.removeAttr("data-name")}this.target.addClass(this.getClasses());this.target.removeAttr("data-control").removeAttr("data-name");this.type=this.getType();this.name=this.data.name},getType:function(){return"ui-view"},getClasses:function(){var a=typeof this.typeList!=="undefined"?this.typeList:"";return a+" "+this.data.name},getTriggers:function(){return[]},getBindings:function(){return{}},load:function(){if(this.loading||this.loaded)return;this.loading=true;this.loadEvts.push(this.on("_load",this.onLoad,this));this.loadEvts.push(this.on("_loaded",this.onDidLoad,this));this.onWillLoad()},onWillLoad:function(){console.log(this.data.name+" "+"Will Load");this.fire("_load")},onLoad:function(){for(var a in this.views){this.views[a].load()}console.log(this.data.name+" "+"Load");this.fire("_loaded")},onDidLoad:function(){for(var a=0,b=this.loadEvts.length;a<b;a++){this.loadEvts[a].detach()}console.log(this.data.name+" "+"Did Load");this.loadEvts=[];this.loading=false;this.loaded=true;this.fire("load")},unload:function(){if(this.unloading||!this.loaded)return;if(this.visible&&!this.disappearing){this.vEvt=this.on("disappear",function(a){this.unload();this.vEvt.detach()},this);this.hide();return}this.unloadEvts.push(this.on("_unload",this.onUnload,this));this.unloadEvts.push(this.on("_unloaded",this.onDidUnload,this));this.unloading=true;this.onWillUnload()},onWillUnload:function(){console.log(this.data.name+" "+"Will Unload");this.fire("_unload")},onUnload:function(){for(var a in this.views){this.views[a].unload()}console.log(this.data.name+" "+"Unload");this.fire("_unloaded")},onDidUnload:function(){console.log(this.data.name+" "+"Did Unload");for(var a=0,b=this.unloadEvts.length;a<b;a++){this.unloadEvts[a].detach()}this.unloadEvts=[];this.unloading=false;this.loaded=false;this.fire("unload")},show:function(){if(this.visible||this.appearing)return;this.appearing=true;this.showEvts.push(this.on("_appear",this.onAppear,this));this.showEvts.push(this.on("_appeared",this.onDidAppear,this));this.onWillAppear()},onWillAppear:function(){console.log(this.data.name+" "+"Will Appear");var b=this.getBindings();for(var c in b){var d=b[c];for(var e in d){var f=typeof d[e]==="function"?d[e]:null;if(e=="touchclick")e=a.Browser.isTouch?"touchend":"click";if(f===null){var g=e.charAt(0).toUpperCase()+e.slice(1);f=d[e]===true&&typeof this["on"+g]==="function"?this["on"+g]:null}if(f!==null&&this.views.hasOwnProperty(c)){this.getView(c).on(e,$.proxy(f,this))}else if(f!==null&&this.elements.hasOwnProperty(c)){this.getElement(c).on(e,$.proxy(f,this))}}}this.fire("_appear")},onAppear:function(){for(var a in this.views){this.views[a].show()}console.log(this.data.name+" "+"Appear");this.fire("_appeared")},onDidAppear:function(){console.log(this.data.name+" "+"Did Appear");for(var a=0,b=this.showEvts.length;a<b;a++){this.showEvts[a].detach()}this.showEvts=[];this.appearing=false;this.visible=true;this.fire("appear")},hide:function(){if(!this.visible||this.disappearing)return;this.disappearing=true;this.hideEvts.push(this.on("_disappear",this.onDisappear,this));this.hideEvts.push(this.on("_disappeared",this.onDidDisappear,this));this.onWillDisappear()},onWillDisappear:function(){console.log(this.data.name+" "+"Will Disappear");for(var a in this.views){this.getView(a).detach()}for(var b in this.forms){this.getForm(b).detach()}for(var c in this.elements){this.getElement(c).unbind()}this.fire("_disappear")},onDisappear:function(){for(var a in this.views){this.views[a].hide()}console.log(this.data.name+" "+"Disappear");this.fire("_disappeared")},onDidDisappear:function(){console.log(this.data.name+" "+"Did Disappear");for(var a=0,b=this.hideEvts.length;a<b;a++){this.hideEvts[a].detach()}this.hideEvts=[];this.disappearing=false;this.visible=false;this.fire("disappear")},getView:function(a){if(a instanceof n)return a;else if(typeof this.views[a]!=="undefined")return this.views[a];throw'Error: View "'+a+'" not found'},getForm:function(a){if(this.forms[a]instanceof c)return this.forms[a];throw'Error: Form "'+a+'" not found'},getElement:function(a){if(typeof this.elements[a]!=="undefined")return this.elements[a];throw'Error: Element "'+a+'" not found'},hasView:function(a){return typeof this._views[a]!=="undefined"},hasForm:function(a){return typeof this._forms[a]!=="undefined"},hasElement:function(a){return typeof this._elements[a]!=="undefined"},on:function(a,b,c){var d=typeof c!=="undefined"?function(){b.apply(c,arguments)}:b;return this.eventTarget.on.call(this.eventTarget,a,d)},detach:function(a,b){return this.eventTarget.detach.apply(this.eventTarget,arguments)},fire:function(a,b){return this.eventTarget.fire.apply(this.eventTarget,arguments)},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},find:function(a){return $(this.target).find(a)},destroy:function(){for(var a in this._views){this.views[a].destroy()}for(var a in this._forms){this.forms[a].destroy()}for(var a in this._elements){delete this.elements[a]}delete this.target;delete this.parent;delete this.eventTarget}});n.views={view:n};n.prototype.typeList="";n.extend=function(a){var b=Class.extend.call(this,a),c=a.getType();var d=["getType"];for(var e=0,f=d.length;e<f;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";b[d[e]]=a[d[e]]}b.prototype.typeList+=(b.prototype.typeList==""?"":" ")+c;b.extend=arguments.callee;return n.views[c]=b};n.get=function(a){if(!this.views.hasOwnProperty(a))throw"View '"+a+'" not found';return this.views[a]};i=n.extend({getType:function(){return"multi-view"},initialize:function(a,b){this._super(a,b);this.defaultView=this.target.attr("data-default");this.target.removeAttr("data-default")},onLoad:function(){for(var a in this._views){if(this._views[a].name!==this.defaultView){this._views[a].target.hide()}else{this.activeView=this._views[a]}}this._super()},activateView:function(b){var c=this.getView(b);if(c instanceof a.ViewController){this.activeView.target.hide();this.activeView=c;this.activeView.target.show()}},getActiveView:function(){return this.activeView.name}});a.Binding=b;a.Form=c;a.MultiViewController=i;a.ViewController=n},["mvc"],"1.0.2")