/**
 * OrangeUI | 0.5.0 | 09.12.2012
 * https://github.com/brew20k/orangeui
 * Copyright (c) 2012 Kevin Kinnebrew
 */
function noop(){}function clone(e){var t,n=e instanceof Array?[]:{};for(t in e){if(t==="clone")continue;e[t]&&e[t]instanceof Date?n[t]=new Date(e[t]):e[t]&&typeof e[t]=="object"?n[t]=clone(e[t]):n[t]=e[t]}return n}function proxy(e,t){var n=t;return function(){return e.apply(n,arguments)}}function firstChildren(e,t){var n=[];return e.find(t).each(function(){var t=!1,r=$(this).parent();while(r.length!==0&&!t){if($(r).not($(e)).length===0){t=!0;break}if($(r).not("[data-control]").length===0){t=!1;break}r=$(r).parent()}t&&n.push($(this))}),n}jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},function(){function c(){function r(){--t===0&&e.resolve()}var e=new n(this),t=arguments.length;for(var i=0;i<arguments.length;i++)arguments[i].then(r);return e}function h(){var e=arguments,t=e[0],n=typeof e[1]=="function"?e[1]:null,r=e[2];a.Loader.addModule(t,n,r)}function p(){var e=Array.prototype.slice.call(arguments),t=e[e.length-1],n=clone(e).splice(0,e.length-1);if(typeof n[0]!="function")for(var r=0,i=n.length;r<i;r++)a.Loader.loadModule(n[r]);t.call(window,a)}function d(e){if(typeof a.modules[e]!==undefined)return a.modules[e];throw"Could not require module"}var e,t,n,r,i,s,o,u,a={},f=/[^A-Za-z:0-9_\[\]]/g,l=/[^A-Za-z\-_]/g;t=function(){function n(){}var e=!1,t=/\b_super\b/;return n.extend=function(r){function u(){!e&&this.initialize&&this.initialize.apply(this,arguments)}var i,s,o=this.prototype;e=!0,i=new this,e=!1;for(s in r)i[s]=typeof r[s]=="function"&&typeof o[s]=="function"&&t.test(r[s])?function(e,t){return function(){var n=this._super;this._super=o[e];var r=t.apply(this,arguments);return this._super=n,r}}(s,r[s]):r[s];return u.prototype=i,u.prototype.constructor=u,u.extend=n.extend,u.include=n.include,u},n.include=function(e){var t,n,r;if(!e)throw"Missing definition";for(t in e)n=e[t],Array.prototype.indexOf.call(["extend","mixin"],t)<0&&(this.prototype[t]=n);return this},n}(),i=function(){function e(e,t,n,r){this.bubbles=!0,this.currentTarget=t,this.data=r,this.target=n,this.type=e}return e.prototype.stopPropagation=function(){this.bubbles=!1},e}(),s=function(){function e(e,t,n){this.call=n,this.ev=t,this.target=e}return e.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call},e}(),r={on:function(e,t,n){var r=typeof n!="undefined"?proxy(t,n):t;return this._listeners||(this._listeners={}),this._listeners.hasOwnProperty(e)||(this._listeners[e]=[]),this._listeners[e].push(r),new s(this,e,r)},once:function(e,t,n){var r=typeof n!="undefined"?proxy(t,n):t,i=function(){t.apply(this,arguments),this.detach(e,r)};this.on(e,i)},fire:function(e,t){var n=this.parent||null,r=e;typeof e=="string"&&(e=new i(e,this,this,t));if(typeof e.type!="string")throw"Error: Invalid 'type' when firing event";this._listeners||(this._listeners={});if(this._listeners[e.type]instanceof Array){var s=this._listeners[e.type];for(var o=0,u=s.length;o<u;o++)s[o].call(this,e,t)}n!=null&&e.bubbles&&r[0]!=="_"&&(e.currentTarget=this.parent,n.fire.call(n,e,t))},detach:function(e,t){var n=[];this._listeners||(this._listeners={});if(typeof e=="undefined")this._listeners={};else if(this._listeners[e]instanceof Array)if(typeof t!="undefined"){n=this._listeners[e];for(var r=0,i=n.length;r<i;r++)if(n[r]===t){n.splice(r,1);break}}else this._listeners[e]=[]}},o=function(){var e={},t={},n={};return a.modules={},{addModule:function(t,n,r){if(!t.match(/[\^\-A-Za-z_]/g))throw"Invalid module name";var i={name:t,fn:n,req:r!==undefined?r:[]};e[t]=i},loadModule:function(r){if(t.hasOwnProperty(r))return;if(e[r]!==undefined){t[r]=!0;for(var i=0,s=e[r].req.length;i<s;i++){if(e[r].req[i]===r)continue;this.loadModule(e[r].req[i])}e[r].fn.call(window,n),a.modules[r]=n}}}}(),u=function(){function t(t,n,r){this.level>t&&(this.fire("msg",{message:n,ex:r}),r?console.log("["+e[t]+"]",n,r):console.log("["+e[t]+"]",n))}function n(){this.level=1}var e=["OFF","ERROR","WARN","INFO","DEBUG"];for(var i in r)n[i]=r[i];return n.prototype.setLevel=function(t){if(t in e)switch(t){case"DEBUG":t=4;break;case"INFO":t=3;break;case"WARN":t=2;break;case"ERROR":t=1;break;default:t=0}},n.prototype.debug=function(e,n){t.call(this,4,e,n)},n.prototype.info=function(e,n){t.call(this,3,e,n)},n.prototype.warn=function(e,n){t.call(this,2,e,n)},n.prototype.error=function(e,n){t.call(this,1,e,n)},n}(),n=function(){function e(e){this.context=e,this.resolved=!1,this.bindings=[]}return e.prototype.resolve=function(){this.resolved=!0;for(var e=0;e<this.bindings.length;e++)this.bindings[e].fn.apply(this.context,this.bindings[e].args);this.bindings=[]},e.prototype.then=function(e,t){this.resolved?e.apply(this.context,t||[]):this.bindings.push({fn:e,args:t||[]})},e}(),_||(_={}),_.deferEach=function(e,t,r){var i=[],s;if(typeof t!="function")return;for(var o=0,u=e.length;o<u;o++)s=t.call(r,e[o],o,e),s instanceof n&&i.push(s);return a.when.call(r,i)},e={touch:"ontouchstart"in window||window.hasOwnProperty("DocumentTouch")&&document instanceof DocumentTouch,location:"geolocation"in navigator},a=this.Orange={modules:{}},a.version="0.5.0",a.add=h,a.use=p,a.include=this.include=d,a.when=c,a.Browser=e=e,a.Class=this.Class=t,a.Deferred=n,a.Events=this.Events=r,a.EventHandle=s,a.Loader=o,a.Log=this.Log=new u}.call(this),Array.prototype.clone=function(){return this.slice(0)},Array.prototype.indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},Array.prototype.first=[].first||function(){return this.length?this[0]:null},Array.prototype.last=[].last||function(){return this.length?this[this.length-1]:null},function(e){function u(){n!==null&&(clearTimeout(n),n=null)}function a(e){var o=Math.floor(Math.random()*1e4);if(navigator.onLine&&!s){i=!0,s=!0,t.fire("online",!0),e&&e(!0),r&&setTimeout(a,1e4);return}u(),n=setTimeout(function(){navigator.onLine&&!s?(i=!0,s=!0,t.fire("online",!0)):navigator.onLine?$.ajax({url:"ping.js?q="+o,type:"GET",success:function(){i===!1&&(i=!0,t.fire("online",!0))},error:function(){i===!0&&(i=!1,t.fire("online",!1))}}):setTimeout(function(){i===!0&&(i=!1,t.fire("online",!1))},100),n=null,r&&setTimeout(a,1e4)},s?100:0)}function f(){window.applicationCache.swapCache(),Log.debug("Cache updated and ready"),window.location.reload(!0)}var t={},n=null,r=!1,i=!1,s=!1,o=!1;for(var l in Events)t[l]=Events[l];t.init=function(e,n){if(o)return;r=!1,o=!0,$(window).bind("offline",a),$(window).bind("online",a),$(window).bind("updateready",f),a.call(t,proxy(e,n))},t.updateNetworkStatus=function(e){a.call(t)},t.isActive=function(){return o},t.isOnline=function(){return i},e.Cache=t}(Orange),function(e){var t,n=e.Model;t=Class.extend({initialize:function(e){var t=this,r,i;this.target=e,this.fields={},this.target.find("input, select, textarea, checkbox").not('input[type="submit"]').not('input[type="button"]').each(function(){var e=$(this).attr("name");e&&(t.fields[e]=$(this))}),r=this.target.attr("data-model"),r&&(i=n.load(r),i&&this.build(i)),this.target.submit(proxy(this.$onSubmit,this))},get:function(e){if(this.fields.hasOwnProperty(e))return this.fields[e].val()},set:function(e,t){this.fields.hasOwnProperty(e)&&this.fields[e].val(t)},clear:function(e){this.fields.hasOwnProperty(e)&&this.fields[e].val("")},disable:function(){for(var e in this.fields)this.fields[e].attr("disabled","disabled")},enable:function(){for(var e in this.fields)this.fields[e].removeAttr("disabled")},build:function(e){var t=e.getSchema()},getData:function(){var e={};for(var t in this.fields)e[t]=this.fields[t].val();return e},setData:function(e){for(var t in this.fields)e.hasOwnProperty(t)&&this.fields[t].val(e[t])},$onSubmit:function(e){var t=this.target.attr("action");if(typeof t!="undefined")return;e.preventDefault(),this.fire("submit",this.getData())},destroy:function(){for(var e in this.fields)delete this.fields[e]}}).include(Events),e.Form=t}(Orange),function(e){function o(){return(new Date).getTime()-i>s}function u(e,t){i=(new Date).getTime(),r=t.coords,typeof e=="function"&&e(t.coords)}function a(e){switch(e.code){case e.TIMEOUT:Log.warn("Location services timeout");break;case e.POSITION_UNAVAILABLE:Log.warn("Position unavailable");break;case e.PERMISSION_DENIED:Log.warn("Please Enable Location Services");break;default:Log.info("Unknown location services error")}}var t={},n=e.Browser,r=null,i=null,s=36e5;t.get=function(e,t){if(!n.location){t.call(this);return}if(typeof e!="function")return;if(r&&!o())return e(r);var i=function(e){a(e),t&&t.call(this)},s=function(t){u(e,t)};navigator.geolocation.getCurrentPosition(s,i)},e.Location=t}(Orange),function(e){var t,n=e.Collection,r=e.Events;t=Class.extend({initialize:function(e){var t=this.getKey();this._source=e||{},this._id=null,this._data={},this._changed=!1,this.processData(e)},getType:function(){throw"Cannot instantiate model"},getItemType:function(){return null},getKey:function(){var e=this.getFields();for(var n in e)if(e[n].type===t.Field.KEY)return n},getFields:function(){throw"Cannot instantiate model"},processData:function(e,n){var r=[],i=!1,s=this.getFields();for(var o in s){i=s[o].type===t.Field.KEY;if(e.hasOwnProperty(o)&&typeof e[o]!="undefined")i?(this._id=t.clean(e[o],s[o]),r.push({action:"set",name:o,value:this._id})):(this._data[o]=t.clean(e[o],s[o]),r.push({action:"set",name:o,value:this._data[o]}));else if(s[o].hasOwnProperty("required")&&s[o].required||i&&!n)throw'Field Missing: "'+o+'" on model "'+this.getType()+'"'}return r},get:function(e){var t=this.getFields();if(!t.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';return this._data[e]},set:function(e,n){var r=this.getFields();if(!r.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';n=t.clean(n,r[e]);if(typeof n=="undefined")throw'Invalid Input: Value is undefined for field "'+e+'"';this._data[e]=n,this._changed=!0,this.fire("change",[{action:"set",name:e,value:n}])},clear:function(e){var t=this.getFields();if(!t.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';delete this._data[e],this._changed=!0,this.fire("change",[{action:"clear",name:e}])},update:function(e){var t=this.getKey();e.hasOwnProperty(t)&&e[t]!==this._id&&this.fire("change",[{action:"id",name:t,value:e[t]}]);var n=this.processData(e,!0);this.fire("change",n)},clone:function(){return new this.constructor(this._source)},getId:function(){return this._id},getModel:function(){return this.constructor},isChanged:function(){return this._changed},toObject:function(){var e=clone(this._data);return e[this.getKey()]=this._id,e},destroy:function(){delete this._id,delete this._data,delete this._changed}}).include(r),t.get=function(e){if(t.models.hasOwnProperty(e))return t.models[e];throw'No model exists with name "'+e+'"'},t.registerType=function(e,n){t.hasOwnProperty("types")||(t.types={}),t.types[e]=n},t.clean=function(e,n){return t.hasOwnProperty("types")||(t.types={}),t.types.hasOwnProperty(n.type)&&typeof t.types[n.type]=="function"?t.types[n.type].call(this,e,n):e},t.extend=function(e){var n=Class.extend.call(this,e),r=["getType","getFields"];for(var i=0;i<r.length;i++){if(!e.hasOwnProperty(r[i]))throw"Class missing '"+r[i]+"()' implementation";n[r[i]]=e[r[i]]}var s=e.getFields();for(var o in s)if(!s[o].hasOwnProperty("type"))throw"Invalid Field: Missing type declaration";return t.hasOwnProperty("models")||(t.models={}),t.models[n.getType()]=n,n},t.Field={KEY:1,TEXT:2,URL:3,DATE:4,OBJECT:5,ARRAY:6,MODEL:8,MONEY:9,PERCENT:10,NUMBER:11},t.registerType(t.Field.KEY,function(e,t){t.hasOwnProperty("numeric")&&(e=isNaN(e)?undefined:parseInt(e,10));if(!e)throw"Invalid Data: Missing primary key";return e}),t.registerType(t.Field.TEXT,function(e,t){return typeof e=="string"?e:undefined}),t.registerType(t.Field.URL,function(e,t){return typeof e=="string"?e:undefined}),t.registerType(t.Field.DATE,function(e,t){var n;try{n=new Date(e)}catch(r){console.log("date parse failed")}return n instanceof Date?n:undefined}),t.registerType(t.Field.OBJECT,function(e,t){return typeof e=="object"?e:undefined}),t.registerType(t.Field.ARRAY,function(e,t){return e instanceof Array?e:undefined}),t.registerType(t.Field.MODEL,function(e,t){return e}),t.registerType(t.Field.MONEY,function(e,t){return typeof e=="string"&&(e=e.replace(/[$,]/g,"")),isNaN(e)?undefined:parseFloat(e)}),t.registerType(t.Field.PERCENT,function(e,t){return typeof e=="string"&&(e=e.replace(/[%]/g,"")),isNaN(e)?undefined:(e=parseFloat(e),t.hasOwnProperty("basis")&&(t.basis==="percent"?e=Math.round(e*1e4)/1e6:t.basis==="bip"&&(e=Math.round(e*1e4)/1e8)),e)}),t.registerType(t.Field.NUMBER,function(e,t){return typeof e=="string"&&(e=e.replace(/[,]/g,"")),isNaN(e)?undefined:parseFloat(e)}),e.Model=t}(Orange),function(e){var t,n=e.Model;t=Class.extend({initialize:function(e){this._source=e||[],this.data={},this.list=[],this.handles=[];for(var t=0;t<e.length;t++)this.data[e[t].getId()]=e[t],this.list.push(e[t]),e[t]instanceof n&&this.handles.push(e[t].on("change",this.onModelUpdate,this));this.direction=1,this.sortFields=[]},onModelUpdate:function(e){this.sort(this.sortFields,this.direction)},get:function(e){return this.data.hasOwnProperty(e)?this.data[e]:null},sort:function(e,t,n){function s(e,t){if(e instanceof Date&&t instanceof Date)return e===t?0:e>t?r:i;if(!isNaN(e)&&!isNaN(t)){try{return parseFloat(e)===parseFloat(t)?0:parseFloat(e)>parseFloat(t)?r:i}catch(n){}return!1}try{return e.toLowerCase()===t.toLowerCase()?0:e.toLowerCase()>t.toLowerCase()?r:i}catch(n){}return!1}function o(e,t){var n=0;for(var r=0;r<this.sortFields.length;r++){n=s(e.get([this.sortFields[r]]),t.get([this.sortFields[r]]));if(n)return n}return 0}if(!e)return;t?this.direction=t:t=this.direction;if(e instanceof Array){if(e.length===0)return;this.sortFields=e}else this.sortFields=[e];var r=1*t,i=-1*t;return this.list.sort(proxy(o,this)),n||this.fire("change"),this},filter:function(e,t){if(!t||t===""){this.clearFilters();return}var r=arguments.length===1,i=[],s,o=new RegExp(r?e:t,"i");for(var u=0;u<this.list.length;u++){this.list[u]instanceof n?s=this.list[u].toObject():s=this.list[u];if(r){for(var a in s)if(o.test(s[a])){i.push(this.list[u]);break}}else if(o.test(s[e])){i.push(this.list[u]);break}}return delete this.list,this.list=i,this.fire("change"),this},clearFilters:function(e){delete this.list,this.list=[];for(var t=0;t<this._source.length;t++)this.list.push(this._source[t]);return this.sort&&this.sort(this.sortFields,this.direction,!0),e||this.fire("change"),this},count:function(){return this.list.length},toObject:function(){var e={};for(var t=0;t<this.list.length;t++)e[this.list[t].getId()]=this.list[t];return e},toArray:function(){return this.list},destroy:function(){if(this.handles.length)for(var e=0;e<this.handles.length;e++)this.handles[e].detach();this.handles=[],delete this._source,delete this.data,delete this.list,delete this.sort}}).include(Events),e.Collection=t}(Orange),function(e){var t={},n=window.localStorage,r=!1,i=!1;if("localStorage"in window)try{window.localStorage.setItem("_test",1),r=!0,window.localStorage.removeItem("_test")}catch(s){}if(r)try{window.localStorage&&(n=window.localStorage)}catch(s){}else if("globalStorage"in window)try{window.globalStorage&&(n=window.globalStorage[window.location.hostname],r=!0)}catch(s){}!JSON&&!JSON.hasOwnProperty("stringify")&&(r=!1),r||Log.warn("No native JSON parser found"),t.get=function(e){if(!r)return;try{var t=JSON.parse(n.getItem(e));if(t!==undefined&&t.data!==undefined)return i&&t.ttl!==-1&&(new Date).getTime()-t.timestamp>t.ttl&&n.removeItem(e),t.data}catch(s){Log.error("Error fetching object from localStorage")}},t.set=function(e,t,i){if(!r||typeof t=="undefined"||!!e.match(/[^A-Za-z:0-9_\[\]]/g))return!1;var s={data:t,timestamp:(new Date).getTime(),ttl:i?i:864e5};try{return n.setItem(e,JSON.stringify(s)),!0}catch(o){o===QUOTA_EXCEEDED_ERR&&Log.error("Storage quota has been exceeded",o)}return!1},t.remove=function(e){if(!r)return!1;n.removeItem(e)},t.flushExpired=function(e){if(!r||i===!1&&e!==!0)return;for(var s in n)t.get(s)},t.flush=function(e){if(!r||i===!1&&e!==!0)return;n.clear(),Log.info("Clear: Local storage cleared")},t.isSupported=function(){return r},t.goOnline=function(){i||console.log("Storage: Went online"),i=!0},t.goOffline=function(){i&&console.log("Storage: Went offline"),i=!1},e.Storage=t}(Orange),function(e){function s(e){var t=["map","from","to","offline","cache","callback"];for(var n=0;n<t.length;n++){if(!e.hasOwnProperty(t[n]))return!1;if(t[n]==="map"&&!o(e[t[n]]))return!1}return!0}function o(e){return!e.hasOwnProperty("model")||!r.get(e.model)||!e.hasOwnProperty("params")?!1:!0}function u(e,t){var r=[],i;if(t instanceof Array){for(var s=0;s<t.length;s++)i=f(e,t[s]),i&&r.push(i);return new n(r)}return!1}function a(e,t){var n=[];for(var r in t)n.push(t[r]);return u(e,n)}function f(e,t){var n={},i,s;for(var o in e.params)t.hasOwnProperty(e.params[o])&&(n[o]=t[e.params[o]]);return i=r.get(e.model),s=new i(n),s||!1}var t,n=e.Collection,r=e.Model,i=e.Storage;t=Class.extend({initialize:function(e,t){this.isOnline=!1,this.cache=[],this.auth=t||null,this.path=e||""},getType:function(){throw"Cannot instantiate service"},getPath:function(){return""},goOnline:function(){this.isOnline=!0},goOffline:function(){this.isOnline=!1},request:function(e,t,n,r,i,o,l){function g(e,t){var n;switch(e){case"parse":n="Error parsing response";break;case"offline":n="Service offline";break;default:n="Service error"}o.call(l||this,t)}function b(e){try{var n=!!e;e=r.callback(e);var s=!!e;if(s!==n)throw"Invalid Mapping: Service callback returning no data";if(r.from==="array"&&r.to==="collection"){if(!(e instanceof Array))throw'Invalid Response: Service "'+h+'" expected an array';e=u(r.map,e)}else if(r.from==="object"&&r.to==="collection"){if(typeof e!="object"||e instanceof Array)throw'Invalid Response: Service "'+h+'" expected an object';e=a(r.map,e)}else if(r.from==="object"&&r.to==="model"){if(typeof e!="object")throw'Invalid Response: Service "'+h+'" expected an object';e=f(r.map,e)}r.cache&&t==="GET"&&this.cacheResponse(v,e)}catch(o){g("parse",o);return}i.call(l||this,e)}var c=this.getPath(),h=(c.charAt(0)==="/"?c.substr(1):c)+e,p;if(["GET","POST","PUT","DELETE"].indexOf(t)===-1)throw"Invalid method type";if(!s(r))throw"Invalid configuration";var d=Object.keys(n).sort(),v="service:"+this.getType()+":";for(var m=0;m<d.length;m++)v+=d[m]+":"+md5(n[d[m]])+":";if(r.cache&&this.cache.hasOwnProperty(v)&&this.cache[v]>(new Date).getTime()){try{p=this.retrieveResponse(v,r.map.model,n)}catch(y){}if(p){i.call(l||this,p);return}}if(!this.isOnline){if(r.offline&&t==="GET"){try{p=this.retrieveResponse(v,r.map.model,n)}catch(y){}if(p){i.call(l||this,p);return}}g("offline");return}$.ajax({url:h,type:t,data:n,success:proxy(b,this),error:g})},cacheResponse:function(e,t){var n,s="object";if(t instanceof Array){n=[];for(var o=0;o<t.length;o++)t[o]instanceof r?(n.push(t[o].getId()),i.set(t[o].getType()+":"+t[o].getId(),t[o].toObject()),s="collection"):(n.push(t[o]),s="array")}else t instanceof r?(n=t.getId(),i.set(t.getType()+":"+n,t.toObject()),s="model"):n=t;return this.cache[e]=(new Date).getTime()+6e4,i.set(e,{type:s,data:n})},retrieveResponse:function(e,t,n){var s=i.get(e),o=r.get(t),u=s.type,a=s.data;if(u==="model"){var f=i.get(t+":"+a),l=new o(f);return l||null}if(u==="collection"){var c=[],h;for(var p=0;p<s.length;p++)h=new o(i.get(t+":"+s[p])),h&&c.push(h);return c}return s||null},modelOrId:function(e){if(e instanceof r)return e.getId();if(typeof e!="object")return e;throw new Error("Invalid Input: Expecting model or id",e)}}),t.get=function(e){t.hasOwnProperty("services")||(t.services={});if(t.services.hasOwnProperty(e))return t.services[e]},t.extend=function(e){var n=Class.extend.call(this,e);t.hasOwnProperty("services")||(t.services={});var r=["getType"];for(var i=0;i<r.length;i++){if(!e.hasOwnProperty(r[i]))throw"Class missing '"+r[i]+"()' implementation";n[r[i]]=e[r[i]]}return t.services[n.getType()]=n,n},e.Service=t}(Orange),function(e){function r(e,t,n){return $.ajax({async:n!==!0,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:e,success:function(n){t(e,n)},error:function(){throw"Error: template not found"}}).responseText}var t={},n={};t.get=function(e,t,r){var i=this,s=[],o;if(!n.hasOwnProperty(e))throw"Path "+e+" has not been loaded";$("<div>"+n[e]+"</div>").children().each(function(){s.push($(this))});for(var u=0;u<s.length;u++){if(typeof t!="undefined"&&s[u].attr("data-control")!==t)continue;if(typeof r!="undefined"&&s[u].attr("data-name")!==r)continue;return s[u]}throw"Could not find view "+t+" at "+e},t.register=function(e,t){function o(e,r){n[e]=r,s--,s===0&&t()}var i,s=e.length;if(s===0)return t();for(var u=0;u<e.length;u++)i=e[u],r(e[u],proxy(o,this))},e.View=t}(Orange),function(e){var t,n=e.Collection,r=e.Model;t=Class.extend({initialize:function(e){this.target=e,this.template=e.html(),this.listTemplate=null,this.data=null,this.handles=[],this.bound=!1,this.binding=!1},bind:function(e,t){if(this.binding){console.log("Error: Already binding");return}this.binding=!0,this.bound&&this.unbind(),this.bound=!0,this.data=e,e instanceof n?(this.bindCollection(this.target,e),this.handles.push(e.on("change",this.onCollectionUpdate,this))):e instanceof Array?this.bindList(this.target,e):e instanceof r?(this.bindModel(this.target,e),this.handles.push(e.on("change",this.onModelUpdate,this))):typeof e=="object"&&this.bindData(this.target,e),this.binding=!1},onCollectionUpdate:function(e){if(this.handles.length)for(var t=0;t<this.handles.length;t++)this.handles[t].detach();this.handles=[],this.target.html(this.template),this.bindCollection(this.target,this.data),this.handles.push(this.data.on("change",this.onCollectionUpdate,this))},onModelUpdate:function(e){var t=e.data,n=e.target.getId(),r=e.target.getType();e.target.getItemType()&&(r=e.target.getItemType());if(t instanceof Array&&t.length>0)for(var i=0;i<t.length;i++)this.onModelKeyUpdate(t[i],n,r)},onModelKeyUpdate:function(e,t,n){var r=e.action,i=e.name,s=e.value,o;this.target.attr("itemid")===t.toString()&&this.target.attr("itemtype")===n?(o=this.target,r==="id"&&this.target.attr("itemid",s)):(o=this.target.find('[itemid="'+t+'"][itemtype="'+n+'"]'),r==="id"&&o.attr("itemid",s));var u=firstChildren(o,'[itemprop="'+i+'"]');for(var a=0;a<u.length;a++)r==="set"?s instanceof Date?this.bindItem(u[a],s):typeof data=="object"?this.bindItem(u[a],s):this.bindItem(u[a],s):r==="clear"&&u[a].empty()},bindCollection:function(e,t){this.bindList(e,t.toArray())},bindList:function(e,t){var n=e.find("[itemscope]:first"),i=n.clone(),s=e.clone(),o;if(!n.length)throw"Invalid Markup: Cannot bind collection to view missing [itemscope]";n.remove(),n=null;for(var u=0;u<t.length;u++)o=i.clone(),t[u]instanceof r?this.bindModel(o,t[u]):this.bindData(o,t[u]),s.append(o);e.html(s.html())},bindModel:function(e,t){t.getItemType()?e.attr("itemtype",t.getItemType()):e.attr("itemtype",t.getType()),e.attr("itemid",t.getId()),e.attr("itemscope"),this.handles.push(t.on("change",this.onModelUpdate,this)),this.bindData(e,t.toObject())},bindData:function(e,t){var n=[],r;if(typeof t=="string"&&e.has("[itemscope]")){this.bindItem(e,t);return}if(t instanceof Date){this.bindItem(e,t);return}n=firstChildren(e,"[itemprop]");for(var i=0;i<n.length;i++)r=n[i].attr("itemprop")||null,r&&t.hasOwnProperty(r)&&(t[r]instanceof Array?this.bindList(n[i],t[r]):t[r]instanceof Date?this.bindItem(n[i],t[r]):typeof t[r]=="object"?this.bindData(n[i],t[r]):this.bindItem(n[i],t[r]))},bindItem:function(e,t){if(t instanceof Date){e.attr("datetime",t.toString());var n=e.attr("data-format");n&&n.length>0?e.text(t.format(n.toLowerCase())):e.text(t.getMonth()+"/"+t.getDate()+"/"+t.getFullYear())}else if(typeof t=="string"||typeof t=="number")e.prop("tagName")==="META"?e.attr("content",t):e.text(t)},unbind:function(){this.data=null;if(this.handles.length)for(var e=0;e<this.handles.length;e++)this.handles[e].detach();this.handles=[],this.target.html(this.template)},destroy:function(){delete this.target,delete this.template,delete this.data,delete this.handle,delete this.bound,delete this.binding}}),e.Binding=t}(Orange),function(e){function a(e,t){t=$(t).eq(0),e=$(e)[0];for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n];t.attr(r.name,r.value)}}function f(e,t){var n=$(e).get(0),r={},i=[];for(var s=0,o=n.attributes.length;s<o;s++)n.attributes[s].name.match(t)&&(r[n.attributes[s].name.replace(t,"")]=n.attributes[s].value,i.push(n.attributes[s].name));for(var u=0;u<i.length;u++)$(e).removeAttr(i[u]);return r}function l(e,t){var n=this.getRoutes(),r,i;e&&e.charAt(0)==="/"&&(e=e.substr(1));for(var s in n){i=s.substr(1).split("/").shift();if(i.indexOf(":")!==-1||!i)r="/"+i;if(i===e)return s}return t?null:r}var t,n=e.Binding,r=e.Browser,i=e.Deferred,s=e.Form,o=e.Model,u=e.View;t=Class.extend({initialize:function(e,t,n){this._initialized=!1,this.app=n,this.parent=e||null,this.target=$(t),this._views=this.setupViews(),this._forms=this.setupForms(),this._elems=this.setupElements(),this._attrs=this.setupAttributes(),this.validateOutlets(),this._source=this.target.outerHTML(),this._queue=[],this._bindings={},this._loaded=!1,this._visible=!1,this._stopping=!1,this.setupTransitions(),typeof this.target=="object"&&this.target.addClass("hidden"),this.validate(),this.setup(),this._initialized=!0},setupAttributes:function(){if(this._initialized)return;var e=f(this.target,/data-/);return e.hasOwnProperty("name")||(e.name=e.control),e.hasOwnProperty("state")?(this._state=e.state,this.target.addClass(e.state)):this._state=null,this.target.addClass("view"),typeof this.typeList!="undefined"&&this.target.addClass(this.typeList),this.target.addClass(e.name),e},setupViews:function(){if(this._initialized)return;var e=firstChildren(this.target,"[data-control]"),n={},r,i,s,o,f;for(var l=0;l<e.length;l++)i=e[l].attr("data-control"),r=e[l].attr("data-name")||i,o=e[l].attr("data-template"),o&&o.length>0&&(s=u.get(o,i,r),e[l].html(s.html()),a(s,e[l]),e[l].removeAttr("data-template")),f=t.get(i),n[r]=new f(this,e[l],this.app);return n},setupForms:function(){if(this._initialized)return;var e=firstChildren(this.target,"form"),t={},n,r;for(var i=0,o=e.length;i<o;i++)n=e[i].attr("name"),r=new s(e[i]),t[n]=r;return t},setupElements:function(){if(this._initialized)return;var e=firstChildren(this.target,"[data-name]:not([data-control])"),t={},n;for(var r=0;r<e.length;r++)n=e[r].attr("data-name"),n.length>0&&(t[n]=e[r],e[r].removeAttr("data-name").addClass(n));return t},validateOutlets:function(){var e=this.getOutlets(),t=[],n,r;if(e.hasOwnProperty("views"))for(r=0;r<e.views.length;r++)this.hasView(e.views[r])||t.push(e.views[r]);if(e.hasOwnProperty("forms"))for(r=0;r<e.forms.length;r++)this.hasForm(e.forms[r])||t.push(e.forms[r]);if(e.hasOwnProperty("elements"))for(r=0;r<e.elements.length;r++)this.hasElement(e.elements[r])||t.push(e.elements[r]);if(t.length>0)throw'Invalid Syntax: ViewController "'+this.attr("name")+'" missing outlets ['+t.join(", ")+"]";var i=this.getRoutes(),s=l.call(this,"");if(!s&&!this.attr("default")&&Object.keys(i).length>0)throw'Invalid Syntax: View Controller "'+this.attr("name")+'" must define either a [data-default] or generic / route';for(var o in i)if(o.charAt(0)!=="/")throw'Invalid Syntax: Route "'+o+'" in '+this.attr("name")+" must begin with forward slash"},setupTransitions:function(){if(this._initialized)return;this.on("_load",this.onLoad,this),this.on("_loaded",this.onDidLoad,this),this.on("_appear",this.onAppear,this),this.on("_appeared",this.onDidAppear,this),this.on("_disappear",this.onDisappear,this),this.on("_disappeared",this.onDidDisappear,this),this.on("_unload",this.onUnload,this),this.on("_unloaded",this.onDidUnload,this)},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},destroy:function(){for(var e in this._views)this._views[e].destroy(),delete this._views[e];for(var t in this._forms)this._forms[t].destroy(),delete this._forms[t];for(var n in this._elems)delete this._elems[n];delete this.target,delete this.parent,delete this._source,delete this._queue},getType:function(){return"view"},getBindings:function(){return{}},getOutlets:function(){return{}},getRoutes:function(){return{}},validate:function(){},setup:function(){},add:function(e,t,n){return this._queue.push({fn:e,args:t,wait:n}),this._running||this.next(),this},next:function(){this._running=!0;var e=this._queue.shift();if(e){e.fn.apply(this,e.args);if(e.fn===this._setState||e.fn===this._clearState)this._process=setTimeout(proxy(function(){this.next()},this),e.wait)}else this._running=!1},stop:function(){return this._queue=[],this._process&&(clearTimeout(this._process),this.next()),this},when:function(){return e.when.apply(this,arguments)},then:function(){return this.promise().then.apply(this,arguments)},promise:function(){function t(){e.resolve()}var e=new i(this);return this.add(t),e},setRoute:function(e){return this.add(this._setRoute,[e],0)},getRoute:function(){return this.route},_setRoute:function(e){e.substr(0,1)!=="/"&&(e="/"+e);var t=l.call(this,e);if(this.route===e){this.next();return}var n=t.match(/[^:]*/).pop();n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1));var r="#!"+this._routes+n;location.hash=r,this.next()},setHashRoute:function(e,t){return this.add(this._setHashRoute,[e,t],0),this},_setHashRoute:function(e,t){function n(e,t){for(var n in this._views)this.getView(n).setHashRoute(e.slice(0),t)}t=t?t:"";var r=this.getRoutes();if(Object.keys(r).length===0){n.call(this,e,t),this.next();return}var i=e.slice(0).shift(),s=l.call(this,i,!0);s?e.shift():(s=l.call(this,i),i=""),s||(s=l.call(this,this.attr("default")));var o=s.substr(1).split("/"),u={},a;this._routes=t||"",i&&(t+="/"+i);for(var f=0;f<o.length;f++)o[f].charAt(0)===":"&&(a=e.shift()||null,u[o[f].substr(1)]=a,this.attr(o[f].substr(1),a),t+="/"+a);r.hasOwnProperty(s)&&r[s].call(this,this.route,u),n.call(this,e,t),this.route=i,this.next()},getState:function(){return this._state},setState:function(e,t){return this.add(this._setState,[e],t||0)},clearState:function(e){return this.add(this._clearState,[],e||0)},_setState:function(e,t){if((this.hasState(e)||!this._loaded)&&!t)return;this.target.removeClass(this._state),this.target.addClass(e),this._state=e},_clearState:function(){this.target.removeClass(this._state),this._state=null},hasState:function(e){return this._state===e},load:function(){return this.add(this._load)},show:function(){return this.add(this._show)},hide:function(){return this.add(this._hide)},unload:function(){return this.add(this._unload)},append:function(){return this.add(this._append)},remove:function(){return this.add(this._remove)},_load:function(){if(this._loaded){this.next();return}this.onWillLoad()},_show:function(){if(this._visible){this.next();return}if(!this._loaded)throw new Error("Invalid Request: Cannot show unloaded ViewController");this.onWillAppear()},_hide:function(){if(!this._visible){this.next();return}this.onWillDisappear()},_unload:function(){if(!this._loaded){this.next();return}if(this._visible)throw new Error("Invalid Request: Cannot unload visible ViewController");this.onWillUnload()},onWillLoad:function(){this.fire("_load")},onLoad:function(){var e=Object.keys(this._views).length;if(e===0)this.fire("_loaded");else for(var t in this._views){var n=this._views[t];n.once("load",proxy(function(){e--,e===0&&this.fire("_loaded")},this)),n.load()}},onDidLoad:function(){console.log(this.attr("name")+" Loaded"),this._loaded=!0,this.fire("load"),this.next()},onWillUnload:function(){this.fire("_unload")},onUnload:function(){var e=Object.keys(this._views).length;if(e===0)this.target.remove(),this.fire("_unloaded");else for(var t in this._views){var n=this._views[t];n.once("unload",proxy(function(){e--,e===0&&(this.target.remove(),this.fire("_unloaded"))},this)),n.unload()}},onDidUnload:function(){console.log(this.attr("name")+" Unloaded"),this._loaded=!1,this.fire("unload"),this.next()},onWillAppear:function(){var e=this.getBindings();for(var t in e){var n=e[t];for(var i in n){var s=null;typeof n[i]=="function"?s=n[i]:this.hasOwnProperty(n[i])&&(s=this[n[i]]),i==="touchclick"&&(i=r.touch?"touchend":"click");if(s===null){var o=i.charAt(0).toUpperCase()+i.slice(1);s=n[i]===!0&&typeof this["on"+o]=="function"?this["on"+o]:null}t==="$target"?this.target.on(i,proxy(s,this)):s!==null&&this.hasView(t)?this.getView(t).on(i,proxy(s,this)):s!==null&&this.hasForm(t)?this.getForm(t).on(i,proxy(s,this)):s!==null&&this.hasElement(t)&&this.getElement(t).on(i,proxy(s,this))}}this.target.removeClass("hidden"),this.fire("_appear")},onAppear:function(e){var t=Object.keys(this._views).length;if(t===0)this.fire("_appeared");else for(var n in this._views){var r=this._views[n];r.once("appear",proxy(function(){t--,t===0&&this.fire("_appeared")},this)),r.show()}},onDidAppear:function(e){console.log(this.attr("name")+" Appeared"),this._visible=!0,this.fire("appear"),this.next()},onWillDisappear:function(){for(var e in this._views)this.getView(e).detach();for(var t in this._forms)this.getForm(t).detach();for(var n in this._elems)this.getElement(n).unbind();this.fire("_disappear")},onDisappear:function(e){var t=Object.keys(this._views).length;if(t===0)this.fire("_disappeared");else for(var n in this._views){var r=this._views[n];r.once("disappear",proxy(function(){t--,t===0&&this.fire("_disappeared")},this)),r.hide()}},onDidDisappear:function(e){console.log(this.attr("name")+" Disappeared"),this.target.addClass("hidden"),this._visible=!1,this.fire("disappear"),this.next()},attr:function(){var e=arguments;if(e.length===1)return this._attrs.hasOwnProperty(e[0])?this._attrs[e[0]]:!1;e.length===2&&(this._attrs[e[0]]=e[1])},getViews:function(){return this._views},getView:function(e){if(e instanceof t)return e;if(typeof this._views[e]!="undefined")return this._views[e];throw new Error('Invalid Request: View "'+e+'" not found')},getForm:function(e){if(this._forms[e]instanceof s)return this._forms[e];throw new Error('Invalid Request: Form "'+e+'" not found')},getElement:function(e){if(typeof this._elems[e]!="undefined")return this._elems[e];throw new Error('Invalid Request: Element "'+e+'" not found')},hasView:function(e){return typeof this._views[e]!="undefined"},hasForm:function(e){return typeof this._forms[e]!="undefined"},hasElement:function(e){return typeof this._elems[e]!="undefined"},addView:function(e,n,r){if(this.hasView(n))throw new Error("Invalid Request: ViewController "+n+" already exists");var i=t.get(e),s=u.get(r,e,n);return i&&(this._views[n]=new i(this,s,this.app)),this._views[n]},removeView:function(e){this.hasView(e)&&(this._views[e].hide().unload().destroy(),delete this._views[e])},bind:function(e,t){if(!this.hasElement(e))throw'Invalid Resource: Element "'+e+'" is not defined';this._bindings.hasOwnProperty(e)&&this.unbind(e),this._bindings[e]=new n(this.getElement(e)),this._bindings[e].bind(t)},unbind:function(e){if(!this.hasElement(e))throw'Invalid Resource: Element "'+e+'" is not defined';this._bindings.hasOwnProperty(e)&&(this._bindings[e].unbind(),delete this._bindings[e])},getService:function(e){return this.app.getService(e)},goOnline:function(){for(var e in this._views)this._views[e].goOnline()},goOffline:function(){for(var e in this._views)this._views[e].goOffline()}}).include(Events),t.views={view:t},t.extend=function(e){if(!e.hasOwnProperty("getType"))throw'Missing Implementation: ViewController missing "getType" implementation';var n=Class.extend.call(this,e),r=e.getType();if(t.views.hasOwnProperty(r))throw'Duplicate Class: ViewController "'+r+'" is already defined';return n.prototype.typeList?n.prototype.typeList+=" "+r:n.prototype.typeList=r,n.extend=t.extend,t.views[r]=n},t.get=function(e){if(this.views.hasOwnProperty(e))return this.views[e];throw'Invalid Resource: ViewController "'+e+'" not defined'},e.ViewController=t}(Orange),function(e){function a(e){typeof e=="function"&&$(document).ready(function(){$("body").hide();var n=$("[data-app]").text();if(n){n=JSON.parse(n);var r=new t(n);e.call(this,r),r.launch()}})}var t,n=e.Cache,r=e.Loader,i=e.Service,s=e.Storage,o=e.View,u=e.ViewController;t=Class.extend({initialize:function(e){if(!e.hasOwnProperty("name"))throw"Invalid application";this.name=e.name,this.version=e.hasOwnProperty("version")?e.version:null,this.required=e.hasOwnProperty("required")?e.required:[],this.loaded=!1,this.online=!1,this.env=e.hasOwnProperty("env")?e.env:"PROD";for(var t=0,n=this.required.length;t<n;t++)r.loadModule(this.required[t]);this.servicePaths={},this.services={},this.serviceConfig={},this.authService=null,this.constants={},this.templates=[],this.authenticated=!1,this.viewLoaded=!1},loadServices:function(){for(var e in this.serviceConfig){var t=i.get(e),n=this.serviceConfig[e],r={};Object.keys(n.paths).length>0&&typeof n.paths[this.env]!==undefined?r={path:n.paths[this.env],auth:n.auth}:r={path:this.servicePaths[this.env],auth:n.auth};var s=new t(r.path,r.auth);this.services[e]=s}},authenticate:function(e,t,n){if(!this.authService){e.call(n);return}if(!this.services.hasOwnProperty(this.authService))throw"Cannot load authentication service";var r=this.services[this.authService];if(typeof r.authenticate!="function")throw"Authentication service must implement authenticate()";r.authenticate(e,t,n)},setEnvironment:function(e){this.env=e},setLogging:function(e){this.levels=e},setConstant:function(e,t){this.constants[e]=t},getConstant:function(e){return this.constants.hasOwnProperty(e)?this.constants[e]:null},getService:function(e){return this.services.hasOwnProperty(e)?this.services[e]:null},registerService:function(e,t,n){this.serviceConfig[e]={auth:t||null,paths:n||{}}},setAuthentication:function(e){this.authService=e},registerServicePaths:function(e){this.servicePaths=e},registerViews:function(e){e instanceof Array&&(this.templates=e)},onHashChange:function(e){var t=location.hash;t.substr(0,2)==="#!"?t=t.replace("#!",""):t=t.replace("#","");var n=[];t.charAt(0)==="/"&&(t=t.substr(1)),n=t.split("/"),this.root.setHashRoute(n.slice(0))},onOnline:function(){this.online||console.log("Application: Went online"),this.online=!0;for(var e in this.services)this.services[e].goOnline();s.goOnline(),this.root&&this.root.goOnline()},onOffline:function(){this.online&&console.log("Application: Went offline"),this.online=!1;for(var e in this.services)this.services[e].goOffline();s.goOffline(),this.root&&this.root.goOffline()},onAuthSuccess:function(){this.authService&&console.log("User: Authenticated successfully");var e=$("[data-root]");if(e.length===0)throw"Invalid Markup: No [data-root] view found";var t=e.attr("data-control");if(!t)throw"Invalid Markup: Root View missing [data-control]";var n=u.get(t);this.root=new n(null,e,this),this.root.load().show(),this.online?this.root.goOnline():this.root.goOffline(),$(window).on("hashchange",proxy(this.onHashChange,this)),$(window).trigger("hashchange"),$("body").show()},onAuthFailure:function(){console.log("Could not authenticate")},launch:function(){if(this.loaded)return;!this.levels||!this.levels.hasOwnProperty(this.env)?Log.setLevel("DEBUG"):Log.setLevel(this.levels[this.env]);var e=s.get("appversion"),t=s.get("appenv");this.version&&(this.version!==e||this.env!==t)&&(s.flush(!0),s.set("appversion",this.version),s.set("appenv",this.env)),n.init(function(e){this.loadServices(),e?this.onOnline():this.onOffline(),n.on("online",function(e){e.data?this.onOnline():this.onOffline()},this),this.authenticate(proxy(function(){this.authenticated=!0,this.viewLoaded&&this.onAuthSuccess.call(this)},this),this.onAuthFailure,this),o.register(this.templates,proxy(function(){this.viewLoaded=!0,console.log("Views: loaded and cached"),this.authenticated&&this.onAuthSuccess.call(this)},this))},this)}}),e.Application=t,e.config=a}(Orange);