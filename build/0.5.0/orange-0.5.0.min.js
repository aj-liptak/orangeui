/*!
 * OrangeUI | 0.5.0 | 09.25.2012
 * https://github.com/brew20k/orangeui
 * Copyright (c) 2012 Kevin Kinnebrew
 */
function a(){}function b(a){var c,d=a instanceof Array?[]:{};for(c in a){if(c==="clone")continue;a[c]&&a[c]instanceof Date?d[c]=new Date(a[c]):a[c]&&typeof a[c]=="object"?d[c]=b(a[c]):d[c]=a[c]}return d}function c(a,b){var c=b;return function(){return a.apply(c,arguments)}}function d(a,b){var c=[];return a.find(b).each(function(){var b=!1,d=$(this).parent();while(d.length!==0&&!b){if($(d).not($(a)).length===0){b=!0;break}if($(d).not("[data-control]").length===0){b=!1;break}d=$(d).parent()}b&&c.push($(this))}),c}jQuery.fn.outerHTML=function(a){return a?this.before(a).remove():jQuery("<p>").append(this.eq(0).clone()).html()},function(){function n(){function c(){--b===0&&a.resolve()}var a=new e(this),b=arguments.length;for(var d=0;d<arguments.length;d++)arguments[d].then(c);return a}function o(){var a=arguments,b=a[0],c=typeof a[1]=="function"?a[1]:null,d=a[2];k.Loader.addModule(b,c,d)}function p(){var a=Array.prototype.slice.call(arguments),c=a[a.length-1],d=b(a).splice(0,a.length-1);if(typeof d[0]!="function")for(var e=0,f=d.length;e<f;e++)k.Loader.loadModule(d[e]);c.call(window,k)}function q(a){if(typeof k.modules[a]!==undefined)return k.modules[a];throw"Could not require module"}var a,d,e,f,g,h,i,j,k={},l=/[^A-Za-z:0-9_\[\]]/g,m=/[^A-Za-z\-_]/g;d=function(){function c(){}var a=!1,b=/\b_super\b/;return c.extend=function(d){function h(){!a&&this.initialize&&this.initialize.apply(this,arguments)}var e,f,g=this.prototype;a=!0,e=new this,a=!1;for(f in d)e[f]=typeof d[f]=="function"&&typeof g[f]=="function"&&b.test(d[f])?function(a,b){return function(){var c=this._super;this._super=g[a];var d=b.apply(this,arguments);return this._super=c,d}}(f,d[f]):d[f];return h.prototype=e,h.prototype.constructor=h,h.extend=c.extend,h.include=c.include,h},c.include=function(a){var b,c,d;if(!a)throw"Missing definition";for(b in a)c=a[b],Array.prototype.indexOf.call(["extend","include"],b)<0&&(this.prototype[b]=c);return this},c}(),g=function(){function a(a,b,c,d){this.bubbles=!0,this.currentTarget=b,this.data=d,this.target=c,this.type=a}return a.prototype.stopPropagation=function(){this.bubbles=!1},a}(),h=function(){function a(a,b,c){this.call=c,this.ev=b,this.target=a}return a.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call},a}(),f={on:function(a,b,d){var e=typeof d!="undefined"?c(b,d):b;return this._listeners||(this._listeners={}),this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]),this._listeners[a].push(e),new h(this,a,e)},once:function(a,b,d){var e=typeof d!="undefined"?c(b,d):b,f=function(){b.apply(this,arguments),this.detach(a,e)};this.on(a,f)},fire:function(a,b){var c=this.parent||null,d=a;typeof a=="string"&&(a=new g(a,this,this,b));if(typeof a.type!="string")throw"Error: Invalid 'type' when firing event";this._listeners||(this._listeners={});if(this._listeners[a.type]instanceof Array){var e=this._listeners[a.type];for(var f=0,h=e.length;f<h;f++)e[f].call(this,a,b)}c!=null&&a.bubbles&&d[0]!=="_"&&(a.currentTarget=this.parent,c.fire.call(c,a,b))},detach:function(a,b){var c=[];this._listeners||(this._listeners={});if(typeof a=="undefined")this._listeners={};else if(this._listeners[a]instanceof Array)if(typeof b!="undefined"){c=this._listeners[a];for(var d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}}else this._listeners[a]=[]}},i=function(){var a={},b={},c={};return k.modules={},{addModule:function(b,c,d){if(!b.match(/[\^\-A-Za-z_]/g))throw"Invalid module name";var e={name:b,fn:c,req:d!==undefined?d:[]};a[b]=e},loadModule:function(d){if(b.hasOwnProperty(d))return;if(a[d]!==undefined){b[d]=!0;for(var e=0,f=a[d].req.length;e<f;e++){if(a[d].req[e]===d)continue;this.loadModule(a[d].req[e])}a[d].fn.call(window,c),k.modules[d]=c}}}}(),j=function(){function b(b,c,d){this.level>b&&(this.fire("msg",{message:c,ex:d}),d?console.log("["+a[b]+"]",c,d):console.log("["+a[b]+"]",c))}function c(){this.level=1}var a=["OFF","ERROR","WARN","INFO","DEBUG"];for(var d in f)c[d]=f[d];return c.prototype.setLevel=function(b){if(b in a)switch(b){case"DEBUG":b=4;break;case"INFO":b=3;break;case"WARN":b=2;break;case"ERROR":b=1;break;default:b=0}},c.prototype.debug=function(a,c){b.call(this,4,a,c)},c.prototype.info=function(a,c){b.call(this,3,a,c)},c.prototype.warn=function(a,c){b.call(this,2,a,c)},c.prototype.error=function(a,c){b.call(this,1,a,c)},c}(),e=function(){function a(a){this.context=a,this.resolved=!1,this.bindings=[]}return a.prototype.resolve=function(){this.resolved=!0;for(var a=0;a<this.bindings.length;a++)this.bindings[a].fn.apply(this.context,this.bindings[a].args);this.bindings=[]},a.prototype.then=function(a,b){this.resolved?a.apply(this.context,b||[]):this.bindings.push({fn:a,args:b||[]})},a}(),_||(_={}),_.deferEach=function(a,b,c){var d=[],f;if(typeof b!="function")return;for(var g=0,h=a.length;g<h;g++)f=b.call(c,a[g],g,a),f instanceof e&&d.push(f);return k.when.call(c,d)},a={touch:"ontouchstart"in window||window.hasOwnProperty("DocumentTouch")&&document instanceof DocumentTouch,location:"geolocation"in navigator},k=this.Orange={modules:{}},k.version="0.5.0",k.add=o,k.use=p,k.include=this.include=q,k.when=n,k.Browser=a=a,k.Class=this.Class=d,k.Deferred=e,k.Events=this.Events=f,k.EventHandle=h,k.Loader=i,k.Log=this.Log=new j}.call(this),Array.prototype.clone=function(){return this.slice(0)},Array.prototype.indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},Array.prototype.first=[].first||function(){return this.length?this[0]:null},Array.prototype.last=[].last||function(){return this.length?this[this.length-1]:null},function(a){function i(){d!==null&&(clearTimeout(d),d=null)}function j(a){var c=Math.floor(Math.random()*1e4);if(navigator.onLine&&!g){f=!0,g=!0,b.fire("online",!0),a&&a(!0),e&&setTimeout(j,1e4);return}i(),d=setTimeout(function(){navigator.onLine&&!g?(f=!0,g=!0,b.fire("online",!0)):navigator.onLine?$.ajax({url:"ping.js?q="+c,type:"GET",success:function(){f===!1&&(f=!0,b.fire("online",!0))},error:function(){f===!0&&(f=!1,b.fire("online",!1))}}):setTimeout(function(){f===!0&&(f=!1,b.fire("online",!1))},100),d=null,e&&setTimeout(j,1e4)},g?100:0)}function k(){window.applicationCache.swapCache(),Log.debug("Cache updated and ready"),window.location.reload(!0)}var b={},d=null,e=!1,f=!1,g=!1,h=!1;for(var l in Events)b[l]=Events[l];b.init=function(a,d){if(h)return;e=!1,h=!0,$(window).bind("offline",j),$(window).bind("online",j),$(window).bind("updateready",k),j.call(b,c(a,d))},b.updateNetworkStatus=function(a){j.call(b)},b.isActive=function(){return h},b.isOnline=function(){return f},a.Cache=b}(Orange),function(a){var b,d=a.Model;b=Class.extend({initialize:function(a){var b=this,e,f;this.target=a,this.fields={},this.target.find("input, select, textarea, checkbox").not('input[type="submit"]').not('input[type="button"]').each(function(){var a=$(this).attr("name");a&&(b.fields[a]=$(this))}),e=this.target.attr("data-model"),e&&(f=d.load(e),f&&this.build(f)),this.target.submit(c(this.$onSubmit,this))},get:function(a){if(this.fields.hasOwnProperty(a))return this.fields[a].val()},set:function(a,b){this.fields.hasOwnProperty(a)&&this.fields[a].val(b)},clear:function(a){this.fields.hasOwnProperty(a)&&this.fields[a].val("")},disable:function(){for(var a in this.fields)this.fields[a].attr("disabled","disabled")},enable:function(){for(var a in this.fields)this.fields[a].removeAttr("disabled")},build:function(a){var b=a.getSchema()},getData:function(){var a={};for(var b in this.fields)a[b]=this.fields[b].val();return a},setData:function(a){for(var b in this.fields)a.hasOwnProperty(b)&&this.fields[b].val(a[b])},$onSubmit:function(a){var b=this.target.attr("action");if(typeof b!="undefined")return;a.preventDefault(),this.fire("submit",this.getData())},destroy:function(){for(var a in this.fields)delete this.fields[a]}}).include(Events),a.Form=b}(Orange),function(a){function g(){return(new Date).getTime()-e>f}function h(a,b){e=(new Date).getTime(),d=b.coords,typeof a=="function"&&a(b.coords)}function i(a){switch(a.code){case a.TIMEOUT:Log.warn("Location services timeout");break;case a.POSITION_UNAVAILABLE:Log.warn("Position unavailable");break;case a.PERMISSION_DENIED:Log.warn("Please Enable Location Services");break;default:Log.info("Unknown location services error")}}var b={},c=a.Browser,d=null,e=null,f=36e5;b.get=function(a,b){if(!c.location){b.call(this);return}if(typeof a!="function")return;if(d&&!g())return a(d);var e=function(a){i(a),b&&b.call(this)},f=function(b){h(a,b)};navigator.geolocation.getCurrentPosition(f,e)},a.Location=b}(Orange),function(a){var c,d=a.Collection,e=a.Events;c=Class.extend({initialize:function(a){var b=this.getKey();this._source=a||{},this._id=null,this._data={},this._changed=!1,this.processData(a)},getType:function(){throw"Cannot instantiate model"},getItemType:function(){return null},getKey:function(){var a=this.getFields();for(var b in a)if(a[b].type===c.Field.KEY)return b},getFields:function(){throw"Cannot instantiate model"},processData:function(a,b){var d=[],e=!1,f=this.getFields();for(var g in f){e=f[g].type===c.Field.KEY;if(a.hasOwnProperty(g)&&typeof a[g]!="undefined")e?(this._id=c.clean(a[g],f[g]),d.push({action:"set",name:g,value:this._id})):(this._data[g]=c.clean(a[g],f[g]),d.push({action:"set",name:g,value:this._data[g]}));else if(f[g].hasOwnProperty("required")&&f[g].required||e&&!b)throw'Field Missing: "'+g+'" on model "'+this.getType()+'"'}return d},get:function(a){var b=this.getFields();if(!b.hasOwnProperty(a))throw'Invalid Input: Field for model "'+a+'" does not exist';return this._data[a]},set:function(a,b){var d=this.getFields();if(!d.hasOwnProperty(a))throw'Invalid Input: Field for model "'+a+'" does not exist';b=c.clean(b,d[a]);if(typeof b=="undefined")throw'Invalid Input: Value is undefined for field "'+a+'"';this._data[a]=b,this._changed=!0,this.fire("change",[{action:"set",name:a,value:b}])},clear:function(a){var b=this.getFields();if(!b.hasOwnProperty(a))throw'Invalid Input: Field for model "'+a+'" does not exist';delete this._data[a],this._changed=!0,this.fire("change",[{action:"clear",name:a}])},update:function(a){var b=this.getKey();a.hasOwnProperty(b)&&a[b]!==this._id&&this.fire("change",[{action:"id",name:b,value:a[b]}]);var c=this.processData(a,!0);this.fire("change",c)},clone:function(){return new this.constructor(this._source)},getId:function(){return this._id},getModel:function(){return this.constructor},isChanged:function(){return this._changed},toObject:function(){var a=b(this._data);return a[this.getKey()]=this._id,a},destroy:function(){delete this._id,delete this._data,delete this._changed}}).include(e),c.get=function(a){if(c.models.hasOwnProperty(a))return c.models[a];throw'No model exists with name "'+a+'"'},c.registerType=function(a,b){c.hasOwnProperty("types")||(c.types={}),c.types[a]=b},c.clean=function(a,b){return c.hasOwnProperty("types")||(c.types={}),c.types.hasOwnProperty(b.type)&&typeof c.types[b.type]=="function"?c.types[b.type].call(this,a,b):a},c.extend=function(a){var b=Class.extend.call(this,a),d=["getType","getFields"];for(var e=0;e<d.length;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";b[d[e]]=a[d[e]]}var f=a.getFields();for(var g in f)if(!f[g].hasOwnProperty("type"))throw"Invalid Field: Missing type declaration";return c.hasOwnProperty("models")||(c.models={}),c.models[b.getType()]=b,b},c.Field={KEY:1,TEXT:2,URL:3,DATE:4,OBJECT:5,ARRAY:6,MODEL:8,MONEY:9,PERCENT:10,NUMBER:11},c.registerType(c.Field.KEY,function(a,b){b.hasOwnProperty("numeric")&&(a=isNaN(a)?undefined:parseInt(a,10));if(!a)throw"Invalid Data: Missing primary key";return a}),c.registerType(c.Field.TEXT,function(a,b){return typeof a=="string"?a:undefined}),c.registerType(c.Field.URL,function(a,b){return typeof a=="string"?a:undefined}),c.registerType(c.Field.DATE,function(a,b){var c;try{c=new Date(a)}catch(d){console.log("date parse failed")}return c instanceof Date?c:undefined}),c.registerType(c.Field.OBJECT,function(a,b){return typeof a=="object"?a:undefined}),c.registerType(c.Field.ARRAY,function(a,b){return a instanceof Array?a:undefined}),c.registerType(c.Field.MODEL,function(a,b){return a}),c.registerType(c.Field.MONEY,function(a,b){return typeof a=="string"&&(a=a.replace(/[$,]/g,"")),isNaN(a)?undefined:parseFloat(a)}),c.registerType(c.Field.PERCENT,function(a,b){typeof a=="string"&&(a=a.replace(/[%]/g,""));if(!isNaN(a))a=parseFloat(a);else return undefined;return b.hasOwnProperty("basis")&&(b.basis==="percent"?a=Math.round(a*1e4)/1e6:b.basis==="bip"&&(a=Math.round(a*1e4)/1e8)),a}),c.registerType(c.Field.NUMBER,function(a,b){return typeof a=="string"&&(a=a.replace(/[,]/g,"")),isNaN(a)?undefined:parseFloat(a)}),a.Model=c}(Orange),function(a){var b,d=a.Model;b=Class.extend({initialize:function(a){this._source=a||[],this.data={},this.list=[],this.handles=[];for(var b=0;b<a.length;b++)this.data[a[b].getId()]=a[b],this.list.push(a[b]),a[b]instanceof d&&this.handles.push(a[b].on("change",this.onModelUpdate,this));this.direction=1,this.sortFields=[]},onModelUpdate:function(a){this.sort(this.sortFields,this.direction)},get:function(a){return this.data.hasOwnProperty(a)?this.data[a]:null},sort:function(a,b,d){function g(a,b){if(a instanceof Date&&b instanceof Date)return a===b?0:a>b?e:f;if(!isNaN(a)&&!isNaN(b)){try{return parseFloat(a)===parseFloat(b)?0:parseFloat(a)>parseFloat(b)?e:f}catch(c){}return!1}try{return a.toLowerCase()===b.toLowerCase()?0:a.toLowerCase()>b.toLowerCase()?e:f}catch(c){}return!1}function h(a,b){var c=0;for(var d=0;d<this.sortFields.length;d++){c=g(a.get([this.sortFields[d]]),b.get([this.sortFields[d]]));if(c)return c}return 0}if(!a)return;b?this.direction=b:b=this.direction;if(a instanceof Array){if(a.length===0)return;this.sortFields=a}else this.sortFields=[a];var e=1*b,f=-1*b;return this.list.sort(c(h,this)),d||this.fire("change"),this},filter:function(a,b){if(!b||b===""){this.clearFilters();return}var c=arguments.length===1,e=[],f,g=new RegExp(c?a:b,"i");for(var h=0;h<this.list.length;h++){this.list[h]instanceof d?f=this.list[h].toObject():f=this.list[h];if(c){for(var i in f)if(g.test(f[i])){e.push(this.list[h]);break}}else if(g.test(f[a])){e.push(this.list[h]);break}}return delete this.list,this.list=e,this.fire("change"),this},clearFilters:function(a){delete this.list,this.list=[];for(var b=0;b<this._source.length;b++)this.list.push(this._source[b]);return this.sort&&this.sort(this.sortFields,this.direction,!0),a||this.fire("change"),this},count:function(){return this.list.length},toObject:function(){var a={};for(var b=0;b<this.list.length;b++)a[this.list[b].getId()]=this.list[b];return a},toArray:function(){return this.list},destroy:function(){if(this.handles.length)for(var a=0;a<this.handles.length;a++)this.handles[a].detach();this.handles=[],delete this._source,delete this.data,delete this.list,delete this.sort}}).include(Events),a.Collection=b}(Orange),function(a){var b={},c=window.localStorage,d=!1,e=!1;if("localStorage"in window)try{window.localStorage.setItem("_test",1),d=!0,window.localStorage.removeItem("_test")}catch(f){}if(d)try{window.localStorage&&(c=window.localStorage)}catch(f){}else if("globalStorage"in window)try{window.globalStorage&&(c=window.globalStorage[window.location.hostname],d=!0)}catch(f){}!JSON&&!JSON.hasOwnProperty("stringify")&&(d=!1),d||Log.warn("No native JSON parser found"),b.get=function(a){if(!d)return;try{var b=JSON.parse(c.getItem(a));if(b!==undefined&&b.data!==undefined)return e&&b.ttl!==-1&&(new Date).getTime()-b.timestamp>b.ttl&&c.removeItem(a),b.data}catch(f){Log.error("Error fetching object from localStorage")}},b.set=function(a,b,e){if(!d||typeof b=="undefined"||!!a.match(/[^A-Za-z:0-9_\[\]]/g))return!1;var f={data:b,timestamp:(new Date).getTime(),ttl:e?e:864e5};try{return c.setItem(a,JSON.stringify(f)),!0}catch(g){g===QUOTA_EXCEEDED_ERR&&Log.error("Storage quota has been exceeded",g)}return!1},b.remove=function(a){if(!d)return!1;c.removeItem(a)},b.flushExpired=function(a){if(!d||e===!1&&a!==!0)return;for(var f in c)b.get(f)},b.flush=function(a){if(!d||e===!1&&a!==!0)return;c.clear(),Log.info("Clear: Local storage cleared")},b.isSupported=function(){return d},b.goOnline=function(){e||console.log("Storage: Went online"),e=!0},b.goOffline=function(){e&&console.log("Storage: Went offline"),e=!1},a.Storage=b}(Orange),function(a){function g(a){var b=["map","from","to","offline","cache","callback"];for(var c=0;c<b.length;c++){if(!a.hasOwnProperty(b[c]))return!1;if(b[c]==="map"&&!h(a[b[c]]))return!1}return!0}function h(a){return!a.hasOwnProperty("model")||!e.get(a.model)||!a.hasOwnProperty("params")?!1:!0}function i(a,b){var c=[],e;if(b instanceof Array){for(var f=0;f<b.length;f++)e=k(a,b[f]),e&&c.push(e);return new d(c)}return!1}function j(a,b){var c=[];for(var d in b)c.push(b[d]);return i(a,c)}function k(a,b){var c={},d,f;for(var g in a.params)b.hasOwnProperty(a.params[g])&&(c[g]=b[a.params[g]]);return d=e.get(a.model),f=new d(c),f||!1}var b,d=a.Collection,e=a.Model,f=a.Storage;b=Class.extend({initialize:function(a,b){this.isOnline=!1,this.cache=[],this.auth=b||null,this.path=a||""},getType:function(){throw"Cannot instantiate service"},getPath:function(){return""},goOnline:function(){this.isOnline=!0},goOffline:function(){this.isOnline=!1},request:function(a,b,d,e,f,h,l){function s(a,b){var c;switch(a){case"parse":c="Error parsing response";break;case"offline":c="Service offline";break;default:c="Service error"}h.call(l||this,b)}function u(a){try{var c=!!a;a=e.callback(a);var d=!!a;if(d!==c)throw"Invalid Mapping: Service callback returning no data";if(e.from==="array"&&e.to==="collection")if(a instanceof Array)a=i(e.map,a);else throw'Invalid Response: Service "'+n+'" expected an array';else if(e.from==="object"&&e.to==="collection"){if(typeof a!="object"||a instanceof Array)throw'Invalid Response: Service "'+n+'" expected an object';a=j(e.map,a)}else if(e.from==="object"&&e.to==="model")if(typeof a=="object")a=k(e.map,a);else throw'Invalid Response: Service "'+n+'" expected an object';e.cache&&b==="GET"&&this.cacheResponse(q,a)}catch(g){s("parse",g);return}f.call(l||this,a)}var m=this.getPath(),n=(m.charAt(0)==="/"?m.substr(1):m)+a,o;if(["GET","POST","PUT","DELETE"].indexOf(b)===-1)throw"Invalid method type";if(!g(e))throw"Invalid configuration";var p=Object.keys(d).sort(),q="service:"+this.getType()+":";for(var r=0;r<p.length;r++)q+=p[r]+":"+md5(d[p[r]])+":";if(e.cache&&this.cache.hasOwnProperty(q)&&this.cache[q]>(new Date).getTime()){try{o=this.retrieveResponse(q,e.map.model,d)}catch(t){}if(o){f.call(l||this,o);return}}if(!this.isOnline){if(e.offline&&b==="GET"){try{o=this.retrieveResponse(q,e.map.model,d)}catch(t){}if(o){f.call(l||this,o);return}}s("offline");return}$.ajax({url:n,type:b,data:d,success:c(u,this),error:s})},cacheResponse:function(a,b){var c,d="object";if(b instanceof Array){c=[];for(var g=0;g<b.length;g++)b[g]instanceof e?(c.push(b[g].getId()),f.set(b[g].getType()+":"+b[g].getId(),b[g].toObject()),d="collection"):(c.push(b[g]),d="array")}else b instanceof e?(c=b.getId(),f.set(b.getType()+":"+c,b.toObject()),d="model"):c=b;return this.cache[a]=(new Date).getTime()+6e4,f.set(a,{type:d,data:c})},retrieveResponse:function(a,b,c){var d=f.get(a),g=e.get(b),h=d.type,i=d.data;if(h==="model"){var j=f.get(b+":"+i),k=new g(j);return k||null}if(h==="collection"){var l=[],m;for(var n=0;n<d.length;n++)m=new g(f.get(b+":"+d[n])),m&&l.push(m);return l}return d||null},modelOrId:function(a){if(a instanceof e)return a.getId();if(typeof a!="object")return a;throw new Error("Invalid Input: Expecting model or id",a)}}),b.get=function(a){b.hasOwnProperty("services")||(b.services={});if(b.services.hasOwnProperty(a))return b.services[a]},b.extend=function(a){var c=Class.extend.call(this,a);b.hasOwnProperty("services")||(b.services={});var d=["getType"];for(var e=0;e<d.length;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";c[d[e]]=a[d[e]]}return b.services[c.getType()]=c,c},a.Service=b}(Orange),function(a){function e(a,b,c){return $.ajax({async:c!==!0,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(c){b(a,c)},error:function(){throw"Error: template not found"}}).responseText}var b={},d={};b.get=function(a,b,c){var e=this,f=[],g;if(!d.hasOwnProperty(a))throw"Path "+a+" has not been loaded";$("<div>"+d[a]+"</div>").children().each(function(){f.push($(this))});for(var h=0;h<f.length;h++){if(typeof b!="undefined"&&f[h].attr("data-control")!==b)continue;if(typeof c!="undefined"&&f[h].attr("data-name")!==c)continue;return f[h]}throw"Could not find view "+b+" at "+a},b.register=function(a,b){function h(a,c){d[a]=c,g--,g===0&&b()}var f,g=a.length;if(g===0)return b();for(var i=0;i<a.length;i++)f=a[i],e(a[i],c(h,this))},a.View=b}(Orange),function(a){var b,c=a.Collection,e=a.Model;b=Class.extend({initialize:function(a){this.target=a,this.template=a.html(),this.data=null,this.handles=[],this.bound=!1,this.binding=!1},bind:function(a,b){if(this.binding){console.log("Error: Already binding");return}this.binding=!0,this.bound&&this.unbind(),this.bound=!0,this.data=a,a instanceof c?(this.bindCollection(this.target,a),this.handles.push(a.on("change",this.onCollectionUpdate,this))):a instanceof Array?this.bindList(this.target,a):a instanceof e?(this.bindModel(this.target,a),this.handles.push(a.on("change",this.onModelUpdate,this))):typeof a=="object"&&this.bindData(this.target,a),this.binding=!1},onCollectionUpdate:function(a){if(this.handles.length)for(var b=0;b<this.handles.length;b++)this.handles[b].detach();this.handles=[],this.target.html(this.template),this.bindCollection(this.target,this.data),this.handles.push(this.data.on("change",this.onCollectionUpdate,this))},onModelUpdate:function(a){var b=a.data,c=a.target.getId(),d=a.target.getType();a.target.getItemType()&&(d=a.target.getItemType());if(b instanceof Array&&b.length>0)for(var e=0;e<b.length;e++)this.onModelKeyUpdate(b[e],c,d)},onModelKeyUpdate:function(a,b,c){var e=a.action,f=a.name,g=a.value,h;this.target.attr("itemid")===b.toString()&&this.target.attr("itemtype")===c?(h=this.target,e==="id"&&this.target.attr("itemid",g)):(h=this.target.find('[itemid="'+b+'"][itemtype="'+c+'"]'),e==="id"&&h.attr("itemid",g));var i=d(h,'[itemprop="'+f+'"]');for(var j=0;j<i.length;j++)e==="set"?g instanceof Date?this.bindItem(i[j],g):typeof data=="object"?this.bindItem(i[j],g):this.bindItem(i[j],g):e==="clear"&&i[j].empty()},bindCollection:function(a,b){this.bindList(a,b.toArray())},bindList:function(a,b){var c=a.find("[itemscope]:first"),d=c.clone(),f=a.clone(),g;if(!c.length)throw"Invalid Markup: Cannot bind collection to view missing [itemscope]";c.remove(),c=null;for(var h=0;h<b.length;h++)g=d.clone(),b[h]instanceof e?this.bindModel(g,b[h]):this.bindData(g,b[h]),f.append(g);a.html(f.html())},bindModel:function(a,b){b.getItemType()?a.attr("itemtype",b.getItemType()):a.attr("itemtype",b.getType()),a.attr("itemid",b.getId()),a.attr("itemscope"),this.handles.push(b.on("change",this.onModelUpdate,this)),this.bindData(a,b.toObject())},bindData:function(a,b){var c=[],e;if(typeof b=="string"&&a.has("[itemscope]")){this.bindItem(a,b);return}if(b instanceof Date){this.bindItem(a,b);return}c=d(a,"[itemprop]");for(var f=0;f<c.length;f++)e=c[f].attr("itemprop")||null,e&&b.hasOwnProperty(e)&&(b[e]instanceof Array?this.bindList(c[f],b[e]):b[e]instanceof Date?this.bindItem(c[f],b[e]):typeof b[e]=="object"?this.bindData(c[f],b[e]):this.bindItem(c[f],b[e]))},bindItem:function(a,b){if(b instanceof Date){a.attr("datetime",b.toString());var c=a.attr("data-format");c&&c.length>0?a.text(b.format(c.toLowerCase())):a.text(b.getMonth()+"/"+b.getDate()+"/"+b.getFullYear())}else if(typeof b=="string"||typeof b=="number")a.prop("tagName")==="META"?a.attr("content",b):a.text(b)},unbind:function(){this.data=null;if(this.handles.length)for(var a=0;a<this.handles.length;a++)this.handles[a].detach();this.handles=[],this.target.html(this.template)},destroy:function(){delete this.target,delete this.template,delete this.data,delete this.handle,delete this.bound,delete this.binding}}),a.Binding=b}(Orange),function(a){function k(a,b){b=$(b).eq(0),a=$(a)[0];for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];b.attr(d.name,d.value)}}function l(a,b){var c=$(a).get(0),d={},e=[];for(var f=0,g=c.attributes.length;f<g;f++)c.attributes[f].name.match(b)&&(d[c.attributes[f].name.replace(b,"")]=c.attributes[f].value,e.push(c.attributes[f].name));for(var h=0;h<e.length;h++)$(a).removeAttr(e[h]);return d}function m(a,b){var c=this.getRoutes(),d,e;a&&a.charAt(0)==="/"&&(a=a.substr(1));for(var f in c){e=f.substr(1).split("/").shift();if(e.indexOf(":")!==-1||!e)d="/"+e;if(e===a)return f}return b?null:d}var b,e=a.Binding,f=a.Browser,g=a.Deferred,h=a.Form,i=a.Model,j=a.View;b=Class.extend({initialize:function(a,b,c){this._initialized=!1,this.app=c,this.parent=a||null,this.target=$(b),this._views=this.setupViews(),this._forms=this.setupForms(),this._elems=this.setupElements(),this._attrs=this.setupAttributes(),this.validateOutlets(),this._source=this.target.outerHTML(),this._queue=[],this._bindings={},this._loaded=!1,this._visible=!1,this.setupTransitions(),typeof this.target=="object"&&this.target.addClass("hidden"),this.validate(),this.setup(),this._initialized=!0},setupAttributes:function(){if(this._initialized)return;var a=l(this.target,/data-/);return a.hasOwnProperty("name")||(a.name=a.control),a.hasOwnProperty("state")?(this._state=a.state,this.target.addClass(a.state)):this._state=null,this.target.addClass("view"),typeof this.typeList!="undefined"&&this.target.addClass(this.typeList),this.target.addClass(a.name),a},setupViews:function(){if(this._initialized)return;var a=d(this.target,"[data-control]"),c={},e,f,g,h,i;for(var l=0;l<a.length;l++)f=a[l].attr("data-control"),e=a[l].attr("data-name")||f,h=a[l].attr("data-template"),h&&h.length>0&&(g=j.get(h,f,e),a[l].html(g.html()),k(g,a[l]),a[l].removeAttr("data-template")),i=b.get(f),c[e]=new i(this,a[l],this.app);return c},setupForms:function(){if(this._initialized)return;var a=d(this.target,"form"),b={},c,e;for(var f=0,g=a.length;f<g;f++)c=a[f].attr("name"),e=new h(a[f]),b[c]=e;return b},setupElements:function(){if(this._initialized)return;var a=d(this.target,"[data-name]:not([data-control])"),b={},c;for(var e=0;e<a.length;e++)c=a[e].attr("data-name"),c.length>0&&(b[c]=a[e],a[e].removeAttr("data-name").addClass(c));return b},validateOutlets:function(){var a=this.getOutlets(),b=[],c,d;if(a.hasOwnProperty("views"))for(d=0;d<a.views.length;d++)this.hasView(a.views[d])||b.push(a.views[d]);if(a.hasOwnProperty("forms"))for(d=0;d<a.forms.length;d++)this.hasForm(a.forms[d])||b.push(a.forms[d]);if(a.hasOwnProperty("elements"))for(d=0;d<a.elements.length;d++)this.hasElement(a.elements[d])||b.push(a.elements[d]);if(b.length>0)throw'Invalid Syntax: ViewController "'+this.attr("name")+'" missing outlets ['+b.join(", ")+"]";var e=this.getRoutes(),f=m.call(this,"");if(!f&&!this.attr("default")&&Object.keys(e).length>0)throw'Invalid Syntax: View Controller "'+this.attr("name")+'" must define either a [data-default] or generic / route';for(var g in e)if(g.charAt(0)!=="/")throw'Invalid Syntax: Route "'+g+'" in '+this.attr("name")+" must begin with forward slash"},setupTransitions:function(){if(this._initialized)return;this.on("_load",this.onLoad,this),this.on("_loaded",this.onDidLoad,this),this.on("_appear",this.onAppear,this),this.on("_appeared",this.onDidAppear,this),this.on("_disappear",this.onDisappear,this),this.on("_disappeared",this.onDidDisappear,this),this.on("_unload",this.onUnload,this),this.on("_unloaded",this.onDidUnload,this)},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},destroy:function(){for(var a in this._views)this._views[a].destroy(),delete this._views[a];for(var b in this._forms)this._forms[b].destroy(),delete this._forms[b];for(var c in this._elems)delete this._elems[c];delete this.target,delete this.parent,delete this._source,delete this._queue},getType:function(){return"view"},getBindings:function(){return{}},getOutlets:function(){return{}},getRoutes:function(){return{}},validate:function(){},setup:function(){},add:function(a,b,c){return this._queue.push({fn:a,args:b,wait:c}),this._running||this.next(),this},next:function(){this._running=!0;var a=this._queue.shift();if(a){a.fn.apply(this,a.args);if(a.fn===this._setState||a.fn===this._clearState)this._process=setTimeout(c(function(){this.next()},this),a.wait)}else this._running=!1},stop:function(){return this._queue=[],this._process&&(clearTimeout(this._process),this.next()),this},when:function(){return a.when.apply(this,arguments)},then:function(){return this.promise().then.apply(this,arguments)},promise:function(){function b(){a.resolve()}var a=new g(this);return this.add(b),a},setRoute:function(a){return this.add(this._setRoute,[a],0)},getRoute:function(){return this.route},_setRoute:function(a){a.substr(0,1)!=="/"&&(a="/"+a);var b=m.call(this,a);if(this.route===a){this.next();return}var c=b.match(/[^:]*/).pop();c.charAt(c.length-1)==="/"&&(c=c.slice(0,-1));var d="#!"+this._routes+c;location.hash=d,this.next()},setHashRoute:function(a,b){return this.add(this._setHashRoute,[a,b],0),this},_setHashRoute:function(a,b){function c(a,b){for(var c in this._views)this.getView(c).setHashRoute(a.slice(0),b)}b=b?b:"";var d=this.getRoutes();if(Object.keys(d).length===0){c.call(this,a,b),this.next();return}var e=a.slice(0).shift(),f=m.call(this,e,!0);f?a.shift():(f=m.call(this,e),e=""),f||(f=m.call(this,this.attr("default")));var g=f.substr(1).split("/"),h={},i;this._routes=b||"",e&&(b+="/"+e);for(var j=0;j<g.length;j++)g[j].charAt(0)===":"&&(i=a.shift()||null,h[g[j].substr(1)]=i,this.attr(g[j].substr(1),i),b+="/"+i);d.hasOwnProperty(f)&&d[f].call(this,this.route,h),c.call(this,a,b),this.route=e,this.next()},getState:function(){return this._state},setState:function(a,b){return this.add(this._setState,[a],b||0)},clearState:function(a){return this.add(this._clearState,[],a||0)},_setState:function(a,b){if((this.hasState(a)||!this._loaded)&&!b)return;this.target.removeClass(this._state),this.target.addClass(a),this._state=a},_clearState:function(){this.target.removeClass(this._state),this._state=null},hasState:function(a){return this._state===a},load:function(){return this.add(this._load)},show:function(){return this.add(this._show)},hide:function(){return this.add(this._hide)},unload:function(){return this.add(this._unload)},append:function(){return this.add(this._append)},remove:function(){return this.add(this._remove)},_load:function(){if(this._loaded){this.next();return}this.onWillLoad()},_show:function(){if(this._visible){this.next();return}if(!this._loaded)throw new Error("Invalid Request: Cannot show unloaded ViewController");this.onWillAppear()},_hide:function(){if(!this._visible){this.next();return}this.onWillDisappear()},_unload:function(){if(!this._loaded){this.next();return}if(this._visible)throw new Error("Invalid Request: Cannot unload visible ViewController");this.onWillUnload()},onWillLoad:function(){this.fire("_load")},onLoad:function(){var a=Object.keys(this._views).length;if(a===0)this.fire("_loaded");else for(var b in this._views){var d=this._views[b];d.once("load",c(function(){a--,a===0&&this.fire("_loaded")},this)),d.load()}},onDidLoad:function(){console.log(this.attr("name")+" Loaded"),this._loaded=!0,this.fire("load"),this.next()},onWillUnload:function(){this.fire("_unload")},onUnload:function(){var a=Object.keys(this._views).length;if(a===0)this.target.remove(),this.fire("_unloaded");else for(var b in this._views){var d=this._views[b];d.once("unload",c(function(){a--,a===0&&(this.target.remove(),this.fire("_unloaded"))},this)),d.unload()}},onDidUnload:function(){console.log(this.attr("name")+" Unloaded"),this._loaded=!1,this.fire("unload"),this.next()},onWillAppear:function(){var a=this.getBindings(),b,d;for(var e in a){var g=a[e];for(var h in g){var i=null;typeof g[h]=="function"?i=g[h]:this.hasOwnProperty(g[h])&&(i=this[g[h]]),h==="touchclick"&&(h=f.touch?"touchend":"click");if(i===null){var j=h.charAt(0).toUpperCase()+h.slice(1);i=g[h]===!0&&typeof this["on"+j]=="function"?this["on"+j]:null}d=e.match(/\(.+\)/gi),e.match(/\$target/)?d&&d.length>0?this.target.on(h,d.pop().replace(/[()]/g,""),c(i,this)):this.target.on(h,c(i,this)):i!==null&&this.hasView(e)?this.getView(e).on(h,c(i,this)):i!==null&&this.hasForm(e)?this.getForm(e).on(h,c(i,this)):i!==null&&this.hasElement(e)&&(this.getElement(e).on(h,c(i,this)),d&&d.length>0?(b=e.replace(/\(.+\)/gi,""),this.getElement(b).on(h,d.pop().replace(/[()]/g,""),c(i,this))):this.getElement(e).on(h,c(i,this)))}}this.target.removeClass("hidden"),this.fire("_appear")},onAppear:function(a){var b=Object.keys(this._views).length;if(b===0)this.fire("_appeared");else for(var d in this._views){var e=this._views[d];e.once("appear",c(function(){b--,b===0&&this.fire("_appeared")},this)),e.show()}},onDidAppear:function(a){console.log(this.attr("name")+" Appeared"),this._visible=!0,this.fire("appear"),this.next()},onWillDisappear:function(){for(var a in this._views)this.getView(a).detach();for(var b in this._forms)this.getForm(b).detach();for(var c in this._elems)this.getElement(c).unbind();this.fire("_disappear")},onDisappear:function(a){var b=Object.keys(this._views).length;if(b===0)this.fire("_disappeared");else for(var d in this._views){var e=this._views[d];e.once("disappear",c(function(){b--,b===0&&this.fire("_disappeared")},this)),e.hide()}},onDidDisappear:function(a){console.log(this.attr("name")+" Disappeared"),this.target.addClass("hidden"),this._visible=!1,this.fire("disappear"),this.next()},attr:function(){var a=arguments;if(a.length===1)return this._attrs.hasOwnProperty(a[0])?this._attrs[a[0]]:!1;a.length===2&&(this._attrs[a[0]]=a[1])},getViews:function(){return this._views},getView:function(a){if(a instanceof b)return a;if(typeof this._views[a]!="undefined")return this._views[a];throw new Error('Invalid Request: View "'+a+'" not found')},getForm:function(a){if(this._forms[a]instanceof h)return this._forms[a];throw new Error('Invalid Request: Form "'+a+'" not found')},getElement:function(a){if(typeof this._elems[a]!="undefined")return this._elems[a];throw new Error('Invalid Request: Element "'+a+'" not found')},hasView:function(a){return typeof this._views[a]!="undefined"},hasForm:function(a){return typeof this._forms[a]!="undefined"},hasElement:function(a){return typeof this._elems[a]!="undefined"},addView:function(a,c,d){if(this.hasView(c))throw new Error("Invalid Request: ViewController "+c+" already exists");var e=b.get(a),f=j.get(d,a,c);return e&&(this._views[c]=new e(this,f,this.app)),this._views[c]},removeView:function(a){this.hasView(a)&&(this._views[a].hide().unload().destroy(),delete this._views[a])},bind:function(a,b){if(!this.hasElement(a))throw'Invalid Resource: Element "'+a+'" is not defined';this._bindings.hasOwnProperty(a)&&this.unbind(a),this._bindings[a]=new e(this.getElement(a)),this._bindings[a].bind(b)},unbind:function(a){if(!this.hasElement(a))throw'Invalid Resource: Element "'+a+'" is not defined';this._bindings.hasOwnProperty(a)&&(this._bindings[a].unbind(),delete this._bindings[a])},getService:function(a){return this.app.getService(a)},goOnline:function(){for(var a in this._views)this._views[a].goOnline()},goOffline:function(){for(var a in this._views)this._views[a].goOffline()}}).include(Events),b.views={view:b},b.extend=function(a){if(!a.hasOwnProperty("getType"))throw'Missing Implementation: ViewController missing "getType" implementation';var c=Class.extend.call(this,a),d=a.getType();if(b.views.hasOwnProperty(d))throw'Duplicate Class: ViewController "'+d+'" is already defined';return c.prototype.typeList?c.prototype.typeList+=" "+d:c.prototype.typeList=d,c.extend=b.extend,b.views[d]=c},b.get=function(a){if(this.views.hasOwnProperty(a))return this.views[a];throw'Invalid Resource: ViewController "'+a+'" not defined'},a.ViewController=b}(Orange),function(a){function j(a){typeof a=="function"&&$(document).ready(function(){$("body").hide();var c=$("[data-app]").text();if(c){c=JSON.parse(c);var d=new b(c);a.call(this,d),d.launch()}})}var b,d=a.Cache,e=a.Loader,f=a.Service,g=a.Storage,h=a.View,i=a.ViewController;b=Class.extend({initialize:function(a){if(!a.hasOwnProperty("name"))throw"Invalid application";this.name=a.name,this.version=a.hasOwnProperty("version")?a.version:null,this.required=a.hasOwnProperty("required")?a.required:[],this.loaded=!1,this.online=!1,this.env=a.hasOwnProperty("env")?a.env:"PROD";for(var b=0,c=this.required.length;b<c;b++)e.loadModule(this.required[b]);this.servicePaths={},this.services={},this.serviceConfig={},this.authService=null,this.constants={},this.templates=[],this.authenticated=!1,this.viewLoaded=!1},loadServices:function(){for(var a in this.serviceConfig){var b=f.get(a),c=this.serviceConfig[a],d={};Object.keys(c.paths).length>0&&typeof c.paths[this.env]!==undefined?d={path:c.paths[this.env],auth:c.auth}:d={path:this.servicePaths[this.env],auth:c.auth};var e=new b(d.path,d.auth);this.services[a]=e}},authenticate:function(a,b,c){if(!this.authService){a.call(c);return}if(!this.services.hasOwnProperty(this.authService))throw"Cannot load authentication service";var d=this.services[this.authService];if(typeof d.authenticate=="function")d.authenticate(a,b,c);else throw"Authentication service must implement authenticate()"},setEnvironment:function(a){this.env=a},setLogging:function(a){this.levels=a},setConstant:function(a,b){this.constants[a]=b},getConstant:function(a){return this.constants.hasOwnProperty(a)?this.constants[a]:null},getService:function(a){return this.services.hasOwnProperty(a)?this.services[a]:null},registerService:function(a,b,c){this.serviceConfig[a]={auth:b||null,paths:c||{}}},setAuthentication:function(a){this.authService=a},registerServicePaths:function(a){this.servicePaths=a},registerViews:function(a){a instanceof Array&&(this.templates=a)},onHashChange:function(a){var b=location.hash;b.substr(0,2)==="#!"?b=b.replace("#!",""):b=b.replace("#","");var c=[];b.charAt(0)==="/"&&(b=b.substr(1)),c=b.split("/"),this.root.setHashRoute(c.slice(0))},onOnline:function(){this.online||console.log("Application: Went online"),this.online=!0;for(var a in this.services)this.services[a].goOnline();g.goOnline(),this.root&&this.root.goOnline()},onOffline:function(){this.online&&console.log("Application: Went offline"),this.online=!1;for(var a in this.services)this.services[a].goOffline();g.goOffline(),this.root&&this.root.goOffline()},onAuthSuccess:function(){this.authService&&console.log("User: Authenticated successfully");var a=$("[data-root]");if(a.length===0)throw"Invalid Markup: No [data-root] view found";var b=a.attr("data-control");if(!b)throw"Invalid Markup: Root View missing [data-control]";var d=i.get(b);this.root=new d(null,a,this),this.root.load().show(),this.online?this.root.goOnline():this.root.goOffline(),$(window).on("hashchange",c(this.onHashChange,this)),$(window).trigger("hashchange"),$("body").show()},onAuthFailure:function(){console.log("Could not authenticate")},launch:function(){if(this.loaded)return;!this.levels||!this.levels.hasOwnProperty(this.env)?Log.setLevel("DEBUG"):Log.setLevel(this.levels[this.env]);var a=g.get("appversion"),b=g.get("appenv");this.version&&(this.version!==a||this.env!==b)&&(g.flush(!0),g.set("appversion",this.version),g.set("appenv",this.env)),d.init(function(a){this.loadServices(),a?this.onOnline():this.onOffline(),d.on("online",function(a){a.data?this.onOnline():this.onOffline()},this),this.authenticate(c(function(){this.authenticated=!0,this.viewLoaded&&this.onAuthSuccess.call(this)},this),this.onAuthFailure,this),h.register(this.templates,c(function(){this.viewLoaded=!0,console.log("Views: loaded and cached"),this.authenticated&&this.onAuthSuccess.call(this)},this))},this)}}),a.Application=b,a.config=j}(Orange);