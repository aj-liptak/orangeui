/**
 * OrangeUI | 0.5.0 | 09.09.2012
 * https://github.com/brew20k/orangeui
 * Copyright (c) 2012 Kevin Kinnebrew
 */
function noop(){}function clone(e){var t,n=e instanceof Array?[]:{};for(t in e){if(t==="clone")continue;e[t]&&e[t]instanceof Date?n[t]=new Date(e[t]):e[t]&&typeof e[t]=="object"?n[t]=clone(e[t]):n[t]=e[t]}return n}function proxy(e,t){var n=t;return function(){return e.apply(n,arguments)}}jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},function(){function l(){var e=arguments,t=e[0],n=typeof e[1]=="function"?e[1]:null,r=e[2];u.Loader.addModule(t,n,r)}function c(){var e=Array.prototype.slice.call(arguments),t=e[e.length-1],n=clone(e).splice(0,e.length-1);if(typeof n[0]!="function")for(var r=0,i=n.length;r<i;r++)u.Loader.loadModule(n[r]);t.call(window,u)}function h(e){if(typeof u.modules[e]!==undefined)return u.modules[e];throw"Could not require module"}var e,t,n,r,i,s,o,u={},a=/[^A-Za-z:0-9_\[\]]/g,f=/[^A-Za-z\-_]/g;t=function(){function n(){}var e=!1,t=/\b_super\b/;return n.extend=function(r){function u(){!e&&this.initialize&&this.initialize.apply(this,arguments)}var i,s,o=this.prototype;e=!0,i=new this,e=!1;for(s in r)i[s]=typeof r[s]=="function"&&typeof o[s]=="function"&&t.test(r[s])?function(e,t){return function(){var n=this._super;this._super=o[e];var r=t.apply(this,arguments);return this._super=n,r}}(s,r[s]):r[s];return u.prototype=i,u.prototype.constructor=u,u.extend=n.extend,u.include=n.include,u},n.include=function(e){var t,n,r;if(!e)throw"Missing definition";for(t in e)n=e[t],Array.prototype.indexOf.call(["extend","mixin"],t)<0&&(this.prototype[t]=n);return this},n}(),r=function(){function e(e,t,n,r){this.bubbles=!0,this.currentTarget=t,this.data=r,this.target=n,this.type=e}return e.prototype.stopPropagation=function(){this.bubbles=!1},e}(),i=function(){function e(e,t,n){this.call=n,this.ev=t,this.target=e}return e.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call},e}(),n={on:function(e,t,n){var r=typeof n!="undefined"?proxy(t,n):t;return this._listeners||(this._listeners={}),this._listeners.hasOwnProperty(e)||(this._listeners[e]=[]),this._listeners[e].push(r),new i(this,e,r)},once:function(e,t,n){var r=typeof n!="undefined"?proxy(t,n):t,i=function(){t.apply(this,arguments),this.detach(e,r)};this.on(e,i)},fire:function(e,t){var n=this.parent||null,i=e;typeof e=="string"&&(e=new r(e,this,this,t));if(typeof e.type!="string")throw"Error: Invalid 'type' when firing event";this._listeners||(this._listeners={});if(this._listeners[e.type]instanceof Array){var s=this._listeners[e.type];for(var o=0,u=s.length;o<u;o++)s[o].call(this,e,t)}n!=null&&e.bubbles&&i[0]!=="_"&&(e.currentTarget=this.parent,n.fire.call(n,e,t))},detach:function(e,t){var n=[];this._listeners||(this._listeners={});if(typeof e=="undefined")this._listeners={};else if(this._listeners[e]instanceof Array)if(typeof t!="undefined"){n=this._listeners[e];for(var r=0,i=n.length;r<i;r++)if(n[r]===t){n.splice(r,1);break}}else this._listeners[e]=[]}},s=function(){var e={},t={},n={};return u.modules={},{addModule:function(t,n,r){if(!t.match(/[\^\-A-Za-z_]/g))throw"Invalid module name";var i={name:t,fn:n,req:r!==undefined?r:[]};e[t]=i},loadModule:function(r){if(t.hasOwnProperty(r))return;if(e[r]!==undefined){t[r]=!0;for(var i=0,s=e[r].req.length;i<s;i++){if(e[r].req[i]===r)continue;this.loadModule(e[r].req[i])}e[r].fn.call(window,n),u.modules[r]=n}}}}(),o=function(){function t(t,n,r){this.level>t&&(this.fire("msg",{message:n,ex:r}),r?console.log("["+e[t]+"]",n,r):console.log("["+e[t]+"]",n))}function r(){this.level=1}var e=["OFF","ERROR","WARN","INFO","DEBUG"];for(var i in n)r[i]=n[i];return r.prototype.setLevel=function(t){if(t in e)switch(t){case"DEBUG":t=4;break;case"INFO":t=3;break;case"WARN":t=2;break;case"ERROR":t=1;break;default:t=0}},r.prototype.debug=function(e,n){t.call(this,4,e,n)},r.prototype.info=function(e,n){t.call(this,3,e,n)},r.prototype.warn=function(e,n){t.call(this,2,e,n)},r.prototype.error=function(e,n){t.call(this,1,e,n)},r}(),e={touch:"ontouchstart"in window||window.hasOwnProperty("DocumentTouch")&&document instanceof DocumentTouch,location:"geolocation"in navigator},u=this.Orange={modules:{}},u.version="0.5.0",u.add=l,u.use=c,u.include=this.include=h,u.Browser=e=e,u.Class=this.Class=t,u.Events=this.Events=n,u.EventHandle=i,u.Loader=s,u.Log=this.Log=new o}.call(this),Array.prototype.clone=function(){return this.slice(0)},Array.prototype.indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},function(e){function u(){n!==null&&(clearTimeout(n),n=null)}function a(e){var o=Math.floor(Math.random()*1e4);if(navigator.onLine&&!s){i=!0,s=!0,t.fire("online",!0),e&&e(!0),r&&setTimeout(a,1e4);return}u(),n=setTimeout(function(){navigator.onLine&&!s?(i=!0,s=!0,t.fire("online",!0)):navigator.onLine?$.ajax({url:"ping.js?q="+o,type:"GET",success:function(){i===!1&&(i=!0,t.fire("online",!0))},error:function(){i===!0&&(i=!1,t.fire("online",!1))}}):setTimeout(function(){i===!0&&(i=!1,t.fire("online",!1))},100),n=null,r&&setTimeout(a,1e4)},s?100:0)}function f(){window.applicationCache.swapCache(),Log.debug("Cache updated and ready"),window.location.reload(!0)}var t={},n=null,r=!1,i=!1,s=!1,o=!1;for(var l in Events)t[l]=Events[l];t.init=function(e,n){if(o)return;r=!1,o=!0,$(window).bind("offline",a),$(window).bind("online",a),$(window).bind("updateready",f),a.call(t,proxy(e,n))},t.updateNetworkStatus=function(e){a.call(t)},t.isActive=function(){return o},t.isOnline=function(){return i},e.Cache=t}(Orange),function(e){var t;t=Class.extend({initialize:function(e,t){this.model=e,this.data=t,this.active=t,this.list=this.toArray(),this.events=[],this.events.push(this.model.on("datachange",Class.proxy(this.mergeDeltas,this))),this.events.push(this.model.on("datasync",Class.proxy(this.syncDeltas,this)))},mergeDeltas:function(e){var t=e.data;t.action==="set"?(this.data[t.id]=t.item,this.active.hasOwnProperty(t.id)&&(this.active[t.id]=t.item)):t.action==="delete"&&(this.data.hasOwnProperty(t.id)&&delete this.data[t.id],this.active.hasOwnProperty(t.id)&&delete this.active[t.id]),this.list=this.toArray()},syncDeltas:function(e){var t=e.data;if(this.data.hasOwnProperty(t.oldId)){var n=this.data["c"+t.oldId];delete this.data["c"+t.oldId],this.data[t.id]=n,this.data[t.id][this.model.getKey()]=t.id,this.data[t.id]._unsaved&&delete this.data[t.id]._unsaved,this.active.hasOwnProperty(t.oldId)&&(delete this.active[t.oldId],this.active[t.id]=n),this.list=this.toArray()}},count:function(){return this.list.length},get:function(e){return this.data.hasOwnProperty(e)?new this.model(this.data[e]):null},filter:function(e){if(typeof e=="function"&&this.active!==undefined)for(var t in this.active)e.call(this,this.active[t]||{})||delete this.active[t]},clearFilters:function(){this.active=this.data},toArray:function(){var e=[];for(var t in this.active)e.push(this.active[t]);return e},toObject:function(){return this.active},getModel:function(){return this.model},destroy:function(){for(var e=0,t=this.events.length;e<t;e++)this.events[e].detach();this.events=[]}}).include(Events),e.Collection=t}(Orange),function(e){var t,n=e.Model;t=Class.extend({initialize:function(e){var t=this,r,i;this.target=e,this.fields={},this.target.find("input, select, textarea, checkbox").not('input[type="submit"]').not('input[type="button"]').each(function(){var e=$(this).attr("name");e&&(t.fields[e]=$(this))}),r=this.target.attr("data-model"),r&&(i=n.load(r),i&&this.build(i)),this.target.submit(proxy(this.$onSubmit,this))},get:function(e){if(this.fields.hasOwnProperty(e))return this.fields[e].val()},set:function(e,t){this.fields.hasOwnProperty(e)&&this.fields[e].val(t)},clear:function(e){this.fields.hasOwnProperty(e)&&this.fields[e].val("")},disable:function(){for(var e in this.fields)this.fields[e].attr("disabled","disabled")},enable:function(){for(var e in this.fields)this.fields[e].removeAttr("disabled")},build:function(e){var t=e.getSchema()},getData:function(){var e={};for(var t in this.fields)e[t]=this.fields[t].val();return e},setData:function(e){for(var t in this.fields)e.hasOwnProperty(t)&&this.fields[t].val(e[t])},$onSubmit:function(e){var t=this.target.attr("action");if(typeof t!="undefined")return;e.preventDefault(),this.fire("submit",this.getData())},destroy:function(){for(var e in this.fields)delete this.fields[e]}}).include(Events),e.Form=t}(Orange),function(e){function o(){return(new Date).getTime()-i>s}function u(e,t){i=(new Date).getTime(),r=t.coords,typeof e=="function"&&e(t.coords)}function a(e){switch(e.code){case e.TIMEOUT:Log.warn("Location services timeout");break;case e.POSITION_UNAVAILABLE:Log.warn("Position unavailable");break;case e.PERMISSION_DENIED:Log.warn("Please Enable Location Services");break;default:Log.info("Unknown location services error")}}var t={},n=e.Browser,r=null,i=null,s=36e5;t.get=function(e,t){if(!n.location){t.call(this);return}if(typeof e!="function")return;if(r&&!o())return e(r);var i=function(e){a(e),t&&t.call(this)},s=function(t){u(e,t)};navigator.geolocation.getCurrentPosition(s,i)},e.Location=t}(Orange),function(e){var t,n=e.Collection,r=e.Events;t=Class.extend({initialize:function(e){var n=this.getKey();this._id=null,this._data={},this._changed=!1;var r=!1,i=this.getFields();for(var s in i){r=i[s].type===t.Field.KEY;if(e.hasOwnProperty(s)&&typeof e[s]!="undefined")r?this._id=t.clean(e[s],i[s]):this._data[s]=t.clean(e[s],i[s]);else if(i[s].hasOwnProperty("required")&&i[s].required||r)throw'Field Missing: "'+s+'" on model "'+this.getType()+'"'}},getType:function(){throw"Cannot instantiate model"},getItemType:function(){return null},getKey:function(){var e=this.getFields();for(var n in e)if(e[n].type===t.Field.KEY)return n},getFields:function(){throw"Cannot instantiate model"},get:function(e){var t=this.getFields();if(!t.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';return this._data[e]},set:function(e,n){var r=this.getFields();if(!r.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';n=t.clean(n,r[e]);if(typeof n=="undefined")throw'Invalid Input: Value is undefined for field "'+e+'"';this._data[e]=n,this._changed=!0},clear:function(e){var t=this.getFields();if(!t.hasOwnProperty(e))throw'Invalid Input: Field for model "'+e+'" does not exist';delete this._data[e],this._changed=!0},getId:function(){return this._id},getModel:function(){return this.constructor},isChanged:function(){return this._changed},toObject:function(){var e=clone(this._data);return e[this.getKey()]=this._id,e},destroy:function(){delete this._id,delete this._data,delete this._changed}}).include(r),t.get=function(e){if(t.models.hasOwnProperty(e))return t.models[e];throw'No model exists with name "'+e+'"'},t.registerType=function(e,n){t.hasOwnProperty("types")||(t.types={}),t.types[e]=n},t.clean=function(e,n){return t.hasOwnProperty("types")||(t.types={}),t.types.hasOwnProperty(n.type)&&typeof t.types[n.type]=="function"?t.types[n.type].call(this,e,n):e},t.extend=function(e){var n=Class.extend.call(this,e),r=["getType","getFields"];for(var i=0;i<r.length;i++){if(!e.hasOwnProperty(r[i]))throw"Class missing '"+r[i]+"()' implementation";n[r[i]]=e[r[i]]}var s=e.getFields();for(var o in s)if(!s[o].hasOwnProperty("type"))throw"Invalid Field: Missing type declaration";return t.hasOwnProperty("models")||(t.models={}),t.models[n.getType()]=n,n},t.Field={KEY:1,TEXT:2,URL:3,DATE:4,OBJECT:5,ARRAY:6,MODEL:8,MONEY:9,PERCENT:10,NUMBER:11},t.registerType(t.Field.KEY,function(e,t){t.hasOwnProperty("numeric")&&(e=isNaN(e)?undefined:parseInt(e,10));if(!e)throw"Invalid Data: Missing primary key";return e}),t.registerType(t.Field.TEXT,function(e,t){return typeof e=="string"?e:undefined}),t.registerType(t.Field.URL,function(e,t){return typeof e=="string"?e:undefined}),t.registerType(t.Field.DATE,function(e,t){var n;try{n=new Date(e)}catch(r){console.log("date parse failed")}return n instanceof Date?n:undefined}),t.registerType(t.Field.OBJECT,function(e,t){return typeof e=="object"?e:undefined}),t.registerType(t.Field.ARRAY,function(e,t){return e instanceof Array?e:undefined}),t.registerType(t.Field.MODEL,function(e,t){return e}),t.registerType(t.Field.MONEY,function(e,t){return typeof e=="string"&&(e=e.replace(/[$,]/g,"")),isNaN(e)?undefined:parseFloat(e)}),t.registerType(t.Field.PERCENT,function(e,t){return typeof e=="string"&&(e=e.replace(/[%]/g,"")),isNaN(e)?undefined:(e=parseFloat(e),t.hasOwnProperty("basis")&&(t.basis==="percent"?e=Math.round(e*1e4)/1e6:t.basis==="bip"&&(e=Math.round(e*1e4)/1e8)),e)}),t.registerType(t.Field.NUMBER,function(e,t){return typeof e=="string"&&(e=e.replace(/[,]/g,"")),isNaN(e)?undefined:parseFloat(e)}),e.Model=t}(Orange),function(e){var t={},n=window.localStorage,r=!1,i=!1;if("localStorage"in window)try{window.localStorage.setItem("_test",1),r=!0,window.localStorage.removeItem("_test")}catch(s){}if(r)try{window.localStorage&&(n=window.localStorage)}catch(s){}else if("globalStorage"in window)try{window.globalStorage&&(n=window.globalStorage[window.location.hostname],r=!0)}catch(s){}!JSON&&!JSON.hasOwnProperty("stringify")&&(r=!1),r||Log.warn("No native JSON parser found"),t.get=function(e){if(!r)return;try{var t=JSON.parse(n.getItem(e));if(t!==undefined&&t.data!==undefined)return i&&t.ttl!==-1&&(new Date).getTime()-t.timestamp>t.ttl&&n.removeItem(e),t.data}catch(s){Log.error("Error fetching object from localStorage")}},t.set=function(e,t,i){if(!r||typeof t=="undefined"||!!e.match(/[^A-Za-z:0-9_\[\]]/g))return!1;var s={data:t,timestamp:(new Date).getTime(),ttl:i?i:864e5};try{return n.setItem(e,JSON.stringify(s)),!0}catch(o){o===QUOTA_EXCEEDED_ERR&&Log.error("Storage quota has been exceeded",o)}return!1},t.remove=function(e){if(!r)return!1;n.removeItem(e)},t.flushExpired=function(e){if(!r||i===!1&&e!==!0)return;for(var s in n)t.get(s)},t.flush=function(e){if(!r||i===!1&&e!==!0)return;n.clear(),Log.info("Clear: Local storage cleared")},t.isSupported=function(){return r},t.goOnline=function(){i||console.log("Storage: Went online"),i=!0},t.goOffline=function(){i&&console.log("Storage: Went offline"),i=!1},e.Storage=t}(Orange),function(e){function s(e){var t=["map","from","to","offline","cache","callback"];for(var n=0;n<t.length;n++){if(!e.hasOwnProperty(t[n]))return!1;if(t[n]==="map"&&!o(e[t[n]]))return!1}return!0}function o(e){return!e.hasOwnProperty("model")||!r.get(e.model)||!e.hasOwnProperty("params")?!1:!0}function u(e,t){var n=[],r;if(t instanceof Array){for(var i=0;i<t.length;i++)r=f(e,t[i]),r&&n.push(r);return n}return!1}function a(e,t){var n=[];for(var r in t)n.push(t[r]);return u(e,n)}function f(e,t){var n={},i,s;for(var o in e.params)t.hasOwnProperty(e.params[o])&&(n[o]=t[e.params[o]]);return i=r.get(e.model),s=new i(n),s||!1}var t,n=e.Collection,r=e.Model,i=e.Storage;t=Class.extend({initialize:function(e,t){this.isOnline=!1,this.cache=[],this.auth=t||null,this.path=e||""},getType:function(){throw"Cannot instantiate service"},getPath:function(){return""},goOnline:function(){this.isOnline=!0},goOffline:function(){this.isOnline=!1},request:function(e,t,n,r,i,o,l){function g(e,t){var n;switch(e){case"parse":n="Error parsing response";break;case"offline":n="Service offline";break;default:n="Service error"}o.call(l||this,t)}function b(e){try{var n=!!e;e=r.callback(e);var s=!!e;if(s!==n)throw"Invalid Mapping: Service callback returning no data";if(r.from==="array"&&r.to==="collection"){if(!(e instanceof Array))throw'Invalid Response: Service "'+h+'" expected an array';e=u(r.map,e)}else if(r.from==="object"&&r.to==="collection"){if(typeof e!="object"||e instanceof Array)throw'Invalid Response: Service "'+h+'" expected an object';e=a(r.map,e)}else if(r.from==="object"&&r.to==="model"){if(typeof e!="object")throw'Invalid Response: Service "'+h+'" expected an object';e=f(r.map,e)}r.cache&&t==="GET"&&this.cacheResponse(v,e)}catch(o){g("parse",o);return}i.call(l||this,e)}var c=this.getPath(),h=(c.charAt(0)==="/"?c.substr(1):c)+e,p;if(["GET","POST","PUT","DELETE"].indexOf(t)===-1)throw"Invalid method type";if(!s(r))throw"Invalid configuration";var d=Object.keys(n).sort(),v="service:"+this.getType()+":";for(var m=0;m<d.length;m++)v+=d[m]+":"+md5(n[d[m]])+":";if(r.cache&&this.cache.hasOwnProperty(v)&&this.cache[v]>(new Date).getTime()){try{p=this.retrieveResponse(v,r.map.model,n)}catch(y){}if(p){i.call(l||this,p);return}}if(!this.isOnline){if(r.offline&&t==="GET"){try{p=this.retrieveResponse(v,r.map.model,n)}catch(y){}if(p){i.call(l||this,p);return}}g("offline");return}$.ajax({url:h,type:t,data:n,success:proxy(b,this),error:g})},cacheResponse:function(e,t){var n,s="object";if(t instanceof Array){n=[];for(var o=0;o<t.length;o++)t[o]instanceof r?(n.push(t[o].getId()),i.set(t[o].getType()+":"+t[o].getId(),t[o].toObject()),s="collection"):(n.push(t[o]),s="array")}else t instanceof r?(n=t.getId(),i.set(t.getType()+":"+n,t.toObject()),s="model"):n=t;return this.cache[e]=(new Date).getTime()+6e4,i.set(e,{type:s,data:n})},retrieveResponse:function(e,t,n){var s=i.get(e),o=r.get(t),u=s.type,a=s.data;if(u==="model"){var f=i.get(t+":"+a),l=new o(f);return l||null}if(u==="collection"){var c=[],h;for(var p=0;p<s.length;p++)h=new o(i.get(t+":"+s[p])),h&&c.push(h);return c}return s||null},modelOrId:function(e){if(e instanceof r)return e.getId();if(typeof e!="object")return e;throw new Error("Invalid Input: Expecting model or id",e)}}),t.get=function(e){t.hasOwnProperty("services")||(t.services={});if(t.services.hasOwnProperty(e))return t.services[e]},t.extend=function(e){var n=Class.extend.call(this,e);t.hasOwnProperty("services")||(t.services={});var r=["getType"];for(var i=0;i<r.length;i++){if(!e.hasOwnProperty(r[i]))throw"Class missing '"+r[i]+"()' implementation";n[r[i]]=e[r[i]]}return t.services[n.getType()]=n,n},e.Service=t}(Orange),function(e){function r(e,t,n){return $.ajax({async:n!==!0,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:e,success:function(n){t(e,n)},error:function(){throw"Error: template not found"}}).responseText}var t={},n={};t.get=function(e,t,r){var i=this,s=[],o;if(!n.hasOwnProperty(e))throw"Path "+e+" has not been loaded";$("<div>"+n[e]+"</div>").children().each(function(){s.push($(this))});for(var u=0;u<s.length;u++){if(typeof t!="undefined"&&s[u].attr("data-control")!==t)continue;if(typeof r!="undefined"&&s[u].attr("data-name")!==r)continue;return s[u]}throw"Could not find view "+t+" at "+e},t.register=function(e,t){function o(e,r){n[e]=r,s--,s===0&&t()}var i,s=e.length;if(s===0)return t();for(var u=0;u<e.length;u++)i=e[u],r(e[u],proxy(o,this))},e.View=t}(Orange),function(e){var t,n=e.Collection,r=e.Model;t=Class.extend({initialize:function(e){this.target=e,this.template=e.clone(),this.loaded=!1},bind:function(e,t){this.loaded&&this.unbind();if(e instanceof n)this.bindList(this.target,e.toArray(),e.getKey(),e.getItemType());else if(e instanceof Array)this.bindList(this.target,e);else if(e instanceof r)this.bindModel(this.target,e.toObject(),e.getKey(),e.getItemType());else{if(typeof e!="object")return;this.bindData(this.target,e)}this.loaded=!0,typeof t=="function"&&t.call(this)},bindList:function(e,t,n,r){var i,s,o=e.find("[itemscope]:first"),u=e.clone().empty();if(!o.length){e.remove();return}o.remove(),s=o.clone();if(t instanceof Array)for(var a=0;a<t.length;a++)i=s.clone(),u.append(i),n?this.bindModel(i,t[n],n,r):this.bindData(i,t[a]);e.replaceWith(u)},bindModel:function(e,t,n,r){r&&this.target.attr("itemtype",r),this.target.attr("itemid",t[n]),this.target.attr("itemscope"),this.bindData(this.target,t)},bindData:function(e,t){function o(t){var n=[];return e.find(t).each(function(){var t=!1,r=$(this).parent();while(r.length!==0&&!t){if($(r).not(e).length===0){t=!0;break}if($(r).not("[data-control]").length===0){t=!1;break}r=$(r).parent()}t&&n.push($(this))}),n}var n=[],r,i,s;if(typeof t=="string"&&e.has("[itemscope]")){e.text(t);return}n=o.call(this,"[itemprop]");for(var u=0;u<n.length;u++){r=n[u],i=r.attr("itemprop");if(t.hasOwnProperty(i)){if(t[i]instanceof Array)this.bindList(r,t[i]);else if(t[i]instanceof Date)r.attr("datetime",t[i].toString()),s=r.attr("data-format"),s&&s.length>0?(r.text(t[i].format(s.toLowerCase())),r.removeAttr("data-format")):r.text(t[i].getMonth()+"/"+t[i].getDate()+"/"+t[i].getFullYear());else if(typeof t[i]=="object")this.bindData(r,t[i]);else if(typeof t[i]=="string"||typeof t[i]=="number")r.prop("tagName")==="META"?r.attr("content",t[i]):r.text(t[i])}else r.remove()}},unbind:function(){this.target.replaceWith(this.template.clone())},destroy:function(){delete this.target,delete this.template,delete this.loaded}}),e.Binding=t}(Orange),function(e){function o(e,t){t=$(t).eq(0),e=$(e)[0];for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n];t.attr(r.name,r.value)}}function u(e,t){var n=$(e).get(0),r={},i=[];for(var s=0,o=n.attributes.length;s<o;s++)n.attributes[s].name.match(t)&&(r[n.attributes[s].name.replace(t,"")]=n.attributes[s].value,i.push(n.attributes[s].name));for(var u=0;u<i.length;u++)$(e).removeAttr(i[u]);return r}function a(e,t){var n=[];return e.find(t).each(function(){var t=!1,r=$(this).parent();while(r.length!==0&&!t){if($(r).not($(e)).length===0){t=!0;break}if($(r).not("[data-control]").length===0){t=!1;break}r=$(r).parent()}t&&n.push($(this))}),n}function f(e,t){var n=this.getRoutes(),r,i;e&&e.charAt(0)==="/"&&(e=e.substr(1));for(var s in n){i=s.substr(1).split("/").shift();if(i.indexOf(":")!==-1||!i)r="/"+i;if(i===e)return s}return t?null:r}var t,n=e.Binding,r=e.Browser,i=e.Form,s=e.View;t=Class.extend({initialize:function(e,t,n){this._initialized=!1,this.app=n,this.parent=e||null,this.target=$(t),this._views=this.setupViews(),this._forms=this.setupForms(),this._elems=this.setupElements(),this._attrs=this.setupAttributes(),this.validateOutlets(),this._source=this.target.outerHTML(),this._queue=[],this._bindings={},this._loaded=!1,this._visible=!1,this._stopping=!1,this.setupTransitions(),typeof this.target=="object"&&this.target.addClass("hidden"),this.setup(),this._initialized=!0},setupAttributes:function(){if(this._initialized)return;var e=u(this.target,/data-/);return e.hasOwnProperty("name")||(e.name=e.control),e.hasOwnProperty("state")?(this._state=e.state,this.target.addClass(e.state)):this._state=null,this.target.addClass("view"),typeof this.typeList!="undefined"&&this.target.addClass(this.typeList),this.target.addClass(e.name),e},setupViews:function(){if(this._initialized)return;var e=a(this.target,"[data-control]"),n={},r,i,u,f,l;for(var c=0;c<e.length;c++)i=e[c].attr("data-control"),r=e[c].attr("data-name")||i,f=e[c].attr("data-template"),f&&f.length>0&&(u=s.get(f,i,r),e[c].html(u.html()),o(u,e[c]),e[c].removeAttr("data-template")),l=t.get(i),n[r]=new l(this,e[c],this.app);return n},setupForms:function(){if(this._initialized)return;var e=a(this.target,"form"),t={},n,r;for(var s=0,o=e.length;s<o;s++)n=e[s].attr("name"),r=new i(e[s]),t[n]=r;return t},setupElements:function(){if(this._initialized)return;var e=a(this.target,"[data-name]:not([data-control])"),t={},n;for(var r=0;r<e.length;r++)n=e[r].attr("data-name"),n.length>0&&(t[n]=e[r],e[r].removeAttr("data-name").addClass(n));return t},validateOutlets:function(){var e=this.getOutlets(),t=[],n;for(var r in e)switch(e[r]){case"view":this.hasView(r)||t.push(r);break;case"form":this.hasForm(r)||t.push(r);break;case"element":this.hasElement(r)||t.push(r);break;default:}if(t.length>0)throw'Invalid Syntax: ViewController "'+this.getParam("name")+'" missing outlets ['+t.join(", ")+"]";var i=this.getRoutes(),s=f.call(this,"");if(!s&&!this.getParam("default")&&Object.keys(i).length>0)throw'Invalid Syntax: View Controller "'+this.getParam("name")+'" must define either a [data-default] or generic / route';for(var o in i)if(o.charAt(0)!=="/")throw'Invalid Syntax: Route "'+o+'" in '+this.getParam("name")+" must begin with forward slash"},setupTransitions:function(){if(this._initialized)return;this.on("_load",this.onLoad,this),this.on("_loaded",this.onDidLoad,this),this.on("_appear",this.onAppear,this),this.on("_appeared",this.onDidAppear,this),this.on("_disappear",this.onDisappear,this),this.on("_disappeared",this.onDidDisappear,this),this.on("_unload",this.onUnload,this),this.on("_unloaded",this.onDidUnload,this)},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},destroy:function(){for(var e in this._views)this._views[e].destroy(),delete this._views[e];for(var t in this._forms)this._forms[t].destroy(),delete this._forms[t];for(var n in this._elems)delete this._elems[n];delete this.target,delete this.parent,delete this._source,delete this._queue},getType:function(){return"view"},getBindings:function(){return{}},getOutlets:function(){return{}},getRoutes:function(){return{}},setup:function(){},add:function(e,t,n){this._queue.push({fn:e,args:t,wait:n}),this._running||this.next()},next:function(){this._running=!0;var e=this._queue.shift();if(e){e.fn.apply(this,e.args);if(e.fn===this._setState||e.fn===this._clearState)this._process=setTimeout(proxy(function(){this.next()},this),e.wait)}else this._running=!1},stop:function(){return this._queue=[],this._process&&(clearTimeout(this._process),this.next()),this},setRoute:function(e){return this.add(this._setRoute,[e],0),this},getRoute:function(){return this.route},_setRoute:function(e){e.substr(0,1)!=="/"&&(e="/"+e);var t=f.call(this,e);if(this.route===e){this.next();return}var n=t.match(/[^:]*/).pop();n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1));var r="#!"+this._routes+n;location.hash=r,this.next()},setHashRoute:function(e,t){return this.add(this._setHashRoute,[e,t],0),this},_setHashRoute:function(e,t){function n(e,t){for(var n in this._views)this.getView(n).setHashRoute(e.slice(0),t)}t=t?t:"";var r=this.getRoutes();if(Object.keys(r).length===0){n.call(this,e,t),this.next();return}var i=e.slice(0).shift(),s=f.call(this,i,!0);s?e.shift():(s=f.call(this,i),i=""),s||(s=f.call(this,this.getParam("default")));var o=s.substr(1).split("/"),u={},a;this._routes=t||"",i&&(t+="/"+i);for(var l=0;l<o.length;l++)o[l].charAt(0)===":"&&(a=e.shift()||null,u[o[l].substr(1)]=a,this.setParam(o[l].substr(1),a),t+="/"+a);r.hasOwnProperty(s)&&r[s].call(this,this.route,u),n.call(this,e,t),this.route=i,this.next()},getState:function(){return this._state},setState:function(e,t){return this.add(this._setState,[e],t||0),this},clearState:function(e){return this.add(this._clearState,[],e||0),this},_setState:function(e,t){if((this.hasState(e)||!this._loaded)&&!t)return;this.target.removeClass(this._state),this.target.addClass(e),this._state=e},_clearState:function(){this.target.removeClass(this._state),this._state=null},hasState:function(e){return this._state===e},load:function(){return this.add(this._load),this},show:function(){return this.add(this._show),this},hide:function(){return this.add(this._hide),this},unload:function(){return this.add(this._unload),this},append:function(){return this.add(this._append),this},remove:function(){return this.add(this._remove),this},_load:function(){if(this._loaded){this.next();return}this.onWillLoad()},_show:function(){if(this._visible){this.next();return}if(!this._loaded)throw new Error("Invalid Request: Cannot show unloaded ViewController");this.onWillAppear()},_hide:function(){if(!this._visible){this.next();return}this.onWillDisappear()},_unload:function(){if(!this._loaded){this.next();return}if(this._visible)throw new Error("Invalid Request: Cannot unload visible ViewController");this.onWillUnload()},onWillLoad:function(){this.fire("_load")},onLoad:function(){var e=Object.keys(this._views).length;if(e===0)this.fire("_loaded");else for(var t in this._views){var n=this._views[t];n.once("load",proxy(function(){e--,e===0&&this.fire("_loaded")},this)),n.load()}},onDidLoad:function(){console.log(this.getParam("name")+" Loaded"),this._loaded=!0,this.fire("load"),this.next()},onWillUnload:function(){this.fire("_unload")},onUnload:function(){var e=Object.keys(this._views).length;if(e===0)this.target.remove(),this.fire("_unloaded");else for(var t in this._views){var n=this._views[t];n.once("unload",proxy(function(){e--,e===0&&(this.target.remove(),this.fire("_unloaded"))},this)),n.unload()}},onDidUnload:function(){console.log(this.getParam("name")+" Unloaded"),this._loaded=!1,this.fire("unload"),this.next()},onWillAppear:function(){var e=this.getBindings();for(var t in e){var n=e[t];for(var i in n){var s=null;typeof n[i]=="function"?s=n[i]:this.hasOwnProperty(n[i])&&(s=this[n[i]]),i==="touchclick"&&(i=r.touch?"touchend":"click");if(s===null){var o=i.charAt(0).toUpperCase()+i.slice(1);s=n[i]===!0&&typeof this["on"+o]=="function"?this["on"+o]:null}t==="$target"?this.target.on(i,proxy(s,this)):s!==null&&this.hasView(t)?this.getView(t).on(i,proxy(s,this)):s!==null&&this.hasForm(t)?this.getForm(t).on(i,proxy(s,this)):s!==null&&this.hasElement(t)&&this.getElement(t).on(i,proxy(s,this))}}this.target.removeClass("hidden"),this.fire("_appear")},onAppear:function(e){var t=Object.keys(this._views).length;if(t===0)this.fire("_appeared");else for(var n in this._views){var r=this._views[n];r.once("appear",proxy(function(){t--,t===0&&this.fire("_appeared")},this)),r.show()}},onDidAppear:function(e){console.log(this.getParam("name")+" Appeared"),this._visible=!0,this.fire("appear"),this.next()},onWillDisappear:function(){for(var e in this._views)this.getView(e).detach();for(var t in this._forms)this.getForm(t).detach();for(var n in this._elems)this.getElement(n).unbind();this.fire("_disappear")},onDisappear:function(e){var t=Object.keys(this._views).length;if(t===0)this.fire("_disappeared");else for(var n in this._views){var r=this._views[n];r.once("disappear",proxy(function(){t--,t===0&&this.fire("_disappeared")},this)),r.hide()}},onDidDisappear:function(e){console.log(this.getParam("name")+" Disappeared"),this.target.addClass("hidden"),this._visible=!1,this.fire("disappear"),this.next()},setParam:function(e,t){this._attrs[e]=t},getParam:function(e){return this._attrs.hasOwnProperty(e)?this._attrs[e]:null},getViews:function(){return this._views},getView:function(e){if(e instanceof t)return e;if(typeof this._views[e]!="undefined")return this._views[e];throw new Error('Invalid Request: View "'+e+'" not found')},getForm:function(e){if(this._forms[e]instanceof i)return this._forms[e];throw new Error('Invalid Request: Form "'+e+'" not found')},getElement:function(e){if(typeof this._elems[e]!="undefined")return this._elems[e];throw new Error('Invalid Request: Element "'+e+'" not found')},hasView:function(e){return typeof this._views[e]!="undefined"},hasForm:function(e){return typeof this._forms[e]!="undefined"},hasElement:function(e){return typeof this._elems[e]!="undefined"},addView:function(e,n,r){if(this.hasView(n))throw new Error("Invalid Request: ViewController "+n+" already exists");var i=t.get(e),o=s.get(r,e,n);return i&&(this._views[n]=new i(this,o,this.app)),this._views[n]},removeView:function(e){this.hasView(e)&&(this._views[e].hide().unload().destroy(),delete this._views[e])},bind:function(e,t){if(!this.hasElement(e))throw'Invalid Resource: Element "'+e+'" is not defined';this._bindings.hasOwnProperty(e)&&this.unbind(e),this._bindings[e]=new n(this.getElement(e)),this._bindings[e].bind(t)},unbind:function(e){if(!this.hasElement(e))throw'Invalid Resource: Element "'+e+'" is not defined';this._bindings.hasOwnProperty(e)&&(this._bindings[e].unbind(),delete this._bindings[e])},getService:function(e){return this.app.getService(e)},goOnline:function(){for(var e in this._views)this._views[e].goOnline()},goOffline:function(){for(var e in this._views)this._views[e].goOffline()}}).include(Events),t.views={view:t},t.extend=function(e){if(!e.hasOwnProperty("getType"))throw'Missing Implementation: ViewController missing "getType" implementation';var n=Class.extend.call(this,e),r=e.getType();if(t.views.hasOwnProperty(r))throw'Duplicate Class: ViewController "'+r+'" is already defined';return n.prototype.typeList?n.prototype.typeList+=" "+r:n.prototype.typeList=r,n.extend=t.extend,t.views[r]=n},t.get=function(e){if(this.views.hasOwnProperty(e))return this.views[e];throw'Invalid Resource: ViewController "'+e+'" not defined'},e.ViewController=t}(Orange),function(e){function a(e){typeof e=="function"&&$(document).ready(function(){$("body").hide();var n=$("[data-app]").text();if(n){n=JSON.parse(n);var r=new t(n);e.call(this,r),r.launch()}})}var t,n=e.Cache,r=e.Loader,i=e.Service,s=e.Storage,o=e.View,u=e.ViewController;t=Class.extend({initialize:function(e){if(!e.hasOwnProperty("name"))throw"Invalid application";this.name=e.name,this.required=e.hasOwnProperty("required")?e.required:[],this.loaded=!1,this.online=!1,this.env=e.hasOwnProperty("env")?e.env:"PROD";for(var t=0,n=this.required.length;t<n;t++)r.loadModule(this.required[t]);this.servicePaths={},this.services={},this.serviceConfig={},this.authService=null,this.constants={},this.templates=[],this.authenticated=!1,this.viewLoaded=!1},loadServices:function(){for(var e in this.serviceConfig){var t=i.get(e),n=this.serviceConfig[e],r={};Object.keys(n.paths).length>0&&typeof n.paths[this.env]!==undefined?r={path:n.paths[this.env],auth:n.auth}:r={path:this.servicePaths[this.env],auth:n.auth};var s=new t(r.path,r.auth);this.services[e]=s}},authenticate:function(e,t,n){if(!this.authService){e.call(n);return}if(!this.services.hasOwnProperty(this.authService))throw"Cannot load authentication service";var r=this.services[this.authService];if(typeof r.authenticate!="function")throw"Authentication service must implement authenticate()";r.authenticate(e,t,n)},setEnvironment:function(e){this.env=e},setLogging:function(e){this.levels=e},setConstant:function(e,t){this.constants[e]=t},getConstant:function(e){return this.constants.hasOwnProperty(e)?this.constants[e]:null},getService:function(e){return this.services.hasOwnProperty(e)?this.services[e]:null},registerService:function(e,t,n){this.serviceConfig[e]={auth:t||null,paths:n||{}}},setAuthentication:function(e){this.authService=e},registerServicePaths:function(e){this.servicePaths=e},registerViews:function(e){e instanceof Array&&(this.templates=e)},onHashChange:function(e){var t=location.hash;t.substr(0,2)==="#!"?t=t.replace("#!",""):t=t.replace("#","");var n=[];t.charAt(0)==="/"&&(t=t.substr(1)),n=t.split("/"),this.root.setHashRoute(n.slice(0))},onOnline:function(){this.online||console.log("Application: Went online"),this.online=!0;for(var e in this.services)this.services[e].goOnline();s.goOnline(),this.root&&this.root.goOnline()},onOffline:function(){this.online&&console.log("Application: Went offline"),this.online=!1;for(var e in this.services)this.services[e].goOffline();s.goOffline(),this.root&&this.root.goOffline()},onAuthSuccess:function(){this.authService&&console.log("User: Authenticated successfully");var e=$("[data-root]");if(e.length===0)throw"Invalid Markup: No [data-root] view found";var t=e.attr("data-control");if(!t)throw"Invalid Markup: Root View missing [data-control]";var n=u.get(t);this.root=new n(null,e,this),this.root.load().show(),this.online?this.root.goOnline():this.root.goOffline(),$(window).on("hashchange",proxy(this.onHashChange,this)),$(window).trigger("hashchange"),$("body").show()},onAuthFailure:function(){console.log("Could not authenticate")},launch:function(){if(this.loaded)return;!this.levels||!this.levels.hasOwnProperty(this.env)?Log.setLevel("DEBUG"):Log.setLevel(this.levels[this.env]),n.init(function(e){this.loadServices(),e?this.onOnline():this.onOffline(),n.on("online",function(e){e.data?this.onOnline():this.onOffline()},this),this.authenticate(proxy(function(){this.authenticated=!0,this.viewLoaded&&this.onAuthSuccess.call(this)},this),this.onAuthFailure,this),o.register(this.templates,proxy(function(){this.viewLoaded=!0,console.log("Views: loaded and cached"),this.authenticated&&this.onAuthSuccess.call(this)},this))},this)}}),e.Application=t,e.config=a}(Orange);