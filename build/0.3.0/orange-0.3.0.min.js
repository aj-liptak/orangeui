/**
 * OrangeUI | 0.3.0 | 09.03.2012
 * https://github.com/brew20k/orangeui
 * Copyright (c) 2012 Kevin Kinnebrew
 */
(function(){function s(){}function t(a){var b=a instanceof Array?[]:{};for(i in a){if(i=="clone")continue;a[i]&&typeof a[i]=="object"?b[i]=t(a[i]):b[i]=a[i]}return b}var a,b,c,d,e,f,g,h,j,k,l,m,n,o=function(b){return a[b]},p=function(b,c){return a[b]=c},q=/[^A-Za-z:0-9_\[\]]/g,r=/[^-A-Za-z_]/g;b=function(){function c(){}var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return c.extend=function(c){function g(){!a&&this.initialize&&this.initialize.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g},c.proxy=function(a,b){var c=b;return function(){return a.apply(c,arguments)}},c}(),c=function(){function a(a,b,c,d){this.bubbles=!0,this.type=a,this.currentTarget=b,this.target=c,this.data=d}return a.prototype.stopPropagation=function(){this.bubbles=!1},a}(),d=function(){function a(a,b,c){this.target=a,this.ev=b,this.call=c}return a.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call,delete this},a}(),e=function(){function a(a,b){this._listeners={},this._parent=a,this._self=b}return a.prototype.on=function(a,b){return this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]),this._listeners[a].push(b),new d(this,a,b)},a.prototype.fire=function(a,b){var d=this._parent;typeof a=="string"&&(a=new c(a,this._self,this._self,b));if(typeof a.type!="string")throw"Error: Invalid 'type' when firing event";if(this._listeners[a.type]instanceof Array){var e=this._listeners[a.type];for(var f=0,g=e.length;f<g;f++)e[f].call(this,a)}d!=null&&d._eventTarget instanceof c&&a.bubbles&&(a.currentTarget=this._parent,d._eventTarget.fire.call(d._eventTarget,a,b))},a.prototype.detach=function(a,b){if(this._listeners[a]instanceof Array){var c=this._listeners[a];for(var d=0,e=c.length;d<e;d++){if(typeof b!="undefined"&&c[d]===b){c.splice(d,1);break}c.splice(d,1)}}else typeof a=="undefined"&&(this._listeners={})},a.prototype.destroy=function(){for(var a in this._listeners)a.detach();delete this._parent,delete this._self},a}(),f=function(){var a={},b=new e(null,a),c=0;typeof console=="undefined"&&(console={log:function(){},dir:function(){}});var d=function(a,b,c){c?console.log(a,b,c):console.log(a,b)};return a.on=function(a,c,d){var d=d,e=function(a){var b=a.data.message,e=a.data.data;c.call(typeof d!="undefined"?d:this,b,e)};return b.on.call(b,a,e)},a.fire=function(){return b.fire.apply(b,arguments)},a.detach=function(){return b.detach.apply(b,arguments)},a.setLevel=function(a){switch(a.toLowerCase()){case"info":c=4;break;case"debug":c=3;break;case"warn":c=2;break;case"error":c=1;break;default:c=0}},a.info=function(b,d){c>3&&a.fire("info",{message:b,data:d})},a.debug=function(b,d){c>2&&a.fire("debug",{message:b,data:d})},a.warn=function(b,d){c>1&&a.fire("warn",{message:b,data:d})},a.error=function(b,d){c>0&&a.fire("error",{message:b,data:d})},a.on("info",function(a,b){d("[INFO]",a,b)}),a.on("debug",function(a,b){d("[DEBUG]",a,b)}),a.on("warn",function(a,b){d("[WARN]",a,b)}),a.on("error",function(a,b){d("[ERROR]",a,b)}),a}(),g=function(){var b={},c={};return{addModule:function(a,c,d){a=a.replace(/[^-A-Za-z_]/g);var e={name:a,fn:c,req:d!=undefined?d:[]};b[a]=e},loadModule:function(d){if(c.hasOwnProperty(d))return;if(b[d]!=undefined){c[d]=!0;for(var e=0,h=b[d].req.length;e<h;e++){if(b[d].req[e]===d)continue;g.loadModule(b[d].req[e])}b[d].fn.call(window,a),f.debug('Module "'+d+'" loaded')}}}}();var u=function(){var a=arguments,b=a[0],c=typeof a[1]=="function"?a[1]:null,d=a[2];g.addModule(b,c,d)},v=function(){var b=Array.prototype.slice.call(arguments),c=b[b.length-1],d=t(b).splice(0,b.length-1);if(typeof d[0]!="function")for(var e=0,f=d.length;e<f;e++)g.loadModule(d[e]);c.call(window,a)},w=function(b){a[b]==undefined&&(a[b]={})};h=function(){var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=function(){var b=!1;for(var c=0,d=a.length;c<d;c++)try{b=a[c]()}catch(e){continue}return b};return{load:function(a){if(typeof $!="undefined")return $.ajax(a).responseText;var c=b();if(!c)return;var d,e,f,g=!1;typeof a.success=="function"&&(d=a.success),typeof a.error=="function"&&(e=a.error),a.hasOwnProperty("data")&&(f=encodeURIComponent(a.data));var h=a.hasOwnProperty("type")?a.type:"GET",i=a.hasOwnProperty("type")?a.url:null;c.open(h,i,!0),c.setRequestHeader("Cache-Control","no-cache"),c.timeout=3e3,c.ontimeout=function(){e(c)},c.setRequestHeader("X-Requested-With","XMLHttpRequest"),f&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.onreadystatechange=function(){if(c.readyState!=4)return;c.status!=200&&c.status!=304?e(c):d(c.responseText)};if(c.readyState==4){d(c);return}c.send(f)},get:function(a){return a.type="GET",h.load(a)},post:function(a){return a.type="POST",h.load(a)},put:function(a){return a.type="PUT",h.load(a)},del:function(a){return a.type="DELETE",h.load(a)}}}(),j=function(){function a(a){typeof $!="undefined"?(this.target=$(a),this.jQuery=!0):this.target=document.getElementById(a.replace("#",""))}return a.bind=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},a.unbind=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},a.on=function(){a.bind.apply(a,arguments)},a.off=function(){a.bind.apply(a,arguments)},a.prototype.bind=function(b,c){a.bind(this.target,b,c)},a.prototype.unbind=function(b,c){a.unbind(this.target,b,c)},a.prototype.on=function(b,c){a.on(this.target,b,c)},a.prototype.off=function(b,c){a.off(this.target,b,c)},a}(),k=function(){var a=null,b=!1,c=!1,d=!1,g=!1,i=function(){a!=null&&(clearTimeout(a),a=null)},l=new e(null,k),m=function(){if(navigator.onLine&&!d){c=!0,d=!0,k.fire("statusChange",1);return}i(),a=setTimeout(function(){navigator.onLine&&!d?(c=!0,d=!0,k.fire("statusChange",1)):navigator.onLine?h.load({url:"ping.js",type:"GET",success:function(a){c===!1&&(c=!0,k.fire("statusChange",1))},error:function(a){c===!0&&(c=!1,k.fire("statusChange",0))}}):setTimeout(function(){c===!0&&(c=!1,k.fire("statusChange",0))},100),a=null,b&&setTimeout(m,1e4)},d?100:0)},n=function(a){f.debug("Cache: All resources downloaded")},o=function(){f.debug("Cache: Checking for cache manifest")},p=function(){f.debug("Cache: Starting download of files")},q=function(){f.debug("Cache: Error in manifest, downloading cached files or you're offline")},r=function(){f.debug("Cache: No update needed")},s=function(){f.debug("Cache: Downloading cached files")},t=function(){window.applicationCache.swapCache(),f.debug("Cache: Updated cache loaded and ready"),window.location.reload(!0)};return{on:function(a,b,c){var d=typeof c!="undefined"?function(){b.apply(c,arguments)}:b;return l.on.call(l,a,d)},fire:function(){return l.fire.apply(l,arguments)},detach:function(){return l.detach.apply(l,arguments)},init:function(a){if(g)return;b=a,g=!0,j.bind(window,"offline",m),j.bind(window,"online",m),j.bind(window,"cached",n),j.bind(window,"checking",o),j.bind(window,"downloading",p),j.bind(window,"error",q),j.bind(window,"noupdate",r),j.bind(window,"progress",s),j.bind(window,"updateready",t),m()},updateNetworkStatus:function(a){m()},isActive:function(){return g},isOnline:function(){return c}}}(),l=function(){function e(){}var a=window.localStorage,b=!1,c=!1;if("localStorage"in window)try{window.localStorage.setItem("_test",1),b=!0,window.localStorage.removeItem("_test")}catch(d){}if(b)try{window.localStorage&&(a=window.localStorage)}catch(d){}else if("globalStorage"in window)try{window.globalStorage&&(a=window.globalStorage[window.location.hostname],b=!0)}catch(d){}return(typeof JSON=="undefined"||JSON.stringify==undefined)&&typeof $=="undefined"&&(b=!1),b||f.debug("localStorage not supported"),e.get=function(d){if(!b)return;try{var e=JSON.parse(a.getItem(d));if(e!=undefined&&e.data!=undefined)return c&&e.ttl!==-1&&(new Date).getTime()-e.timestamp>e.ttl&&a.removeItem(d),e.data}catch(g){f.error("Error fetching object from localStorage")}},e.set=function(c,d,e){if(!b)return!1;c=c.replace(q,"");if(typeof d=="undefined")return!1;var g={data:d,timestamp:(new Date).getTime(),ttl:e?e:864e5};try{return a.setItem(c,JSON.stringify(g)),!0}catch(h){h==QUOTA_EXCEEDED_ERR&&f.error("Storage quota has been exceeded",h)}return!1},e.remove=function(c){if(!b)return!1;a.removeItem(c)},e.flushExpired=function(d){if(!b)return;if(c===!1&&d!==!0)return;for(var f in a)e.get(f)},e.flush=function(d){if(!b)return;if(c===!1&&d!==!0)return;a.clear(),f.info("Clear: Local storage cleared")},e.isSupported=function(){return b},e.goOnline=function(){c=!0},e.goOffline=function(){c=!1},e}(),m=function(){function a(a){if(typeof io!="undefined")this.connection=io.connect(a);else throw"Socket.io required"}return a.prototype.on=function(){this.connection.on.apply(this.connection,arguments)},a.prototype.send=function(){this.connection.send.apply(this.connection,arguments)},a.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)},a}(),n=function(){var a=null,b=null,c=36e5;return{get:function(c,d){if(!n.isExpired()&&typeof c!="undefined")return c(a);navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(d){b=(new Date).getTime(),a=d.coords,f.debug("Location retrieved"),typeof c=="function"&&c(d.coords)},function(a){switch(a.code){case a.TIMEOUT:f.error("Location services timeout");break;case a.POSITION_UNAVAILABLE:f.error("Position unavailable");break;case a.PERMISSION_DENIED:f.error("Please Enable Location Services");break;default:f.error("Unknown location services error")}typeof a=="function"&&a()})},isExpired:function(){return(new Date).getTime()-b>c}}}(),Browser=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS";var a=navigator.userAgent.toLowerCase();a.search("iphone")>0||a.search("ipod")>0?this.device="phone":a.search("ipad")>0?this.device="tablet":a.search("mobile")>0&&this.OS=="Android"?this.device="phone":this.OS=="Android"?this.device="tablet":this.device="desktop",this.OS=="Android"&&a.search("galaxy_tab")>0&&(this.device="tablet"),this.device=="desktop"?this.nativeScroll=!0:this.OS=="iOS"&&navigator.userAgent.match(/ OS 5_/i)?this.nativeScroll=!0:navigator.userAgent.match(/ HTC/i)||navigator.userAgent.match(/ Desire_A8181/i)||navigator.userAgent.match(/ myTouch4G/i)||navigator.userAgent.match(/ ADR6200/i)?this.nativeScroll=!0:this.nativeScroll=!1},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;var c=a.substring(b+this.versionSearchString.length+1).split(" ",1).pop();return c.split(".",2).join(".").replace(";","")},dataBrowser:[{string:navigator.userAgent,subString:"Android",versionSearch:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"≈",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return a.init(),{browser:a.browser,version:a.version,os:a.OS,device:a.device,scroll:a.nativeScroll}}(),a=this.Orange={},a.version="0.3",a.__import=this.__import=o,a.modules={},a.add=u,a.use=v,a.namespace=w,a.Ajax=h,a.Browser=Browser,a.Cache=k,a.Class=this.Class=b,a.Events=e,a.Location=n,a.Log=this.Log=f,a.Storage=l}).call(this),Orange.add("mvc",function(a){var b,c,d,e,f,g,h,i,j,k,l,m=/[^A-Za-z:0-9_\[\]]/g,n=__import("Cache"),o=__import("Storage"),p=__import("Loader"),q=__import("Location"),r=__import("Events"),s=__import("Ajax");b=Class.extend({initialize:function(a,b){this.name=a.replace(m),this.config=b,this.isOnline=!1},launch:function(){for(var a=0,b=this.config.required.length;a<b;a++)p.loadModule(this.config.required[a]);this.config.hasOwnProperty("logging")&&Log.setLevel(this.config.logging),n.on("statusChange",Class.proxy(function(a){a.data==1?(o.goOnline(),i.init(),this.config.location&&q.fetch(),Log.debug('Application "'+this.name+'" online')):(Log.debug('Application "'+this.name+'" offline'),o.goOffline()),o.get("appversion")!==this.config.version&&(i.flush(),o.set("appversion",this.config.version)),window.onload=Class.proxy(function(){this.onLaunch(a.data)},this)},this)),n.init(this.config.poll)},onLaunch:function(a){},goOnline:function(){this.isOnline=!0},goOffline:function(){this.isOnline=!1},isOnline:function(){return this.isOnline}}),d=Class.extend({initialize:function(){},destroy:function(){}}),g=function(){var a={},b=function(a){return $.ajax({async:!1,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(){},error:function(){throw"Error: template not found"}}).responseText};return{load:function(c){if(typeof a[c]!="undefined")return a[c];if(typeof c!="undefined"&&c!=="")return b(c);throw"Invalid template path"}}}(),f=Class.extend({initialize:function(a){if(typeof a=="undefined")return;this.config=a},getName:function(){return(this.config||{}).hasOwnProperty("name")?this.config.name:"source"},supportsModels:function(){return!1},isPersistent:function(){return!1}}),c=Class.extend({initialize:function(a,b){this.model=a,this.data=b,this.active=b,this.list=this.toArray()},getModel:function(){return this.model},count:function(){return this.list.length},get:function(a){return this.data.hasOwnProperty(a)?new this.model(this.data[a]):null},filter:function(a){if(typeof a=="function"&&this.active!==undefined)for(var b in this.active)a.call(this,this.active[b]||{})||delete this.active[b]},clearFilters:function(){this.active=this.data},toArray:function(){var a=[];for(var b in this.active)a.push(this.active[b]);return a},toObject:function(){return this.active},getModel:function(){return this.model}}),h=f.extend({request:function(a){if(n.isActive()&&!n.isOnline()){Log.warn("Could not connect to server");return}var b=typeof a.success=="function"?a.success:null,c=typeof a.error=="function"?a.error:null,d=typeof a.complete=="function"?a.complete:null;typeof a.context!="undefined"&&(b&&(b=function(){b.apply(context,arguments)}),c&&(c=function(){c.apply(context,arguments)}),d&&(d=function(){d.apply(context,arguments)}));var e={url:a.url,type:a.type};return a.hasOwnProperty("async")&&(e.async=a.async),a.hasOwnProperty("data")&&(e.data=a.data),a.hasOwnProperty("dataType")&&(e.dataType=a.dataType),a.hasOwnProperty("contentType")&&(e.contentType=a.contentType),b&&(e.success=b),c&&(e.error=c),d&&e.complete,s.load(e)}}),j=f.extend({isPersistent:function(){return!0},supportsModels:function(){return!0},getPath:function(a){return this.getName()+":"+"model:"+a},getAll:function(a){return o.get(this.getPath(a))||undefined},get:function(a,b){var c=o.get(this.getPath(a))||{};return c.hasOwnProperty(b)?c[b]:undefined},setAll:function(a,b){if(b instanceof Array)throw"Invalid input, expecting object";return o.set(this.getPath(a),b)},set:function(a,b,c){b===null&&(b=this.nextKey(a));var d=o.get(this.getPath(a));return d=d||{},d[b]=c,o.set(this.getPath(a),d),b},remove:function(a,b){var c=o.get(this.getPath(a));return delete c[b],o.set(this.getPath(a),c),!0},flush:function(a){o.remove(this.getPath(a))},nextKey:function(a){var b=0,c,d=[],e=o.get(this.getPath(a));for(c in e)e.hasOwnProperty(c)&&!isNaN(c)&&d.push(parseInt(c,10));return d.length>0?Math.max.apply(Math,d)+1:1}}),PersistentStorageSource=f.extend({isPersistent:function(){return!0},supportsModels:function(){return!0},getPath:function(){return this.getName()+":"+"model"},getAllActions:function(){var a=o.get(this.getPath())||{},b={};for(var c in a){var d=e._models[c],f=a[c];for(var g in f)b[g]={model:d,item:f[g]}}return b?b:null},getAll:function(a){var b=o.get(this.getPath());return typeof b!="undefined"&&b.hasOwnProperty(a)?b[a]:null},get:function(a,b){var c=o.get(this.getPath());return typeof c!="undefined"&&c.hasOwnProperty(a)?c[a].hasOwnProperty(b)?c[a][b]:null:null},setAll:function(a,b){if(b instanceof Array)throw"Invalid input, expecting object";var c=o.get(this.getPath());return c[a]=b,o.set(this.getPath(),c)},set:function(a,b,c){b===null&&(b=this.nextKey(a));var d=o.get(this.getPath())||{};return d.hasOwnProperty(a)||(d[a]={}),d[a][b]=c,o.set(this.getPath(),d),b},remove:function(a,b){var c=o.get(this.getPath());if(c&&c.hasOwnProperty(a)&&c[a].hasOwnProperty(b))delete c[a][b];else return null;return o.set(this.getPath(),c),!0},flush:function(a){o.remove(this.getPath())},nextKey:function(a){var b=0,c,d=[],e=o.get(this.getPath())||{};e.hasOwnProperty(a)?e=e[a]:e[a]={};for(c in e)e.hasOwnProperty(c)&&!isNaN(c)&&d.push(parseInt(c,10));return d.length>0?Math.max.apply(Math,d)+1:1}}),k=h.extend({initialize:function(a){if(typeof a=="undefined")return;this.config=a,this.config.path=a.path.charAt(a.path.length-1)=="/"?a.path:a.path+"/",Log.info('Source "'+this.getName()+'" connected')},getPath:function(){return this.config.path},getDataType:function(){return this.config.hasOwnProperty("dataType")?this.config.dataType:"text/json"},getAll:function(a,b,c){var d=function(c){c=this.processItems(a,c),b.call(this,c)};this.request({url:this.getPath()+this.filterType(a),contentType:this.getDataType(),type:"GET",success:Class.proxy(d,this),error:c})},get:function(a,b,c,d){var e=function(b){b=this.processItem(a,b),c.call(this,b)},f=this.getPath()+this.filterType(a);this.request({url:f.charAt(f.length-1)=="/"?f+b:f+"/"+b,contentType:this.getDataType(),type:"GET",success:Class.proxy(e,this),error:d})},set:function(a,b,c,d,e){var a=this.filterType(a),f=Class.proxy(function(b){b=this.processItem(a,b),d.call(this,b)},this),g=this.getPath(),h;g=b?g.charAt(g.length-1)=="/"?g+a+"/"+b:g+"/"+a+"/"+b:g+a,h={url:g,success:Class.proxy(f,this),error:e},b?(h.type="PUT",h.data=JSON.stringify(c),h.contentType="application/json"):(h.type="POST",h.data=c),this.request(h)},remove:function(a,b,c,d){var e=this.getPath()+this.filterType(a);this.request({url:e.charAt(e.length-1)=="/"?e+b:e+"/"+b,type:"DELETE",success:function(a){c.call(this,JSON.parse(a))},error:d})},processItem:function(a,b){return this.filterItem(a,b)},processItems:function(a,b){var c=this.filterItems(a,b),d=[];for(var e=0,f=c.length;e<f;e++)d.push(this.processItem(a,c[e]));return d},filterItem:function(a,b){return JSON.parse(b)},filterItems:function(a,b){return JSON.parse(b)},filterType:function(a){return a}}),e=Class.extend({initialize:function(a){this.getName();var b=this.constructor.getKey();this.isSaved=(a||{}).hasOwnProperty(b),this.id=this.isSaved?a[b]:null,this.data=a||{},a.hasOwnProperty("_unsaved")&&(this.isSaved=!1)},getName:function(){throw"Cannot instantiate model"},getFields:function(){throw"Cannot instantiate model"},getSource:function(){throw"Cannot instantiate model"},get:function(a){return this.data[a]},set:function(a,b){this.data[a]=b,this.isSaved=!1},clear:function(){delete this.data[name],this.isSaved=!1},refresh:function(){var a=this.constructor.get(this.getId());this.data=a.toObject(),this.isSaved=!0},save:function(a,b,c){if(this.isSaved)return;var d=function(b){this.isSaved=!0,typeof a=="function"&&a(b)};this.constructor.set(this.data,Class.proxy(d,this),b,c)},remove:function(a,b,c){this.exists()&&this.constructor.remove(this.id,a,b,c),this.destroy()},mergeChanges:function(a){},isSaved:function(){return this.isSaved},exists:function(){return this.id!==null},getId:function(){return this.id},getModel:function(){return this.constructor},toObject:function(){return this.data},destroy:function(){this.isSaved=!1,this.id=null,this.data={}}}),e.getKey=function(){var a=this.getFields();for(var b in a)if(a[b].hasOwnProperty("primaryKey"))return b},e.getId=function(){var a=this.getFields();for(var b in a)if(a[b].hasOwnProperty("primaryKey"))return a[b].name},e.getAll=function(a,b,d,f){var f=typeof f=="function"?f:this,g=function(d){var g=e.mapItems.call(this,d),h={};if(typeof a=="function"){for(var i in g)if(a==null||a.call(this,g[i]))h[i]=g[i];g=h}b.call(f,new c(this,g))};i.getAll(this,Class.proxy(g,this),Class.proxy(d,f))},e.get=function(a,b,c,d){var d=typeof d=="function"?d:this,f=function(a){var c=e.mapItem.call(this,a);b.call(d,new this(c))};i.get(this,a,Class.proxy(f,this),Class.proxy(c,d))},e.set=function(a,b,c,d){a instanceof e&&(a=a.toObject());var f=a.hasOwnProperty(this.getKey())?a[this.getKey()]:null,d=typeof d=="function"?d:this,g=function(a){var c=e.mapItem.call(this,a);b.call(d,new this(c))};i.set(this,f,e.unmapItem.call(this,a),Class.proxy(g,this),Class.proxy(c,d))},e.remove=function(a,b,c,d){var d=typeof d=="function"?d:this,e=a,f=function(a){b.call(d,e)};i.remove(this,a,Class.proxy(f,this),Class.proxy(c,d))},e.on=function(a,b,c){var d=typeof c!="undefined"?function(){b.apply(c,arguments)}:b;return this.events.on.call(this.events,a,d)},e.fire=function(){return this.events.fire.apply(this.events,arguments)},e.detach=function(){return this.events.detach.apply(this.events,arguments)},e.mapItem=function(a){var b={},c=this.getFields();for(var d in c){var e=c[d].name,f=a.hasOwnProperty(e)&&a[e]!=null?a[e]:undefined;if(f===undefined&&!c[d].nullable){Log.warn("Could not parse JSON field '"+d+"' for "+this.getName());continue}f!==undefined&&(b[d]=f)}return b},e.mapItems=function(a){var b={},c=this.getKey();for(var d in a){var f=e.mapItem.call(this,a[d]);typeof f=="object"&&(b[d]=f)}return b},e.unmapItem=function(a){var b={},c=this.getFields();for(var d in c){if(this.getKey()==d&&!a.hasOwnProperty(this.getKey()))continue;var e=c[d].name,f=a.hasOwnProperty(d)?a[d]:undefined;if(f===undefined&&!c[d].nullable){Log.warn("Missing data for field '"+d+"' for "+this.getName());continue}f!==undefined&&(b[e]=f)}return b},e._models={},e.extend=function(a){var b=Class.extend.call(this,a),c=["getName","getId","getFields","getSource"];for(var d=0,f=c.length;d<f;d++){if(!a.hasOwnProperty(c[d]))throw"Class missing '"+c[d]+"()' implementation";b[c[d]]=a[c[d]]}var g=a.getSource();if(!g.supportsModels())throw"Source '"+g.getName()+"' does not support models";return b.events=new r(null,this),b.getKey=function(){return e.getKey.apply(b,arguments)},b.getAll=function(){return e.getAll.apply(b,arguments)},b.get=function(){return e.get.apply(b,arguments)},b.set=function(){return e.set.apply(b,arguments)},b.remove=function(){return e.remove.apply(b,arguments)},b.on=function(){return e.on.apply(b,arguments)},b.fire=function(){return e.fire.apply(b,arguments)},b.detach=function(){return e.detach.apply(b,arguments)},e._models[b.getName()]=b,b},i=function(){function c(){}var a=!1,b=!1;return c.init=function(){b=!n.isActive()||!!n.isOnline(),this.cacheDS=new j({name:"cache"}),this.createDS=new PersistentStorageSource({name:"create"}),this.updateDS=new PersistentStorageSource({name:"update"}),this.deleteDS=new PersistentStorageSource({name:"delete"}),this.pendingDS=new PersistentStorageSource({name:"pending"}),n.on("statusChange",Class.proxy(this.onStatusChange,this))},c.getAll=function(c,d,e){var f=function(b){var e=this.createDS.getAll(c.getName()),f=this.updateDS.getAll(c.getName()),g=this.deleteDS.getAll(c.getName()),h=this.pendingDS.getAll(c.getName());for(var i in e){var j=e[i];j[c.getId()]="c"+i,b["c"+i]=j}for(var i in f)b[i]=f[i];for(var i in g)delete b[i];if(a)for(var i in h)b[h[c.getId()]]=h[i];d(b)},g=function(a){var b={};for(var e=0,f=a.length;e<f;e++)b[a[e][c.getId()]]=a[e];this.cacheDS.setAll(c.getName(),b),d.call(this,b)};if(!b){var h=this.cacheDS.getAll(c.getName());h!=undefined?f.call(this,h):e.call(this)}else c.getSource().getAll(c.getName(),Class.proxy(g,this),e)},c.get=function(c,d,e,f){var g=function(b){var f=this.createDS.getAll(c.getName()),g=this.updateDS.getAll(c.getName()),h=this.deleteDS.getAll(c.getName()),i=this.pendingDS.getAll(c.getName()),j=null;if(a)for(var k in i)i[k].hasOwnProperty(c.getId())&&i[k][c.getId()]==d&&(j=i[k]);f&&f.hasOwnProperty(d)&&(j=f[d]),g&&g.hasOwnProperty(d)&&j==null&&(j=g[d]);if(h&&h.hasOwnProperty(d))throw"Cannot fetch deleted item";e(j?j:b)},h=function(a){this.cacheDS.set(c.getName(),d,a),e(a)},i=function(a){a.status=="404"&&this.cacheDS.remove(c.getName(),d),f(a)};if(!b){var j=this.cacheDS.get(c.getName(),d);j!=undefined?g.call(this,j):f.call(this)}else c.getSource().get(c.getName(),d,Class.proxy(h,this),Class.proxy(i,this))},c.set=function(c,d,e,f,g){var h=function(a){a._unsaved=!0,f(a)},i=function(a){this.cacheDS.set(c.getName(),a[c.getId()],a),f(a)};if(!b)if(!d){var d="c"+this.createDS.set(c.getName(),null,e);d?(e[c.getId()]=d,h(e)):g()}else if(a){var j=this.deleteDS.getAll(c.getName());if(j&&j.hasOwnProperty(d))throw"Cannot update already removed item";this.pendingDS.set(c.getName(),null,e),h.call(this,e)}else{var k=this.createDS.getAll(),j=this.deleteDS.getAll();if(k&&k.hasOwnProperty(d))this.createDS.set(c.getName(),d,e);else{if(j&&j.hasOwnProperty(d))throw"Cannot update already removed item";this.updateDS.set(c.getName(),d,e)}h.call(this,e)}else c.getSource().set(c.getName(),d,e,Class.proxy(i,this),g)},c.remove=function(a,c,d,e){var f=function(b){this.cacheDS.remove(a.getName(),c),d(b)};if(!b){var g=this.createDS.getAll(a.getName()),h=this.updateDS.getAll(a.getName()),i=this.deleteDS.getAll(a.getName());g&&g.hasOwnProperty(c)&&this.createDS.remove(a.getName(),c),h&&h.hasOwnProperty(c)&&this.updateDS.remove(a.getName(),c);if(i&&i.hasOwnProperty(c))throw"Cannot delete already removed item";this.deleteDS.set(a.getName(),c,{}),d(c)}else a.getSource().remove(a.getName(),c,Class.proxy(f,this),e)},c.flush=function(){this.createDS.flush(!0),this.updateDS.flush(!0),this.deleteDS.flush(!0),this.pendingDS.flush(!0)},c.onStatusChange=function(c){c.data==1&&!a?this.onSync():a?this.onSyncFailure.call(this):b=!n.isActive()||!!n.isOnline()},c.onSync=function(b){if(a&&!b)return;a=!0;var c=function(a,b,c,d){this.createDS.remove(c,b),this.cacheDS.set(c,d,a),this.syncCount--,this.checkSyncStatus()},d=function(a,b,c){this.updateDS.remove(c,b),this.cacheDS.set(c,b,a),this.syncCount--,this.checkSyncStatus()},e=function(a,b){this.deleteDS.remove(b,a),this.cacheDS.remove(b,a),this.syncCount--,this.checkSyncStatus()},f=this.createDS.getAllActions(),g=this.updateDS.getAllActions(),h=this.deleteDS.getAllActions();this.syncCount=f.length+g.length+h.length;for(var i in f){var j=f[i].model;j.getSource().set(j.getName(),null,f[i].item,Class.proxy(function(a){var b=i;console.log("create"),c.call(this,a,b,j.getName(),a[j.getId()])},this),this.onSyncFailure)}for(var i in g){var j=g[i].model;j.getSource().set(j.getName(),i,g[i].item,Class.proxy(function(a){var b=i;console.log("update"),d.call(this,a,b,j.getName())},this),this.onSyncFailure)}for(var i in h){var j=h[i].model;j.getSource().remove(j.getName(),i,null,Class.proxy(function(a){var b=i;console.log("delete"),e.call(this,b,j.getName())},this),this.onSyncFailure)}},c.onSyncSuccess=function(){a=!1,b=!n.isActive()||!!n.isOnline(),Log.info("Unsaved data pushed to server.")},c.onSyncFailure=function(){Log.info("Could not push unsaved data to server.")},c.checkSyncStatus=function(){console.log("checking");if(this.syncCount==0){var a=this.pendingDS.getAllActions();if(a.length>0){for(var b in a){var d=a[b].model,e=a[b].item;if(!e.hasOwnProperty(d.getId()))throw"Pending item missing id";var f=e[d.getId()];this.updateDS.set(d.getName(),e,f),this.pendingDS.remove(d.getName(),f)}this.onSync(!0)}else c.onSyncSuccess.call(this)}},c.destroy=function(){n.detach("statusChange",this.proxy)},c}(),a.Application=b,a.Collection=c,a.Controller=d,a.Model=e,a.Source=f,a.View=g,a.AjaxSource=h,a.LocalStorageSource=j,a.RestSource=k,a.PersistenceManager=i,a.PersistentStorageSource=PersistentStorageSource},[],"1.0.2"),Orange.add("ui",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=__import("Application"),p=__import("Events"),q=__import("Model"),r=__import("Collection");o.prototype.onLaunch=function(a){var b=$('[data-root="true"]'),c=b.attr("data-control"),d=b.attr("data-name");if(typeof c=="undefined"||typeof d=="undefined")throw"Root view not found";b.removeAttr("data-root");var e=n.get(c),f=new e(null,b);f.on("load",function(){f.show()}),f.load()},b=Class.extend({initialize:function(a){this.node=a,this.template=a.clone(),this.eventTarget=new p(null,this),this.loaded=!1},bindData:function(a,b){if(this.loaded)return;this._bindData(this.node,a),this.loaded=!0},_bindData:function(a,b,c){if(b instanceof q)var c=b.getId(),d=b.toObject();else if(typeof b!="undefined")d=b,c=c;else{Log.error("Invalid model item");return}c&&a.attr("itemid",c);for(var e in d){var f=a.find('[itemprop="'+e+'"]'),g=[];a.find('[itemprop="'+e+'"]').each(function(){var b=!1,c=$(this).parent();while(c.length!==0&&!b){if($(c).not(a).length===0){b=!0;break}if($(c).not("[itemscope]").length===0){b=!1;break}c=$(c).parent()}b&&g.push($(this))});if(g.length>0)for(var h=0,i=g.length;h<i;h++)d[e]instanceof Array||d[e]instanceof r?this._bindList(g[h],d[e]):typeof d[e]=="object"||d[e]instanceof q?this._bindData(g[h],d[e]):g[h].text(d[e])}},bindList:function(a,b){if(this.loaded)return;this._bindList(this.node,a),this.loaded=!0},_bindList:function(b,c){var d=$(b).find("[itemscope]");if(!d.length)return;var e=d.clone(),f=b.clone().empty();if(c instanceof a.Collection){var g=c.toObject();for(var h in g){var i=e.clone();this._bindData(i,g[h],h),f.append(i)}}else if(c instanceof Array){var g=c;for(var h=0,j=g.length;h<j;h++){var i=e.clone();this._bindData(i,g[h]),f.append(i)}}b.replaceWith(f)},clear:function(){this.node.replaceWith(this.template.clone()),this.loaded=!1}}),c=Class.extend({initialize:function(a){var b=this,c=$(a).attr("name");this.fields={},this.target=a,$(a).find("input, select, textarea, button .ui-input").each(function(){var a=$(this).attr("name");b.fields[a]=$(this)})},getField:function(a){if(typeof this.fields[a]!="undefined")return this.fields[a];throw"Error: Form field '"+a+"' not found"},setField:function(a,b){try{this.getField(a).val(b)}catch(c){Log.warn('[WARN] Field "'+a+'" could not be fetched')}},getData:function(){var a={};for(var b in this.fields){var c=this.fields[b].val(),d=this.fields[b].attr("type");typeof c!==undefined&&c!==null&&d!=="submit"&&d!=="button"&&(a[b]=c)}return a},setData:function(b){var c=b;b instanceof a.Item&&(c=b.toObject());for(var d in this.fields)typeof c[d]!==undefined&&c[d]!==null&&this.fields[d].val(c[d])},detach:function(){for(var a in this.fields)this.fields[a].detach()},destroy:function(){for(var a in this.fields)delete this.fields[a]}});var n=a.Controller.extend({initialize:function(b,c){var d=this,e=[],f=[],g=[];this.loading=!1,this.unloading=!1,this.loaded=!1,this.visible=!1,this.appearing=!1,this.disappearing=!1,this.changing=!1,this.loadEvts=[],this.unloadEvts=[],this.showEvts=[],this.hideEvts=[],this.views={},this.forms={},this.elements={},this.events=[],this.data={},this.source=c.clone(),this.eventTarget=new a.Events(b,this);if(typeof c=="undefined")throw"Invalid target";this.target=$(c);var h=$(c).get(0);this.parent=typeof b!="undefined"?b:null,this.parent===null&&this.target.removeAttr("data-root");for(var i=0,j=h.attributes.length;i<j;i++)h.attributes[i].name.match(/data-/)&&(this.data[h.attributes[i].name.replace(/data-/,"")]=h.attributes[i].value);var k=function(a){var b=[];return this.target.find(a).each(function(){var a=!1,c=$(this).parent();while(c.length!==0&&!a){if($(c).not($(d.target)).length===0){a=!0;break}if($(c).not("[data-control]").length===0){a=!1;break}c=$(c).parent()}a&&b.push(this)}),b};e=k.call(this,"[data-control]"),f=k.call(this,"form"),g=k.call(this,"[data-name]:not([data-control])"),console.log(this.data.name+" "+"Initialized");for(var i=0,j=e.length;i<j;i++){var l=$(e[i]),m=l.attr("data-name"),o=l.attr("data-control"),p=l.attr("data-template"),q=typeof p!="undefined"&&p.length>0;if(q){var r=a.View.load(p);l.html($(r).html()),cloneAttributes(r,l),l.removeAttr("data-template")}var s=n.get(o);this.views[m]=new s(this,l)}for(var i=0,j=f.length;i<j;i++){var t=$(f[i]),m=t.attr("name"),u=new a.Form(t);this.forms[m]=u}for(var i=0,j=g.length;i<j;i++){var v=$(g[i]),m=v.attr("data-name");typeof m!="undefined"&&m.length>0&&(this.elements[m]=v.removeAttr("data-name"))}this.target.addClass(this.getClasses()),this.target.removeAttr("data-control").removeAttr("data-name"),this.type=this.getType(),this.name=this.data.name},getType:function(){return"ui-view"},getClasses:function(){var a=typeof this.typeList!="undefined"?this.typeList:"";return a+" "+this.data.name},getTriggers:function(){return[]},getBindings:function(){return{}},load:function(){if(this.loading||this.loaded)return;this.loading=!0,this.loadEvts.push(this.on("_load",this.onLoad,this)),this.loadEvts.push(this.on("_loaded",this.onDidLoad,this)),this.onWillLoad()},onWillLoad:function(){console.log(this.data.name+" "+"Will Load"),this.fire("_load")},onLoad:function(){for(var a in this.views)this.views[a].load();console.log(this.data.name+" "+"Load"),this.fire("_loaded")},onDidLoad:function(){for(var a=0,b=this.loadEvts.length;a<b;a++)this.loadEvts[a].detach();console.log(this.data.name+" "+"Did Load"),this.loadEvts=[],this.loading=!1,this.loaded=!0,this.fire("load")},unload:function(){if(this.unloading||!this.loaded)return;if(this.visible&&!this.disappearing){this.vEvt=this.on("disappear",function(a){this.unload(),this.vEvt.detach()},this),this.hide();return}this.unloadEvts.push(this.on("_unload",this.onUnload,this)),this.unloadEvts.push(this.on("_unloaded",this.onDidUnload,this)),this.unloading=!0,this.onWillUnload()},onWillUnload:function(){console.log(this.data.name+" "+"Will Unload"),this.fire("_unload")},onUnload:function(){for(var a in this.views)this.views[a].unload();console.log(this.data.name+" "+"Unload"),this.fire("_unloaded")},onDidUnload:function(){console.log(this.data.name+" "+"Did Unload");for(var a=0,b=this.unloadEvts.length;a<b;a++)this.unloadEvts[a].detach();this.unloadEvts=[],this.unloading=!1,this.loaded=!1,this.fire("unload")},show:function(){if(this.visible||this.appearing)return;this.appearing=!0,this.showEvts.push(this.on("_appear",this.onAppear,this)),this.showEvts.push(this.on("_appeared",this.onDidAppear,this)),this.onWillAppear()},onWillAppear:function(){console.log(this.data.name+" "+"Will Appear");var b=this.getBindings();for(var c in b){var d=b[c];for(var e in d){var f=typeof d[e]=="function"?d[e]:null;e=="touchclick"&&(e=a.Browser.isTouch?"touchend":"click");if(f===null){var g=e.charAt(0).toUpperCase()+e.slice(1);f=d[e]===!0&&typeof this["on"+g]=="function"?this["on"+g]:null}f!==null&&this.views.hasOwnProperty(c)?this.getView(c).on(e,$.proxy(f,this)):f!==null&&this.elements.hasOwnProperty(c)&&this.getElement(c).on(e,$.proxy(f,this))}}this.fire("_appear")},onAppear:function(){for(var a in this.views)this.views[a].show();console.log(this.data.name+" "+"Appear"),this.fire("_appeared")},onDidAppear:function(){console.log(this.data.name+" "+"Did Appear");for(var a=0,b=this.showEvts.length;a<b;a++)this.showEvts[a].detach();this.showEvts=[],this.appearing=!1,this.visible=!0,this.fire("appear")},hide:function(){if(!this.visible||this.disappearing)return;this.disappearing=!0,this.hideEvts.push(this.on("_disappear",this.onDisappear,this)),this.hideEvts.push(this.on("_disappeared",this.onDidDisappear,this)),this.onWillDisappear()},onWillDisappear:function(){console.log(this.data.name+" "+"Will Disappear");for(var a in this.views)this.getView(a).detach();for(var b in this.forms)this.getForm(b).detach();for(var c in this.elements)this.getElement(c).unbind();this.fire("_disappear")},onDisappear:function(){for(var a in this.views)this.views[a].hide();console.log(this.data.name+" "+"Disappear"),this.fire("_disappeared")},onDidDisappear:function(){console.log(this.data.name+" "+"Did Disappear");for(var a=0,b=this.hideEvts.length;a<b;a++)this.hideEvts[a].detach();this.hideEvts=[],this.disappearing=!1,this.visible=!1,this.fire("disappear")},getView:function(a){if(a instanceof n)return a;if(typeof this.views[a]!="undefined")return this.views[a];throw'Error: View "'+a+'" not found'},getForm:function(a){if(this.forms[a]instanceof c)return this.forms[a];throw'Error: Form "'+a+'" not found'},getElement:function(a){if(typeof this.elements[a]!="undefined")return this.elements[a];throw'Error: Element "'+a+'" not found'},hasView:function(a){return typeof this._views[a]!="undefined"},hasForm:function(a){return typeof this._forms[a]!="undefined"},hasElement:function(a){return typeof this._elements[a]!="undefined"},on:function(a,b,c){var d=typeof c!="undefined"?function(){b.apply(c,arguments)}:b;return this.eventTarget.on.call(this.eventTarget,a,d)},detach:function(a,b){return this.eventTarget.detach.apply(this.eventTarget,arguments)},fire:function(a,b){return this.eventTarget.fire.apply(this.eventTarget,arguments)},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},find:function(a){return $(this.target).find(a)},destroy:function(){for(var a in this._views)this.views[a].destroy();for(var a in this._forms)this.forms[a].destroy();for(var a in this._elements)delete this.elements[a];delete this.target,delete this.parent,delete this.eventTarget}});n.views={view:n},n.prototype.typeList="",n.extend=function(a){var b=Class.extend.call(this,a),c=a.getType(),d=["getType"];for(var e=0,f=d.length;e<f;e++){if(!a.hasOwnProperty(d[e]))throw"Class missing '"+d[e]+"()' implementation";b[d[e]]=a[d[e]]}return b.prototype.typeList+=(b.prototype.typeList==""?"":" ")+c,b.extend=arguments.callee,n.views[c]=b},n.get=function(a){if(!this.views.hasOwnProperty(a))throw"View '"+a+'" not found';return this.views[a]},i=n.extend({getType:function(){return"multi-view"},initialize:function(a,b){this._super(a,b),this.defaultView=this.target.attr("data-default"),this.target.removeAttr("data-default")},onLoad:function(){for(var a in this._views)this._views[a].name!==this.defaultView?this._views[a].target.hide():this.activeView=this._views[a];this._super()},activateView:function(b){var c=this.getView(b);c instanceof a.ViewController&&(this.activeView.target.hide(),this.activeView=c,this.activeView.target.show())},getActiveView:function(){return this.activeView.name}}),a.Binding=b,a.Form=c,a.MultiViewController=i,a.ViewController=n},["mvc"],"1.0.2");