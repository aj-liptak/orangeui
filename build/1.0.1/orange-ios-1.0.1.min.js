Orange.add("ios",function(a){a.namespace("iOS");a.iOS.UIView=a.View.define({type:"ios-ui-view",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UINavigationView=a.View.define({type:"ios-ui-navigation-view",activeView:null,leftBtn:null,rightBtn:null,navBar:null,viewStack:[],initialize:function(a,b){this._super(a,b);var c=this.target.attr("data-default");for(var d in this._views){if(this._views[d].name!==c){this._views[d].target.remove()}else{this.viewStack.push(this._views[d]);this.activeView=this._views[d]}}},onLoad:function(){this.activeView.onLoad();this.navBar=$('<div class="ios-ui-navigation-bar"></div>');this.target.prepend(this.navBar);var a=this.activeView.find(".ios-ui-bar-button-item.left");var b=this.activeView.find(".ios-ui-bar-button-item.right");if(a.length!=0){this.leftBtn=a.clone(true);this.leftBtn.appendTo(this.navBar)}if(b.length!=0){this.rightBtn=b.clone(true);this.rightBtn.appendTo(this.navBar)}this.activeView.target.addClass("active");this.target.removeAttr("data-name");this.target.removeAttr("data-view");for(var c in this._elements){this._elements[c].onLoad()}this.target.removeAttr("data-default");this.popping=false},popView:function(){var a=300;var b=this.viewStack[this.viewStack.length-2];var c=b.find(".ios-ui-bar-button-item.left");var d=b.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null)this.leftBtn.fadeOut(a+100,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(a+100,function(){$(this).unbind().remove()});if(c.length!=0){this.leftBtn=c.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(a+100)},this),a-100)}if(d.length!=0){this.rightBtn=d.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(a+100)},this),a-100)}if(c.length==0&&d.length==0&&navBar.length==0){this.navBar.addClass("hidden");b.target.css("top","0px")}else{this.navBar.removeClass("hidden");b.target.css("top","44px")}var e=this.activeView;if(this.activeView.length!=0){e.target.addClass("unloading").removeClass("active");this.viewStack.pop()}setTimeout($.proxy(function(){e.target.addClass("preloaded").removeClass("unloading");e.target.remove();e.onUnload()},this),a);this.activeView=b;b.target.addClass("loading").removeClass("inactive");setTimeout($.proxy(function(){b.target.addClass("active").removeClass("loading")},this),a)},pushView:function(a){var b=300;a=this.getView(a);for(var c in this.viewStack){if(this.viewStack[c].target[0]==a.target[0]){throw"Can't repush view controller"}}a.target.addClass("preloaded");this.target.append(a.target);a.onLoad();var d=a.find(".ios-ui-bar-button-item.left");var e=a.find(".ios-ui-bar-button-item.right");var f=a.find("ios-ui-navigation-bar");if(this.leftBtn!=null)this.leftBtn.fadeOut(b+100,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(b+100,function(){$(this).unbind().remove()});if(d.length!=0){this.leftBtn=d.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(b)},this),b-100)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(b)},this),b-100)}if(d.length==0&&e.length==0&&f.length==0){this.navBar.addClass("hidden");a.target.css("top","0px")}else{this.navBar.removeClass("hidden");a.target.css("top","44px")}var g=this.activeView;if(this.activeView.length!=0){g.target.addClass("inactivating").removeClass("active")}setTimeout($.proxy(function(){g.target.addClass("inactive").removeClass("inactivating")},this),b);this.activeView=a;a.target.addClass("loading").removeClass("preloaded");this.viewStack.push(a);setTimeout($.proxy(function(){a.target.addClass("active").removeClass("loading")},this),b)},popToRootView:function(){if(this.popping)return;this.popping=true;var a=300;for(var b=1;b<this.viewStack.length-1;b++){this.viewStack[b].target.remove()}var c=this.viewStack[0];var d=c.find(".ios-ui-bar-button-item.left");var e=c.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null)this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(a,function(){$(this).unbind().remove()});if(d.length!=0){this.leftBtn=d.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(a)},this),a-100)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(a)},this),a-100)}var f=this.activeView;if(this.activeView.length!=0){f.target.addClass("unloading");this.viewStack.pop()}setTimeout($.proxy(function(){f.target.addClass("preloaded").removeClass("unloading").removeClass("active");f.target.remove()},this),a);this.activeView=c;c.target.addClass("loading");setTimeout($.proxy(function(){c.target.addClass("active").removeClass("loading").removeClass("inactive");this.viewStack=[this.viewStack[0]];this.popping=false},this),a)},onUnload:function(){this._super()}});a.iOS.UIScrollView=a.View.define({type:"ios-ui-scroll-view",onLoad:function(){this.target.wrapInner('<div class="scroll-view"></div>');this.myScroll=new iScroll(this.target.get(0));this._super()},onUnload:function(){this._super();this.myScroll.destroy()}});a.iOS.UITableView=a.View.define({type:"ios-ui-table-view",onLoad:function(){var b=this.target.attr("data-cell-element");if(typeof b!=="undefined"){this.tableCell=a.TemplateManager.load("app/elements/"+b);this.target.wrapInner('<div class="scroll-view"><ul></ul></div>')}else{this.target.wrapInner('<div class="scroll-view"></div>')}this.myScroll=new iScroll(this.target.get(0));this._super();this.target.removeAttr("data-cell-element");if(typeof b!=="undefined"){this.target.on("click",$.proxy(this.onSelect,this))}this.target.on("touchmove",$.proxy(function(a){a.stopPropagation();a.preventDefault()},this))},setupTable:function(){var b=this.target.find("ul");var c=b.clone();var d=this.tableCell;var e=this.collection instanceof a.Collection?this.collection.data:this.collection;for(var f in e){template=new jsontemplate.Template(d);var g="";try{g=template.expand(e[f])}catch(h){g=d.replace(/{[^)]*}/,"[undefined]")}c.append($(g))}b.replaceWith(c);this.myScroll.refresh()},onRefresh:function(){this.setupTable()},bindData:function(b){if(b instanceof a.Collection){this.collection=b;this.setupTable()}else{this.collection=b;this.setupTable()}},onDataChange:function(a){if(this.collection.intersect(a.data)>0){this.collection.refresh();this.setupTable()}},onSelect:function(a){var b=$(a.target);var c=null;a.stopPropagation();if(b.hasClass("ios-ui-table-cell")){c=b}else if(b.parent().hasClass("ios-ui-table-cell")){c=b.parent()}if(c!=null){var d=$(c).attr("itemid");if(typeof this.collection.get==="function")var e=this.collection.get(d);else if(typeof this.collection==="object")var e=this.collection[d];this.fire("select",typeof e!=="undefined"?e:null)}},onUnload:function(){this._super();this.myScroll.destroy()}});a.iOS.UIModalView=a.View.define({type:"ios-ui-modal-view",onLoad:function(){this._super()},presentModalView:function(){this.onLoad();$("body").append(this.target);setTimeout($.proxy(function(){this.target.addClass("visible")},this),50)},dismissModalView:function(){this.target.removeClass("visible");setTimeout($.proxy(function(){this.target.remove();this.onUnload()},this),300)},onUnload:function(){this._super()}});a.iOS.UIFlipView=a.View.define({type:"ios-ui-flip-view",onLoad:function(){this._super()},flipView:function(){},onUnload:function(){this._super()}});a.iOS.ModuleManager=a.define({initialize:function(){},destroy:function(){}});a.iOS.UISegmentedControl=a.Element.define({type:"ios-ui-segmented-control",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UINavigationBar=a.Element.define({type:"ios-ui-navigation-bar",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UIBarButtonItem=a.Element.define({type:"ios-ui-bar-button-item",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.UIView=a.View.define({type:"ui-view"});a.UIMultiView=a.View.extend(a.UIView,{type:"ui-multi-view",initialize:function(a,b){this._super(a,b);this.defaultView=this.target.attr("data-default");this.target.removeAttr("data-default")},onLoad:function(){for(var a in this._views){if(this._views[a].name!==this.defaultView){this._views[a].target.hide()}else{this.activeView=this._views[a]}}this._super()},activateView:function(b){var c=this.getView(b);if(c instanceof a.ViewController){this.activeView.target.hide();this.activeView=c;this.activeView.target.show()}},getActiveView:function(){return this.activeView.name}});a.UIFlipView=a.View.extend(a.UIView,{type:"ui-flip-view",onLoad:function(){this._super();for(var a in this._views){this._views[a].target.addClass("animated")}this.find(".back").css("opacity",0).hide()},flipView:function(a){if(this.target.hasClass("flipped")){this.target.removeClass("flipped");setTimeout($.proxy(function(){this.find(".back").css("opacity",0)},this),300);setTimeout($.proxy(function(){this.find(".back").hide()},this),350)}else{this.find(".back").show();setTimeout($.proxy(function(){this.find(".back").css("opacity",1)},this),350);setTimeout($.proxy(function(){this.target.addClass("flipped")},this),50)}}});a.iOS.UISegmentedControl=a.View.extend(a.UIView,{type:"ios-ui-segmented-control",onLoad:function(){this._super();this.onResize();this.target.find(".ios-ui-segment").on(a.Browser.isMobile?"touchend":"click",$.proxy(this.onClick,this));$(window).on("resize",$.proxy(this.onResize,this))},onClick:function(a){var b=this.target.find(".ios-ui-segment");b.removeClass("selected");var c=$(a.currentTarget);c.addClass("selected");var d=b.index(c);this.fire("selected",d)},onResize:function(a){var b=this.target.width();var c=this.target.find(".ios-ui-segment").size();var d=parseInt(this.target.find(".ios-ui-segment:first").css("padding-left").replace("px",""));d+=parseInt(this.target.find(".ios-ui-segment:first").css("padding-right"));var e=0;if(c>1){e=Math.round(b/c)}else if(c=1)e=b;else return;var f=0;if(e*c!=b){f=e*c-b}this.target.find(".ios-ui-segment").width(e-d);this.target.find(".ios-ui-segment:last").width(e-d-f)},index:function(){var a=this.target.find(".ios-ui-segment");var b=this.target.find(".ios-ui-segment.selected");var c=a.index(b);return c},onUnload:function(){$(window).off("resize",$.proxy(this.onResize,this))}});a.iOS.UIToolbar=a.View.extend(a.UIView,{type:"ios-ui-toolbar"})},["ui","db"],"0.1")