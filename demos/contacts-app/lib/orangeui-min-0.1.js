(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function g(){if(!a&&this.initialize)this.initialize.apply(this,arguments)}var d=this.prototype;a=true;var e=new this;a=false;for(var f in c){e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);this._super=c;return e}}(f,c[f]):c[f]}g.prototype=e;g.prototype.constructor=g;g.extend=arguments.callee;return g}})();(function(a,b){function h(a){var b=a instanceof Array?[]:{};for(i in a){if(i=="clone")continue;if(a[i]&&typeof a[i]=="object"){b[i]=h(a[i])}else b[i]=a[i]}return b}function g(){}var c="0.1",d={},e=/[^-A-Za-z_]/g,f=/[^A-Za-z_]/g;d._modules={};d._apps={};d._config={};if(typeof console=="undefined"){console={log:function(){},dir:function(){}}}a.cloneAttributes=function(a,b){var b=$(b).eq(0);var a=$(a)[0];for(i=0;i<a.attributes.length;i++){var c=a.attributes[i];b.attr(c.name,c.value)}};d.define=function(a){return Class.extend(a)};d.extend=function(a,b){return a.extend(b)};d.Log=function(){var a=1;var b=2;var c=3;var d=[],e=a,f=function(f,g,h){var i={message:g,ex:h!=undefined?h:null,level:f,timestamp:(new Date).getTime()};if(f>=e){switch(f){case a:console.log("[DEBUG] "+g.toString());break;case b:console.log("[INFO] "+g.toString());break;case c:console.log("[ERROR] "+g.toString());break}}d.push(i)};return{info:function(a,c){f(b,a,c)},debug:function(b,c){f(a,b,c)},error:function(a,b){f(c,a,b)}}}();d.Event=d.define({initialize:function(a,b,c,d){this.bubbles=true;this.type=a;this.currentTarget=b;this.target=c;this.data=d},stopPropagation:function(){this.bubbles=false}});d.EventTarget=d.define({initialize:function(a,b){this._listeners={};this._parent=a;this._self=b},on:function(a,b){if(typeof this._listeners[a]==="undefined"){this._listeners[a]=[]}this._listeners[a].push(b)},fire:function(a,b){var c=this._parent;if(typeof a==="string")a=new d.Event(a,this._self,this._self,b);if(typeof a.type!=="string")throw"Error: Invalid 'type' when firing event";if(this._listeners[a.type]instanceof Array){var e=this._listeners[a.type];for(var f=0,g=e.length;f<g;f++)e[f].call(this,a)}if(c!=null&&c._eventTarget instanceof d.EventTarget&&a.bubbles){a.currentTarget=this._parent;c._eventTarget.fire.call(c._eventTarget,a,b)}},detach:function(a,b){if(this._listeners[a]instanceof Array){var c=this._listeners[a];for(var d=0,e=c.length;d<e;d++){if(typeof b!=="undefined"&&c[d]===b){c.splice(d,1);break}else c.splice(d,1)}}else if(typeof a==="undefined"){this._listeners={}}}});d._eventTarget=new d.EventTarget(null,d);var j=function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else if(a.attachEvent){a.attachEvent("on"+b,c)}};var k=function(){if(obj.removeEventListener){obj.removeEventListener(evt,fn,false)}else if(obj.detachEvent){obj.detachEvent("on"+evt,fn)}};d.Loader=function(){var b={};return{init:function(){return this},addModule:function(a,c,d){a=a.replace(e);var f={name:a,fn:c,req:d!=undefined?d:[]};b[a]=f},loadModule:function(c){if(typeof d._modules[c]!=="undefined"){return}if(b[c]!=undefined){d._modules[c]=true;for(var e=0,f=b[c].req.length;e<f;e++){if(b[c].req[e]===c)continue;this.loadModule(b[c].req[e])}b[c].fn.call(a,d);d.Log.info('Module "'+c+'" loaded')}}}}();d.add=function(){var a=arguments,b=a[0],c=typeof a[1]==="function"?a[1]:null,e=a[2];d.Loader.addModule(b,c,e)};d.use=function(){var b=Array.prototype.slice.call(arguments),c=b[b.length-1],e=h(b).splice(0,b.length-1);if(typeof e[0]!="function"){for(var f=0,g=e.length;f<g;f++){d.Loader.loadModule(e[f])}}c.call(a,d)};d.namespace=function(a){if(d[a]==undefined){d[a]={}}};d.app=function(a,b){var a=a.replace(f);d._apps[a]=b;d.Log.info("Added application "+a)};d.init=function(a){var b={},a=a.replace(f);if(d._apps[a]!=null){b=d._apps[a]}for(var c=0,e=b.required.length;c<e;c++){d.Loader.loadModule(b.required[c])}d.Cache.on("statusChange",function(a){if(a.data==1){d.Location.goOnline();d.Storage.goOnline();if(b.location)d.Location.getLocation(function(){});d.Log.info("Application went online")}else{d.Log.info("Application went offline");d.Location.goOffline();d.Storage.goOffline()}});d.Cache.init(b.poll);d.Storage.init();var g=$('[data-root="true"]'),h=g.attr("data-view");g.removeAttr("data-root");var i=d.View.load(h);var j=new i(null,g);j.onLoad()};var l=function(){var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=function(){var b=false;for(var c=0,d=a.length;c<d;c++){try{b=a[c]()}catch(e){continue}}return b};return{sendRequest:function(a,c,d,e,f){var g=b();if(!g)return;g.open(c,a,true);g.setRequestHeader("Cache-Control","no-cache");g.timeout=3e3;g.ontimeout=function(){f(g)};g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.onreadystatechange=function(){if(g.readyState!=4)return;if(g.status!=200&&g.status!=304){f(g)}e(g)};if(g.readyState==4){e(g);return}g.send(d)}}}();d.Cache=function(){var b=null,c=false,e=false,f=false,g=function(){if(b!=null){clearTimeout(b);b=null}},h=function(){if(navigator.onLine&&!f){e=true;f=true;r.fire("statusChange",1);return}g();b=setTimeout(function(){if(navigator.onLine&&!f){e=true;f=true;r.fire("statusChange",1)}else if(navigator.onLine){l.sendRequest("ping.js","GET",null,function(a){if(e===false)r.fire("statusChange",1);e=true},function(a){if(e===true)r.fire("statusChange",0);e=false})}else{setTimeout(function(){if(e===true)r.fire("statusChange",0);e=false},100)}b=null;if(c){setTimeout(h,10*1e3)}},f?100:0)},i=function(a){d.Log.info("Cache: All resources for this web app have now been downloaded. You can run this application while not connected to the internet")},k=function(){d.Log.info("Cache: Checking for cache manifest")},m=function(){d.Log.info("Cache: Starting download of cached files")},n=function(){d.Log.debug("Cache: There was an error in the manifest, downloading cached files or you're offline")},o=function(){d.Log.info("Cache: There was no update needed")},p=function(){d.Log.info("Cache: Downloading cached files")},q=function(){a.applicationCache.swapCache();d.Log.info("Cache: Updated cache has been loaded and is ready");a.location.reload(true)},r=new d.EventTarget(null,s),s={init:function(b){c=b;j(a,"offline",h);j(a,"online",h);j(a,"cached",h);j(a,"checking",h);j(a,"downloading",h);j(a,"error",h);j(a,"noupdate",h);j(a,"progress",h);j(a,"updateready",h);h()},updateNetworkStatus:function(){h()},on:function(a,b){r.on(a,b)},isOnline:function(){return e}};return s}();d.Storage=function(){var b=false,c=null,e=1,g=2;return{isSupported:false,init:function(){if("localStorage"in a){try{a.localStorage.setItem("_test",1);this.isSupported=true;a.localStorage.removeItem("_test")}catch(b){}}if(this.isSupported){try{if(a.localStorage){c=a.localStorage}}catch(b){}}else if("globalStorage"in a){try{if(a.globalStorage){c=a.globalStorage[a.location.hostname];this.isSupported=true}}catch(b){}}else{}if(typeof JSON==="undefined"||JSON.stringify==undefined){this.isSupported=false}if(this.isSupported){d.Log.info("Local storage loaded")}else{d.Log.debug("Local storage not supported")}},set:function(a,b,e){if(!this.isSupported)return false;a=a.replace(f);if(b==undefined){return false}var g={data:b,timestamp:(new Date).getTime(),ttl:e?e:24*60*60*1e3};try{c.setItem(a,JSON.stringify(g));d.Log.info("Set: Inserted object with key ("+a.toString()+") into local storage");return true}catch(h){if(h==QUOTA_EXCEEDED_ERR){d.Log.error("Storage quota has been exceeded",h)}else{d.Log.error("Could not insert item with key ("+a.toString()+") into local storage")}}return false},get:function(a,f){if(!this.isSupported)return;try{var h=JSON.parse(c.getItem(a));if(h!=undefined&&h.data!=undefined){if(b&&h.ttl!==-1&&(new Date).getTime()-h.timestamp>h.ttl){c.removeItem(a);throw g}d.Log.info("Get: Retrieved object for key ("+a.toString()+") from local storage");return h.data}else{throw e}}catch(i){if(i===e){d.Log.error("Unpack Error: Could not read local storage object",i)}else if(i===g){d.Log.debug("Removed expired object from local storage",i)}else{d.Log.error("Could not load local storage object")}}return f},remove:function(a){if(!this.isSupported)return false;try{c.removeItem(a);d.Log.info("Remove: Object ("+a+") removed from local storage")}catch(b){d.Log.error("Could not remove local storage object",b)}},flushExpired:function(a){if(!this.isSupported)return;if(b===false&&a!==true)return;for(var d in c){this.Storage.get(d)}},flush:function(a){if(!this.isSupported)return;if(b===false&&a!==true)return;try{localStorage.clear();d.Log.info("Clear: Local storage cleared")}catch(c){d.Log.error("Local storage could not be cleared",c)}},goOnline:function(){b=true},goOffline:function(){b=false}}}();d.Location=function(){var a=null,b=null,c=60*60*1e3,e=false,f=function(c,f){if(!g()){if(typeof c!=="undefined")c(a)}else if(e){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){b=(new Date).getTime();a=e.coords;d.Log.info("Location retrieved");c(e.coords)},function(a){switch(a.code){case a.TIMEOUT:d.Log.error("Location services timeout");break;case a.POSITION_UNAVAILABLE:d.Log.error("Position unavailable");break;case a.PERMISSION_DENIED:d.Log.error("Please Enable Location Services");break;default:d.Log.error("Unknown location services error");break}if(typeof f==="function")f()})}}else{if(typeof f==="function"){d.Log.info("Could not retrieve location");f()}}},g=function(){return(new Date).getTime()-b>c};return{getLocation:function(a,b){f(a,typeof b==="function"?b:null)},goOnline:function(){_isLoaded=true;e=true},goOffline:function(){e=false}}}();a.Orange=d})(this,this.document);Orange.add("ui",function(a){a.View=function(){var b={};return{define:function(c){var d=a.extend(a.ViewController,c),e=c.type;d.prototype.typeList="ui-view "+e;if(typeof e==="undefined")throw"Error: Class not named";return b[e]=d},extend:function(c,d){var e=a.extend(c,d),f=d.type;e.prototype.typeList+=" "+f;if(typeof f==="undefined")throw"Error: Class not named";return b[f]=e},load:function(c){var d;if(c==="ui-view"){return a.ViewController}else if(typeof (d=b[c])!=="undefined"){return d}else throw"Error: View '"+c+"' not found"}}}();a.ViewController=a.define({type:"ui-view",initialize:function(b,c){var d=this;this.target=$(c);this.name=this.target.attr("data-name");if(this.target.length===0)throw"Invalid view source";this._views={};this._forms={};this._elements={};this._eventTarget=new a.EventTarget(b,this);var e=[];this.target.find("[data-view]").each(function(){var a=0,b=$(this).parent().not(d.target);while(b.length!=0){b=$(b).parent().not(d.target);if($(b).not("[data-view]").length===0)a++}if(a===0)e.push(this)});for(var f=0,g=e.length;f<g;f++){var h=$(e[f]),i=h.attr("data-name"),j=h.attr("data-view"),k=typeof h.attr("data-template")!=="undefined"?h.attr("data-template").length>0:false,l=h.attr("data-template");if(k){var m=a.TemplateManager.load("templates/"+l);h.html($(m).html());cloneAttributes(m,h);h.removeAttr("data-remote")}var n=a.View.load(j);var o=new n(this,h);d._views[i]=o}var p=[];this.target.find("form").each(function(){var a=0,b=$(this).parent().not(d.target);while(b.length!=0){if($(b).not("[data-view]").length===0)a++;b=$(b).parent().not(d.target)}if(a===0)p.push(this)});for(var f=0,g=p.length;f<g;f++){var q=$(p[f]),i=q.attr("name"),o=new a.Form(q);this._forms[i]=o}var r=[];this.target.find("[data-element]").each(function(){var a=0,b=$(this).parent().not(d.target);while(b.length!=0){if($(b).not("[data-view]").length===0)a++;b=$(b).parent().not(d.target)}if(a===0)r.push(this)});for(var f=0,g=r.length;f<g;f++){var s=$(r[f]),i=s.attr("data-name"),j=s.attr("data-element"),k=typeof s.attr("data-template")!=="undefined"?s.attr("data-template").length>0:false,l=s.attr("data-template");if(k){var m=a.TemplateManager.load("elements/"+l);s.html($(m).html());cloneAttributes(m,s);s.removeAttr("data-template")}var n=a.Element.load(j);var o=new n(this,s);d._elements[i]=o}this.target.addClass(this.typeList);console.log("[INFO] View '"+this.name+"' of type '"+this.type+"' initialized")},getView:function(a){if(typeof this._views[a]!=="undefined")return this._views[a];throw'Error: View "'+a+'" not found'},getForm:function(b){if(this._forms[b]instanceof a.Form)return this._forms[b];throw'Error: Form "'+b+'" not found'},on:function(){return this._eventTarget.on.apply(this._eventTarget,arguments)},detach:function(){return this._eventTarget.detach.apply(this._eventTarget,arguments)},fire:function(){return this._eventTarget.fire.apply(this._eventTarget,arguments)},find:function(a){return $(this.target).find(a)},onLoad:function(){this.target.removeAttr("data-name");this.target.removeAttr("data-view");for(var a in this._views){this._views[a].onLoad()}for(var a in this._elements){this._elements[a].onLoad()}},onUnload:function(){for(var a in this._views){this._views[a].onUnload()}},destroy:function(){for(var a in this._views){this._views[a].destroy()}for(var a in this._forms){this._forms[a].destroy()}for(var a in this._elements){this._elements[a].destroy()}}});a.Element=function(){var b={};return{define:function(c){var d=a.extend(a.ElementController,c),e=c.type;if(typeof e==="undefined")throw"Error: Class not named";return b[e]=d},extend:function(c,d){var e=a.extend(c,d),f=d.type;if(typeof f==="undefined")throw"Error: Class not named";return b[f]=e},load:function(c){var d;if(c==="ui-element"){return a.ElementController}else if(typeof (d=b[c])!=="undefined"){return d}else throw"Error: Element '"+c+"' not found"}}}();a.ElementController=a.define({type:"ui-element",initialize:function(b,c){var d=this;if(typeof c==="undefined"){c=a.TemplateManager.load("src/elements/"+this.type+".html")}this.source=c.html?c.html():c;this.data={};this.target=$(c);this.parent=b;this.name=this.target.attr("data-name");this.target.addClass(this.type);if(this.target.length===0)throw"Invalid view source"},onLoad:function(){this.processTemplate();this.target.removeAttr("data-element")},processTemplate:function(){var a=this.source;template=new jsontemplate.Template(a);var b="";try{b=template.expand(this.data)}catch(c){b=a.replace(/{[^)]*}/,"[undefined]")}this.target.html(b)},setData:function(a){this.data=a},destroy:function(){this.data=null;this.source=null;this.target=null;this.name=null;delete this.data;delete this.source;delete this.target;delete this.name}});a.Form=a.define({initialize:function(a){var b=this;this._fields={};this._target=a;var c=$(a).attr("name");$(a).find("input, select, textarea").each(function(){var a=$(this).attr("name");b._fields[a]=$(this)});console.log("[INFO] Form '"+c+"' initialized")},get:function(a){if(typeof this._fields[a]!=="undefined"){return this._fields[a]}},destroy:function(){for(var a in this._fields){this._fields[a].detach()}}});a.TemplateManager=function(){var a={},b=function(a){return $.ajax({async:false,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(){},error:function(){throw"Error: template not found"}}).responseText};return{load:function(c){if(typeof a[c]!=="undefined"){return a[c]}else{return b(c)}}}}();a.Browser=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string;var d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};a.init();return{browser:a.browser,version:a.version,os:a.OS}}()},["db"],"0.1")