<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>iOS App Demo</title>

<!-- libraries -->
<script src="lib/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="lib/json-template.js" type="text/javascript"></script>
<script src="lib/iscroll.js" type="text/javascript"></script>

<script src="../../src/scripts/oop.js" type="text/javascript"></script>
<script src="../../src/scripts/commons.js" type="text/javascript"></script>
<script src="../../src/scripts/mvc.js" type="text/javascript"></script>
<script src="../../src/scripts/ios.js" type="text/javascript"></script>

<!-- iOS meta rules -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="white">

<!-- viewport rules -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

<!-- stylesheets -->
<link type="text/css" rel="stylesheet" href="lib/reset.css" />
<link type="text/css" rel="stylesheet" href="../../src/stylesheets/ios.css" />

<!-- javascript controllers -->
<script src="js/models.js" type="text/javascript"></script>
<script src="js/controllers.js" type="text/javascript"></script>

<script type="text/javascript">

Orange.use('mvc', 'ios', function(O) {

	O.namespace('Test');
	
	O.CakePHPDataSource = O.DB.extend(O.RestDataSource, {
		
		getType: function() {
			return 'cakephp';
		},
		
		processItem: function(path, data) {
			var json = (typeof data !== 'object') ? $.parseJSON(data) : data;
			return json['Contact'];
		},
		
		processItems: function(path, data) {
			var json = $.parseJSON(data);
			return json['contacts'];
		}
		
	});
	
	O.DB.register('addressBook', {
		type: 'cakephp',
		path: '/contacts/'
	});
	
	O.Model.register('contacts', {
		id: 'id',
		fields: {
			contactId: { name: 'id', type: 'number', nullable: true },
			firstName: { name: 'first_name', type: 'text', nullable: true },
			lastName: { name: 'last_name', type: 'text', nullable: true },
			phone: { name: 'phone', type: 'tel', nullable: true },
			birthday: { name: 'birthday', type: 'date', nullable: true },
			website: { name: 'website', type: 'url', nullable: true }
		},
		source: 'addressBook'
	});

	O.Test.TestView = O.View.define({
	
		getType: function() {
			return 'test-view';
		},
		
		onDidLoad: function() {
		
			this.getView('test-button').on('click', this.onClick, this);
			
			O.Model.get('contacts').getAll($.proxy(function(data) {
				this.contacts = data;
			}, this));
		
		},
		
		onClick: function(e) {
			alert("As");
		}
	
	});
	
	O.Test.TestButton = O.View.define({
	
		getType: function() {
			return 'test-button';
		},
		
		onDidLoad: function() {
						
			this.target.bind('click', $.proxy(this.onClick, this));
		
		},
		
		onClick: function(e) {
			this.fire('click');
		}
	
	});

	O.App.register('test', {
		location: true,
		poll: false,
		required: ['ios', 'mvc'],
		baseUrl: '/orangeui/demos/test'
	});

});

</script>


<style type="text/css">

html, body {
	font: normal 16px "Helvetica Neue", "Helvetica", Arial, sans-serif;
	margin: 0;
	padding: 0;
	height: 100%;
	width: 100%;
}

body {
	overflow: hidden;
}

.preload {
	background: url(img/ios-ui-bar-button-item-bg-selected.png);
	display: none;
}

</style>

</head>

<body>

<div data-control="test-view" data-name="test-app" data-root="true">

	<p>Hello</p>
	
	<div data-control="test-button" data-name="test-button">A Button</div>
	
	<div data-name="contact" itemscope>
	
		<div itemprop="firstName"></div>
		<div itemprop="lastName"></div>
		<div itemprop="email"></div>
		<div itemprop="phone"></div>
	
	</div>

</div>

</body>

</html>