Orange.add("ios",function(a){a.namespace("iOS");a.iOS.UIView=a.View.define({type:"ios-ui-view",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UINavigationView=a.View.define({type:"ios-ui-navigation-view",activeView:null,leftBtn:null,rightBtn:null,navBar:null,viewStack:[],initialize:function(a,b){this._super(a,b);var c=this.target.attr("data-default");for(var d in this._views){if(this._views[d].name!==c){this._views[d].target.remove()}else{this.viewStack.push(this._views[d]);this.activeView=this._views[d]}}},onLoad:function(){this.activeView.onLoad();this.navBar=$('<div class="ios-ui-navigation-bar"></div>');this.target.prepend(this.navBar);var a=this.activeView.find(".ios-ui-bar-button-item.left");var b=this.activeView.find(".ios-ui-bar-button-item.right");if(a.length!=0){this.leftBtn=a.clone(true);this.leftBtn.appendTo(this.navBar)}if(b.length!=0){this.rightBtn=b.clone(true);this.rightBtn.appendTo(this.navBar)}this.activeView.target.addClass("active");this.target.removeAttr("data-name");this.target.removeAttr("data-view");for(var c in this._elements){this._elements[c].onLoad()}this.target.removeAttr("data-default")},popView:function(){var a=300;var b=this.viewStack[this.viewStack.length-2];var c=b.find(".ios-ui-bar-button-item.left");var d=b.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null)this.leftBtn.fadeOut(a+100,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(a+100,function(){$(this).unbind().remove()});if(c.length!=0){this.leftBtn=c.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(a+100)},this),a)}if(d.length!=0){this.rightBtn=d.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(a+100)},this),a)}if(c.length==0&&d.length==0&&navBar.length==0){this.navBar.addClass("hidden");b.target.css("top","0px")}else{this.navBar.removeClass("hidden");b.target.css("top","44px")}var e=this.activeView;if(this.activeView.length!=0){e.target.addClass("unloading").removeClass("active");this.viewStack.pop()}setTimeout($.proxy(function(){e.target.addClass("preloaded").removeClass("unloading");e.target.remove();e.onUnload()},this),a);this.activeView=b;b.target.addClass("loading").removeClass("inactive");setTimeout($.proxy(function(){b.target.addClass("active").removeClass("loading")},this),a)},pushView:function(a){var b=300;a=this.getView(a);for(var c in this.viewStack){if(this.viewStack[c].target[0]==a.target[0]){throw"Can't repush view controller"}}a.target.addClass("preloaded");this.target.append(a.target);a.onLoad();var d=a.find(".ios-ui-bar-button-item.left");var e=a.find(".ios-ui-bar-button-item.right");var f=a.find("ios-ui-navigation-bar");if(this.leftBtn!=null)this.leftBtn.fadeOut(b+100,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(b+100,function(){$(this).unbind().remove()});if(d.length!=0){this.leftBtn=d.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(b)},this),b-100)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(b)},this),b-100)}if(d.length==0&&e.length==0&&f.length==0){this.navBar.addClass("hidden");a.target.css("top","0px")}else{this.navBar.removeClass("hidden");a.target.css("top","44px")}var g=this.activeView;if(this.activeView.length!=0){g.target.addClass("inactivating").removeClass("active")}setTimeout($.proxy(function(){g.target.addClass("inactive").removeClass("inactivating")},this),b);this.activeView=a;a.target.addClass("loading").removeClass("preloaded");this.viewStack.push(a);setTimeout($.proxy(function(){a.target.addClass("active").removeClass("loading")},this),b)},popToRootView:function(){var a=300;for(var b=1;b<this.viewStack.length-1;b++){this.viewStack[b].target.remove()}var c=this.viewStack[0];var d=c.find(".ios-ui-bar-button-item.left");var e=c.find(".ios-ui-bar-button-item.right");if(this.leftBtn!=null)this.leftBtn.fadeOut(a,function(){$(this).unbind().remove()});if(this.rightBtn!=null)this.rightBtn.fadeOut(a,function(){$(this).unbind().remove()});if(d.length!=0){this.leftBtn=d.clone(true).hide();this.leftBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.leftBtn.fadeIn(a)},this),a)}if(e.length!=0){this.rightBtn=e.clone(true).hide();this.rightBtn.appendTo(this.navBar);setTimeout($.proxy(function(){this.rightBtn.fadeIn(a)},this),a)}var f=this.activeView;if(this.activeView.length!=0){f.target.addClass("unloading");this.viewStack.pop()}setTimeout($.proxy(function(){f.target.addClass("preloaded").removeClass("unloading").removeClass("active");f.target.remove()},this),a);this.activeView=c;c.target.addClass("loading");setTimeout($.proxy(function(){c.target.addClass("active").removeClass("loading").removeClass("inactive");this.viewStack=[this.viewStack[0]]},this),a)},onUnload:function(){this._super()}});a.iOS.UIScrollView=a.View.define({type:"ios-ui-scroll-view",onLoad:function(){this.target.wrapInner('<div class="scroll-view"></div>');this.myScroll=new iScroll(this.target.get(0));this._super()},onUnload:function(){this._super();this.myScroll.destroy()}});a.iOS.UITableView=a.View.define({type:"ios-ui-table-view",onLoad:function(){var b=this.target.attr("data-cell-element");if(typeof b==="undefined")throw"UITableView '"+this.name+"' missing 'data-cell-element' attribute";this.tableCell=a.TemplateManager.load("app/elements/"+b);this.target.wrapInner('<div class="scroll-view"><ul></ul></div>');this.myScroll=new iScroll(this.target.get(0));this._super();this.target.on("click",$.proxy(this.onSelect,this));this.target.removeAttr("data-cell-element");this.target.on("touchstart",$.proxy(function(a){var b=$(a.target);if(b.hasClass("ios-ui-table-cell")){cell=b}else if(b.parent().hasClass("ios-ui-table-cell")){cell=b.parent()}if(cell!=null){cell.addClass("touched")}},this));this.target.on("touchend",$.proxy(function(a){this.target.find(".ios-ui-table-cell").removeClass("touched")},this))},setupTable:function(){var a=this.target.find("ul");var b=a.clone();var c=this.tableCell;for(var d=0,e=this.collection.data.length;d<e;d++){template=new jsontemplate.Template(c);var f="";try{f=template.expand(this.collection.data[d])}catch(g){f=c.replace(/{[^)]*}/,"[undefined]")}b.append($(f))}a.replaceWith(b);this.myScroll.refresh()},onRefresh:function(){this.setupTable()},bindData:function(a){this.collection=a;this.collection.model.on("datachange",$.proxy(this.onDataChange,this));this.setupTable()},onDataChange:function(a){if(this.collection.intersect(a.data)>0){this.collection.refresh();this.setupTable()}},onSelect:function(a){var b=$(a.target);var c=null;a.stopPropagation();if(b.hasClass("ios-ui-table-cell")){c=b}else if(b.parent().hasClass("ios-ui-table-cell")){c=b.parent()}if(c!=null){var d=$(c).attr("itemid");var e=this.collection.get(d);this.fire("select",e)}},onUnload:function(){this._super();this.myScroll.destroy()}});a.iOS.UIModalView=a.View.define({type:"ios-ui-modal-view",onLoad:function(){this._super()},presentModalView:function(){$("body").append(this.target);console.log("presenting")},dismissModalView:function(){console.log("dismissing");this.target.remove()},onUnload:function(){this._super()}});a.iOS.UIFlipView=a.View.define({type:"ios-ui-flip-view",onLoad:function(){this._super()},flipView:function(){},onUnload:function(){this._super()}});a.iOS.ModuleManager=a.define({initialize:function(){},destroy:function(){}});a.iOS.UISegmentedControl=a.Element.define({type:"ios-ui-segmented-control",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UINavigationBar=a.Element.define({type:"ios-ui-navigation-bar",onLoad:function(){this._super()},onUnload:function(){this._super()}});a.iOS.UIBarButtonItem=a.Element.define({type:"ios-ui-bar-button-item",onLoad:function(){this._super()},onUnload:function(){this._super()}})},["ui","db"],"0.1")