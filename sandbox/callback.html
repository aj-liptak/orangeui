<script type="text/javascript" src="lib/jquery-1.7.2.min.js"></script>

<script type="text/javascript">

var Queue = (function() {
	
	function Queue() {
		this.queue = [];
		this.live = false;
	}
	
	Queue.prototype.add = function(func, arguments, context) {		
		this.queue.push({ func: func, args: arguments, context: context });
		if (this.live) return;
		else {
			this.live = true;
			this.next();
		}
	};
	
	Queue.prototype.next = function() {
		if (this.queue.length == 0) {
			this.live = false;
			return;
		}
		var active = this.queue.shift();
		active.func.apply(active.context, active.args);
	}
	
	return Queue;

})();

var d = new Date();

function printTime() {
	var now = new Date();
	var n = (now.getTime() - d.getTime());
	return n + " ms";
}

window.onload = function() {

	console.log("Time: " + printTime());

	var Test = (function() {
	
		var queue = new Queue();
		
		function Test() {
			this.name = "hello";
		}
	
		Test.prototype._doSomething = function(message, time) {
		
			var list = [];
		
			setTimeout($.proxy(function() {
				console.log(printTime() + " " +this.name + ' ' + message);
				queue.next(); // i'm done
			}, this), time);
		
		};
	
		Test.prototype.doSomething = function() {
		
			queue.add(this._doSomething, arguments, this);
				
			return this;
			
		};
		
		Test.prototype._trySomething = function(message, time) {
			
				var list = [];
			
				for (var i = 0; i < 1000000; i++) {
					list.push(i);
					if (i == 999999) console.log(printTime() + " " +this.name + ' ' + message);
				}
				
				//console.log(this.name + ' ' + message);
				queue.next();
			
			};
		
			Test.prototype.trySomething = function() {
			
				queue.add(this._trySomething, arguments, this);
					
				return this;
				
			};
		
	
		return Test;
	
	})();

	(function() {
	
		var t = new Test();
				
		t.doSomething("one", 2000).doSomething("two", 500).trySomething("three", 800).doSomething("four", 200).doSomething("five", 1000);
	
		console.log(printTime() + " Done");
	
	})();

};


</script>